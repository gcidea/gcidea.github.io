<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>GCidea&#39;s blog</title>
  <subtitle>The relentless pursuit of perfection.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.gcidea.info/"/>
  <updated>2017-05-01T14:32:31.985Z</updated>
  <id>http://www.gcidea.info/</id>
  
  <author>
    <name>Gao Chang</name>
    <email>gaochang@ebupt.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PWA-渐进式Web应用探究</title>
    <link href="http://www.gcidea.info/2017/05/01/pwa/"/>
    <id>http://www.gcidea.info/2017/05/01/pwa/</id>
    <published>2017-05-01T13:52:04.000Z</published>
    <updated>2017-05-01T14:32:31.985Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p70.jpg" alt=""></p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>Progressive Web Apps are experiences that combine the best of the web and the best of apps.<br>They are useful to users from the very first visit in a browser tab, no install required.<br>As the user progressively builds a relationship with the app over time, it becomes more and more powerful. </p>
</blockquote>
<ul>
<li>融合了web和app的最佳使用体验</li>
<li>首次访问通过浏览器tab页，无需安装</li>
<li>随着用户多次使用，与应用建立了更明确的关系，体验逐步增强</li>
</ul>
<hr>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><h3 id="Progressive"><a href="#Progressive" class="headerlink" title="Progressive"></a>Progressive</h3><p>渐进增强-优雅降级。eq: 离线存储，Cache API  Local Storage</p>
<h3 id="Responsive"><a href="#Responsive" class="headerlink" title="Responsive"></a>Responsive</h3><p>适配PC、移动端多种设备</p>
<h3 id="Connectivity-Independent"><a href="#Connectivity-Independent" class="headerlink" title="Connectivity Independent"></a>Connectivity Independent</h3><p>通过service worker实现在低质量网络或者离线条件下使用</p>
<h3 id="App-like"><a href="#App-like" class="headerlink" title="App-like"></a>App-like</h3><p>建立在app shell模型基础上，就像在使用原生app</p>
<h3 id="Fresh"><a href="#Fresh" class="headerlink" title="Fresh"></a>Fresh</h3><p>通过service worker来保持资源更新</p>
<h3 id="Safe"><a href="#Safe" class="headerlink" title="Safe"></a>Safe</h3><p>PWA服务的提供建立在 https 基础上</p>
<h3 id="Discoverable"><a href="#Discoverable" class="headerlink" title="Discoverable"></a>Discoverable</h3><p>搜索引擎可抓取，得益于W3C manifest和service worker注册作用域</p>
<h3 id="Re-engageable"><a href="#Re-engageable" class="headerlink" title="Re-engageable"></a>Re-engageable</h3><p>通过类似推送通知的方式实现应用再次唤起</p>
<h3 id="Installable"><a href="#Installable" class="headerlink" title="Installable"></a>Installable</h3><p>可让用户不通过app store等应用商店“安装”应用（至桌面）</p>
<h3 id="Linkable"><a href="#Linkable" class="headerlink" title="Linkable"></a>Linkable</h3><p>可简单地通过URl对应用进行分享</p>
<hr>
<h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p>Google，首次出现于2015.06 Googler Alex Russell的博客文章<br>《Progressive Web Apps: Escaping Tabs Without Losing Our Soul》</p>
<p>主要观点是：<strong> Web的发展方向应该是“在保留open web灵魂的基础上渐进增强” </strong>。</p>
<hr>
<h2 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h2><ul>
<li>chrome 52及以上、opera</li>
<li>https</li>
</ul>
<p>但因渐进式设计，所有设备都可以访问（包括iOS）</p>
<hr>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="application-shell与content"><a href="#application-shell与content" class="headerlink" title="application shell与content"></a>application shell与content</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-1.jpg" alt=""></p>
<ul>
<li>application shell </li>
</ul>
<p>类似于原生app开发中发布上线的“the bundle of code”<br>包括支持用户界面所需的最基础的 HTML、CSS 和 JavaScript<br>如果离线缓存，可确保用户重复访问时即时、可靠的良好性能<br>这意味着并不是每次用户访问时都要从网络加载 App Shell<br> 只需要从网络中加载必要的内容</p>
<ul>
<li>content</li>
</ul>
<p>动态获取的数据</p>
<hr>
<h2 id="关键技术"><a href="#关键技术" class="headerlink" title="关键技术"></a>关键技术</h2><h3 id="service-worker的角色"><a href="#service-worker的角色" class="headerlink" title="service worker的角色"></a>service worker的角色</h3><p>service-worker为浏览器启动单独后台运行线程，可以搭配Cache API做缓存、<br>可以拦截所有HTTP请求并使用Fetch API进行response，是一个完备的Proxy<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-2.png" alt=""></p>
<h3 id="service-worker的生命周期"><a href="#service-worker的生命周期" class="headerlink" title="service worker的生命周期"></a>service worker的生命周期</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-3.png" alt=""></p>
<h3 id="消息推送"><a href="#消息推送" class="headerlink" title="消息推送"></a>消息推送</h3><p><strong><em> 一句话概述：Service Worker 的后台计算能力—Push API 推送—Notification API 通知 </em></strong></p>
<ul>
<li>推送（ Push API ）</li>
</ul>
<p>Push API 让推送服务具备了向 web 应用推送消息的能力；<br>它定义了 web 应用如何向推送服务发起订阅、如何响应推送消息、web 应用和服务器与推送服务之间的鉴权与加密机制；<br>由于 Push API 并不依赖 web 应用与浏览器 UI 存活，所以即使是在 web 应用与浏览器未被用户打开的时候，也可以通过后台进程接受推送消息并调用 Notification API 向用户发出通知</p>
<ul>
<li>通知（ Notification API ）</li>
</ul>
<p>负责所有与通知本身相关的机制，如通知权限管理、向操作系统发起通知、通知类型与音效，以及提供通知被点击或关闭时的回调等；<br>最早在 2010 年由 Chromium 提出，以 webkitNotifications 前缀方式实现；<br>2011 年进入标准化；<br>2012 年在 Safari 6（Mac OSX 10.8+）上获得支持；<br>2015 年 Notification API 成为 W3C Recommendation；<br>2016 年 Edge 的支持</p>
<p>示例：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-4.png" alt=""></p>
<hr>
<h2 id="案例体验"><a href="#案例体验" class="headerlink" title="案例体验"></a>案例体验</h2><h3 id="设计App-Shell—由设计稿划分component组件"><a href="#设计App-Shell—由设计稿划分component组件" class="headerlink" title="设计App Shell—由设计稿划分component组件"></a>设计App Shell—由设计稿划分component组件</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-5.png" alt=""></p>
<h3 id="创建app-shell对应的模版文件"><a href="#创建app-shell对应的模版文件" class="headerlink" title="创建app shell对应的模版文件"></a>创建app shell对应的模版文件</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-6.png" alt=""></p>
<h3 id="完成相应逻辑-刷新天气，增加城市等"><a href="#完成相应逻辑-刷新天气，增加城市等" class="headerlink" title="完成相应逻辑-刷新天气，增加城市等"></a>完成相应逻辑-刷新天气，增加城市等</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-7.png" alt=""></p>
<h3 id="实现首次快速加载"><a href="#实现首次快速加载" class="headerlink" title="实现首次快速加载"></a>实现首次快速加载</h3><p>使用localStorage实现对用户已选城市列表的存储<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-8.png" alt=""><br>（实际使用场景中应该使用 IndexedDB 等快速存储机制）</p>
<h3 id="使用service-worker实现对app-shell的预缓存（功能的离线使用）"><a href="#使用service-worker实现对app-shell的预缓存（功能的离线使用）" class="headerlink" title="使用service worker实现对app shell的预缓存（功能的离线使用）"></a>使用service worker实现对app shell的预缓存（功能的离线使用）</h3><h4 id="注册service-worker"><a href="#注册service-worker" class="headerlink" title="注册service worker"></a>注册service worker</h4><p>a.  创建一个包含service worker的js文件：service-worker.js<br>     (注意该文件位置在项目根目录，因为service worker的作用域由路径决定)<br>b.  通知浏览器注册该service worker<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-9.png" alt=""></p>
<h4 id="缓存网页资源"><a href="#缓存网页资源" class="headerlink" title="缓存网页资源"></a>缓存网页资源</h4><p>当service worker注册完成，用户首次访问该应用时触发“install”事件，在回调函数中我们可以对应用所需要的静态资源进行缓存。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-10.png" alt=""></p>
<ul>
<li>caches.open()</li>
</ul>
<p>打开指定的缓存</p>
<ul>
<li>cache.addAll()</li>
</ul>
<p>接收一个URL列表，从服务端获取数据并添加到缓存<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-11.png" alt=""></p>
<p>此时，在控制台可以看到已经注册的service worker<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-12.png" alt=""></p>
<p>然后，再在service-worker.js中添加“active”事件绑定<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-13.png" alt=""></p>
<p>此时，在控制台可以看到已经注册的service worker处于active状态<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-14.png" alt=""></p>
<p>继续丰富“active”回调函数的内容：<br>确保任何app shell所需的任何静态文件有变化时，service worker都能及时更新<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-15.png" alt=""></p>
<h4 id="通过缓存提供app-shell的内容"><a href="#通过缓存提供app-shell的内容" class="headerlink" title="通过缓存提供app shell的内容"></a>通过缓存提供app shell的内容</h4><p>service worker提供了拦截http请求并进行处理的能力，<br>这意味着可以在service worker内部使用缓存进行响应<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-16.png" alt=""></p>
<h4 id="测试离线情况"><a href="#测试离线情况" class="headerlink" title="测试离线情况"></a>测试离线情况</h4><p>首先，点击选择“offline”，network出现黄色叹号标志标明已经处于离线状态<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-17.png" alt=""></p>
<p>此时，查看已缓存的文件：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-18.png" alt=""></p>
<h3 id="使用service-worker对data预缓存"><a href="#使用service-worker对data预缓存" class="headerlink" title="使用service worker对data预缓存"></a>使用service worker对data预缓存</h3><p><strong><em> 核心：静态资源离线优先；动态资源网络优先 </em></strong><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-19.png" alt=""></p>
<h3 id="通过manifest-json支持在设备home-screen添加icon"><a href="#通过manifest-json支持在设备home-screen添加icon" class="headerlink" title="通过manifest.json支持在设备home screen添加icon"></a>通过manifest.json支持在设备home screen添加icon</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-20.png" alt=""></p>
<blockquote>
<p>注：<br>提示添加的条件：</p>
<ul>
<li>注册了service worker</li>
<li>有manifest文件</li>
<li>5min内访问2次以上<br>（不同浏览器实现不同）</li>
</ul>
</blockquote>
<h3 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-21.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-22.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/pwa-23.png" alt=""></p>
<hr>
<h2 id="扩展话题"><a href="#扩展话题" class="headerlink" title="扩展话题"></a>扩展话题</h2><h3 id="对Android-iOS平台原生能力的调用支持"><a href="#对Android-iOS平台原生能力的调用支持" class="headerlink" title="对Android/iOS平台原生能力的调用支持"></a>对Android/iOS平台原生能力的调用支持</h3><p><a href="https://whatwebcando.today/" target="_blank" rel="external">https://whatwebcando.today/</a></p>
<p><a href="http://stackoverflow.com/questions/35504194/what-features-do-progressive-web-apps-have-vs-native-apps-and-vice-versa-on-an" target="_blank" rel="external">http://stackoverflow.com/questions/35504194/what-features-do-progressive-web-apps-have-vs-native-apps-and-vice-versa-on-an</a></p>
<h3 id="页面质量检测"><a href="#页面质量检测" class="headerlink" title="页面质量检测"></a>页面质量检测</h3><p>Lighthouse—灯塔，PWA官方提供检测工具</p>
<h3 id="与前端框架的结合（Twitter-React-PWA）"><a href="#与前端框架的结合（Twitter-React-PWA）" class="headerlink" title="与前端框架的结合（Twitter React PWA）"></a>与前端框架的结合（Twitter React PWA）</h3><p><a href="https://twitter.com/necolas/status/829128165314306048" target="_blank" rel="external">https://twitter.com/necolas/status/829128165314306048</a></p>
<hr>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><h3 id="PWA官方文档"><a href="#PWA官方文档" class="headerlink" title="PWA官方文档"></a>PWA官方文档</h3><p>（<a href="https://developers.google.com/web/progressive-web-apps/）" target="_blank" rel="external">https://developers.google.com/web/progressive-web-apps/）</a></p>
<h3 id="App-Shell-模型"><a href="#App-Shell-模型" class="headerlink" title="App Shell 模型"></a>App Shell 模型</h3><p>（<a href="https://developers.google.com/web/fundamentals/architecture/app-shell）" target="_blank" rel="external">https://developers.google.com/web/fundamentals/architecture/app-shell）</a></p>
<h3 id="服务工作线程Service-Worker"><a href="#服务工作线程Service-Worker" class="headerlink" title="服务工作线程Service Worker"></a>服务工作线程Service Worker</h3><p>（<a href="https://developers.google.com/web/fundamentals/getting-started/primers/service-workers）" target="_blank" rel="external">https://developers.google.com/web/fundamentals/getting-started/primers/service-workers）</a></p>
<h3 id="PWA-在饿了么的实践经验"><a href="#PWA-在饿了么的实践经验" class="headerlink" title="PWA 在饿了么的实践经验"></a>PWA 在饿了么的实践经验</h3><p>（<a href="https://zhuanlan.zhihu.com/p/25800461）" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/25800461）</a></p>
<h3 id="PWA-案例网站"><a href="#PWA-案例网站" class="headerlink" title="PWA 案例网站"></a>PWA 案例网站</h3><p>（<a href="https://weatherpwa.baidu.com/）" target="_blank" rel="external">https://weatherpwa.baidu.com/）</a><br>（<a href="https://www.flipkart.com/）" target="_blank" rel="external">https://www.flipkart.com/）</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p70.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="FE综合" scheme="http://www.gcidea.info/categories/FE%E7%BB%BC%E5%90%88/"/>
    
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="PWA" scheme="http://www.gcidea.info/tags/PWA/"/>
    
      <category term="渐进式web应用" scheme="http://www.gcidea.info/tags/%E6%B8%90%E8%BF%9B%E5%BC%8Fweb%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>移动端HTML5响应式布局适配解决方案</title>
    <link href="http://www.gcidea.info/2017/01/25/mobile-flexible-solution/"/>
    <id>http://www.gcidea.info/2017/01/25/mobile-flexible-solution/</id>
    <published>2017-01-25T05:22:04.000Z</published>
    <updated>2017-02-16T03:15:04.792Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/blog-illustration-1.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　移动端适配是一个十分重要的问题。在移动端页面中，其布局和交互方式可能相比于PC端少一些，但是由于设备的多样化，其适配问题就必须多加关注。设备情况种类繁多复杂，从网上的几张图中足以看出：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-1.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-2.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-3.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-4.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-10.jpg" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-5.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-6.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-7.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-8.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-9.png" alt=""></p>
<hr>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="物理像素-physical-pixel"><a href="#物理像素-physical-pixel" class="headerlink" title="物理像素(physical pixel)"></a>物理像素(physical pixel)</h3><p>一个物理像素是显示器(手机屏幕)上最小的物理显示单元，在操作系统的调度下，每一个设备像素都有自己的颜色值和亮度值。</p>
<h3 id="设备独立像素-density-independent-pixel"><a href="#设备独立像素-density-independent-pixel" class="headerlink" title="设备独立像素(density-independent pixel)"></a>设备独立像素(density-independent pixel)</h3><p>设备独立像素(也叫密度无关像素)，可以认为是计算机坐标系统中得一个点，这个点代表一个可以由程序使用的虚拟像素(比如: css像素)，然后由相关系统转换为物理像素。可以理解为就是下面要说的逻辑像素。所以说，物理像素和设备独立像素之间存在着一定的对应关系，这就是接下来要说的设备像素比。</p>
<h3 id="设备像素比-device-pixel-ratio，即简称dpr"><a href="#设备像素比-device-pixel-ratio，即简称dpr" class="headerlink" title="设备像素比(device pixel ratio，即简称dpr)"></a>设备像素比(device pixel ratio，即简称dpr)</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-13.jpg" alt=""><br>设备像素比(简称dpr)定义了物理像素和设备独立像素的对应关系，它的值可以按如下的公式的得到：<br><code>设备像素比 = 物理像素 / 设备独立像素</code></p>
<ul>
<li>在javascript中，可以通过window.devicePixelRatio获取到当前设备的dpr。</li>
<li>在css中，可以通过-webkit-device-pixel-ratio，-webkit-min-device-pixel-ratio和 -webkit-max-device-pixel-ratio进行媒体查询，对不同dpr的设备，做一些样式适配(这里只针对webkit内核的浏览器和webview)。</li>
</ul>
<h3 id="viewport"><a href="#viewport" class="headerlink" title="viewport"></a>viewport</h3><p>通俗来讲，移动端的viewport就是我们所能看到的手机端浏览器的可视窗口大小，但viewport又不仅仅局限于可视窗口的大小，一般情况下，它是比默认窗口大小要大的，这是因为考虑到移动设备的分辨率相对于桌面电脑来说都比较小，所以为了能在移动端正常显示为桌面浏览器而设计的网页，移动端的浏览器都会默认把自己的默认的viewport设为980px到1024px不等，但其后果就是会出现横向滚动条，因为移动端浏览器可视区域的大小是比默认的viewport宽度要小的。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>该meta标签的作用是让当前viewport的宽度等于设备的宽度，同时不允许用户手动缩放。</p>
<h3 id="PPI-Pixels-Per-Inch"><a href="#PPI-Pixels-Per-Inch" class="headerlink" title="PPI(Pixels Per Inch)"></a>PPI(Pixels Per Inch)</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-11.png" alt=""><br>像素密度，这项指标是连接数字世界与物理世界的桥梁。Pixels per inch，准确的说是每英寸的长度上排列的像素点数量。1英寸是一个固定长度，等于2.54厘米，大约是食指最末端那根指节的长度。像素密度越高，代表屏幕显示效果越精细。Retina屏比普通屏清晰很多，就是因为它的像素密度翻了一倍。<br><img src="" alt=""></p>
<h3 id="DPI-Dots-Per-Inch"><a href="#DPI-Dots-Per-Inch" class="headerlink" title="DPI(Dots Per Inch)"></a>DPI(Dots Per Inch)</h3><p>每英寸所打印的点数，是打印机、鼠标等设备分辨率的单位。这是衡量打印机打印精度的主要参数之一，一般来说，该值越大，表明打印机的打印精度越高。dpi是指每英寸的像素，也就是扫描精度。国际上都是计算一平方英寸面积内像素的多少。</p>
<h3 id="倍率与逻辑像素"><a href="#倍率与逻辑像素" class="headerlink" title="倍率与逻辑像素"></a>倍率与逻辑像素</h3><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/flexible-12.png" alt=""><br>　　我们在css中声明的是逻辑像素值，而不同设备具体用多少物理像素进行显示有所不同。Retina屏幕把2x2个像素当1个像素使用。比如原本44像素高的顶部导航栏，在Retina屏上用了88个像素的高度来显示。导致界面元素都变成2倍大小，画质更清晰。iOS应用的资源图片中，同一张图通常有多个尺寸。你会看到文件名有的带@2x、@3x字样，有的不带。其中不带@2x、@3x的用在普通屏上，带@2x的用在Retina屏上(iPhone6等尺寸)，带@3x的也用在Retina屏上(iPhone6plus等尺寸)。只要图片准备好，iOS会自己判断用哪张，Android道理也一样。而在web app开发中，则需要自己对图片进行选择。苹果以普通屏为基准，给Retina屏定义了一个2倍或3倍的倍率。实际像素除以倍率，就得到逻辑像素尺寸。只要两个屏幕逻辑像素相同，它们的显示效果就是相同的。</p>
<hr>
<h2 id="依赖库-lib-flexible"><a href="#依赖库-lib-flexible" class="headerlink" title="依赖库 lib-flexible"></a>依赖库 lib-flexible</h2><hr>
<h2 id="使用实践"><a href="#使用实践" class="headerlink" title="使用实践"></a>使用实践</h2><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>1.npm包安装<br><code>npm install --save-dev lib-flexible</code><br>2.在基础js文件靠前位置引入包文件(ES6写法)<br><code>import &#39;lib-flexible&#39;;</code></p>
<h3 id="对于长度、宽度等“距离”的写法-less文件"><a href="#对于长度、宽度等“距离”的写法-less文件" class="headerlink" title="对于长度、宽度等“距离”的写法(less文件)"></a>对于长度、宽度等“距离”的写法(less文件)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@font-size-base: 75;</span><br><span class="line"></span><br><span class="line">.home &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 88rem / @font-size-base;</span><br><span class="line">  bottom: 98rem / @font-size-base;</span><br><span class="line">  width: 100%;</span><br><span class="line">  background-color: #ddd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对于文字字号大小的写法-less文件"><a href="#对于文字字号大小的写法-less文件" class="headerlink" title="对于文字字号大小的写法(less文件)"></a>对于文字字号大小的写法(less文件)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@font-size-base: 75;</span><br><span class="line">.name &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  font-family: @font-family-base;</span><br><span class="line">  color: #000000;</span><br><span class="line">  letter-spacing: 0;</span><br><span class="line">  font-size: 17px;</span><br><span class="line">  [data-dpr=&quot;2&quot;] &amp; &#123;</span><br><span class="line">    font-size: 34px;</span><br><span class="line">  &#125;</span><br><span class="line">  [data-dpr=&quot;3&quot;] &amp; &#123;</span><br><span class="line">    font-size: 51px;</span><br><span class="line">  &#125;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  padding-bottom: 20rem/@font-size-base</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="源码、原理分析"><a href="#源码、原理分析" class="headerlink" title="源码、原理分析"></a>源码、原理分析</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">win, lib</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> doc = win.document;</span><br><span class="line">    <span class="keyword">var</span> docEl = doc.documentElement;</span><br><span class="line">    <span class="keyword">var</span> metaEl = doc.querySelector(<span class="string">'meta[name="viewport"]'</span>);</span><br><span class="line">    <span class="keyword">var</span> flexibleEl = doc.querySelector(<span class="string">'meta[name="flexible"]'</span>);</span><br><span class="line">    <span class="keyword">var</span> dpr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> scale = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> tid;</span><br><span class="line">    <span class="keyword">var</span> flexible = lib.flexible || (lib.flexible = &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (metaEl) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">'将根据已有的meta标签来设置缩放比例'</span>);</span><br><span class="line">        <span class="keyword">var</span> match = metaEl.getAttribute(<span class="string">'content'</span>).match(<span class="regexp">/initial\-scale=([\d\.]+)/</span>);</span><br><span class="line">        <span class="keyword">if</span> (match) &#123;</span><br><span class="line">            scale = <span class="built_in">parseFloat</span>(match[<span class="number">1</span>]);</span><br><span class="line">            dpr = <span class="built_in">parseInt</span>(<span class="number">1</span> / scale);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flexibleEl) &#123;</span><br><span class="line">        <span class="keyword">var</span> content = flexibleEl.getAttribute(<span class="string">'content'</span>);</span><br><span class="line">        <span class="keyword">if</span> (content) &#123;</span><br><span class="line">            <span class="keyword">var</span> initialDpr = content.match(<span class="regexp">/initial\-dpr=([\d\.]+)/</span>);</span><br><span class="line">            <span class="keyword">var</span> maximumDpr = content.match(<span class="regexp">/maximum\-dpr=([\d\.]+)/</span>);</span><br><span class="line">            <span class="keyword">if</span> (initialDpr) &#123;</span><br><span class="line">                dpr = <span class="built_in">parseFloat</span>(initialDpr[<span class="number">1</span>]);</span><br><span class="line">                scale = <span class="built_in">parseFloat</span>((<span class="number">1</span> / dpr).toFixed(<span class="number">2</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (maximumDpr) &#123;</span><br><span class="line">                dpr = <span class="built_in">parseFloat</span>(maximumDpr[<span class="number">1</span>]);</span><br><span class="line">                scale = <span class="built_in">parseFloat</span>((<span class="number">1</span> / dpr).toFixed(<span class="number">2</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!dpr &amp;&amp; !scale) &#123;</span><br><span class="line">        <span class="keyword">var</span> isAndroid = win.navigator.appVersion.match(<span class="regexp">/android/gi</span>);</span><br><span class="line">        <span class="keyword">var</span> isIPhone = win.navigator.appVersion.match(<span class="regexp">/iphone/gi</span>);</span><br><span class="line">        <span class="keyword">var</span> devicePixelRatio = win.devicePixelRatio;</span><br><span class="line">        <span class="keyword">if</span> (isIPhone) &#123;</span><br><span class="line">            <span class="comment">// iOS下，对于2和3的屏，用2倍的方案，其余的用1倍方案</span></span><br><span class="line">            <span class="keyword">if</span> (devicePixelRatio &gt;= <span class="number">3</span> &amp;&amp; (!dpr || dpr &gt;= <span class="number">3</span>)) &#123;</span><br><span class="line">                dpr = <span class="number">3</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (devicePixelRatio &gt;= <span class="number">2</span> &amp;&amp; (!dpr || dpr &gt;= <span class="number">2</span>))&#123;</span><br><span class="line">                dpr = <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dpr = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 其他设备下，仍旧使用1倍的方案</span></span><br><span class="line">            dpr = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        scale = <span class="number">1</span> / dpr;</span><br><span class="line">    &#125;</span><br><span class="line">    docEl.setAttribute(<span class="string">'data-dpr'</span>, dpr);</span><br><span class="line">    <span class="keyword">if</span> (!metaEl) &#123;</span><br><span class="line">        metaEl = doc.createElement(<span class="string">'meta'</span>);</span><br><span class="line">        metaEl.setAttribute(<span class="string">'name'</span>, <span class="string">'viewport'</span>);</span><br><span class="line">        metaEl.setAttribute(<span class="string">'content'</span>, <span class="string">'initial-scale='</span> + scale + <span class="string">', maximum-scale='</span> + scale + <span class="string">', minimum-scale='</span> + scale + <span class="string">', user-scalable=no'</span>);</span><br><span class="line">        <span class="keyword">if</span> (docEl.firstElementChild) &#123;</span><br><span class="line">            docEl.firstElementChild.appendChild(metaEl);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> wrap = doc.createElement(<span class="string">'div'</span>);</span><br><span class="line">            wrap.appendChild(metaEl);</span><br><span class="line">            doc.write(wrap.innerHTML);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">refreshRem</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> width = docEl.getBoundingClientRect().width;</span><br><span class="line">        <span class="keyword">if</span> (width / dpr &gt; <span class="number">540</span>) &#123;</span><br><span class="line">            width = <span class="number">540</span> * dpr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> rem = width / <span class="number">10</span>;</span><br><span class="line">        docEl.style.fontSize = rem + <span class="string">'px'</span>;</span><br><span class="line">        flexible.rem = win.rem = rem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    win.addEventListener(<span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clearTimeout(tid);</span><br><span class="line">        tid = setTimeout(refreshRem, <span class="number">300</span>);</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">    win.addEventListener(<span class="string">'pageshow'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.persisted) &#123;</span><br><span class="line">            clearTimeout(tid);</span><br><span class="line">            tid = setTimeout(refreshRem, <span class="number">300</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (doc.readyState === <span class="string">'complete'</span>) &#123;</span><br><span class="line">        doc.body.style.fontSize = <span class="number">12</span> * dpr + <span class="string">'px'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            doc.body.style.fontSize = <span class="number">12</span> * dpr + <span class="string">'px'</span>;</span><br><span class="line">        &#125;, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    refreshRem();</span><br><span class="line"></span><br><span class="line">    flexible.dpr = win.dpr = dpr;</span><br><span class="line">    flexible.refreshRem = refreshRem;</span><br><span class="line">    flexible.rem2px = <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> val = <span class="built_in">parseFloat</span>(d) * <span class="keyword">this</span>.rem;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> d === <span class="string">'string'</span> &amp;&amp; d.match(<span class="regexp">/rem$/</span>)) &#123;</span><br><span class="line">            val += <span class="string">'px'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">    flexible.px2rem = <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> val = <span class="built_in">parseFloat</span>(d) / <span class="keyword">this</span>.rem;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> d === <span class="string">'string'</span> &amp;&amp; d.match(<span class="regexp">/px$/</span>)) &#123;</span><br><span class="line">            val += <span class="string">'rem'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>, <span class="built_in">window</span>[<span class="string">'lib'</span>] || (<span class="built_in">window</span>[<span class="string">'lib'</span>] = &#123;&#125;));</span><br></pre></td></tr></table></figure>
<h2 id="手淘团队相关文献参考"><a href="#手淘团队相关文献参考" class="headerlink" title="手淘团队相关文献参考"></a>手淘团队相关文献参考</h2><p><a href="https://github.com/amfe/article/issues/17" target="_blank" rel="external">使用Flexible实现手淘H5页面的终端适配 </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/blog-illustration-1.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;
    
    </summary>
    
      <category term="FE综合" scheme="http://www.gcidea.info/categories/FE%E7%BB%BC%E5%90%88/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="CSS/CSS3" scheme="http://www.gcidea.info/tags/CSS-CSS3/"/>
    
      <category term="HTML/HTML5" scheme="http://www.gcidea.info/tags/HTML-HTML5/"/>
    
      <category term="Less" scheme="http://www.gcidea.info/tags/Less/"/>
    
      <category term="响应式" scheme="http://www.gcidea.info/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>使用SwitchyOmega和Charles配置统一的开发和生产环境</title>
    <link href="http://www.gcidea.info/2017/01/23/uniform-development-product-env-switchyomega-charles/"/>
    <id>http://www.gcidea.info/2017/01/23/uniform-development-product-env-switchyomega-charles/</id>
    <published>2017-01-23T06:13:51.000Z</published>
    <updated>2017-02-11T06:17:42.791Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p111.jpg" alt=""></p>
<blockquote>
<p>本文是<a href="http://www.gcidea.info/2016/11/30/client-proxy-configurations/">客户端代理配置的几种常见方式</a>的一部分内容，主要针对SwitchyOmega和Charles两种工具。</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　代理服务器是开发过程中的常用工具。通过配置代理，可以统一线上线下环境，在开发阶段也访问线上地址，只不过将请求流量代理到本地服务器，这样便于调试。</p>
<hr>
<h2 id="Chrome插件SwitchyOmega"><a href="#Chrome插件SwitchyOmega" class="headerlink" title="Chrome插件SwitchyOmega"></a>Chrome插件SwitchyOmega</h2><p>　　该插件可以通过Chrome应用商店进行下载，典型的配置过程如下：<br>1.新建情景模式，选择“代理服务器”<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/switchy-3.png" alt=""><br>2.填写内容如下，也就是想要代理到的服务器地址和端口<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/switchy-1.png" alt=""><br>3.新建情景模式，选择“自动切换模式”<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/switchy-4.png" alt=""><br>4.根据项目需要配置响应的路由规则<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/switchy-2.png" alt=""></p>
<p>这样，在Chrome中调试时候选择“auto switch”，对于相应地址的请求就会根据规则进行转发<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/switchy-5.png" alt=""></p>
<hr>
<h2 id="Charles-Web-Debugging-Proxy"><a href="#Charles-Web-Debugging-Proxy" class="headerlink" title="Charles Web Debugging Proxy"></a>Charles Web Debugging Proxy</h2><p>　　有了SwitchyOmega，可以应对大部分使用场景。但是，考虑如下情况，SwitchyOmega就不能进行良好的配置了：</p>
<blockquote>
<p>线上地址不是根路径，也就是说除了域名、端口号外还有其他服务器上的相对路径。此时，SwitchyOmega会默认把相对路径拼接在代理到的本地服务器后面，然而，本地并不存在这个相对路径，因为本地就是启动在根路径下的，线上是因为一台服务器上可能并存多个项目部署时才具有项目的相对路径。</p>
</blockquote>
<p>　　面对这种情况，使用charles，因为它支持路径映射，也就是map remote功能，典型配置过程如下：<br>1.选择“proxy — proxy settings”做如下配置，这是charles服务器自身运行所在端口<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-1.png" alt=""><br>2.选择“tools — map remote settings”做如下配置，下面是概览，也就是根据业务需要进行的路由匹配<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-2.png" alt=""><br>3.第一条：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-3.png" alt=""><br>解释：<br>对于线上地址xxx.cn的/admin/ueditor资源的所有访问请求，不代理到本地，直接连接。<br>因为这些是第三方库的资源，不会有修改。<br>4.第二条：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-4.png" alt=""><br>解释：<br>对于线上地址xxx.cn的/admin/static资源的所有访问请求，同理，不代理到本地，直接连接。<br>因为这些是一些静态资源，不会有修改。<br>5.第三条：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-5.png" alt=""><br>解释：<br>对于线上地址xxx.cn的/admin的所有访问请求，是对于管理系统本身进行访问的，我们在开发过程中要随时查看修改情况，因此代理到本地。<br>6.第四条：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-6.png" alt=""><br>解释：<br>对于线上地址xxx.cn的/index.php的所有访问请求，是对于后台接口数据的请求，不是前端项目本身的内容，直接连接。<br>7.第五条：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-7.png" alt=""><br>解释：<br>对于线上地址xxx.cn的/的所有访问请求，也是对于所开发系统本身进行访问的（/admin是后台，/是客户端），我们在开发过程中要随时查看修改情况，因此代理到本地。<br>8.效果查看：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/charles-8.png" alt=""><br>可以看到，针对远程线上的css文件的请求，已经被成功代理到本地服务器运行所在端口（9989）</p>
<p><strong>注</strong>：要注意以上匹配规则的先后顺序，后面的不要被前面的覆盖。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p111.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本文是&lt;a href=&quot;http://www.gcidea.info/2016/11/30/clien
    
    </summary>
    
      <category term="搭建部署" scheme="http://www.gcidea.info/categories/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/"/>
    
      <category term="环境统一" scheme="http://www.gcidea.info/categories/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/%E7%8E%AF%E5%A2%83%E7%BB%9F%E4%B8%80/"/>
    
    
      <category term="搭建部署" scheme="http://www.gcidea.info/tags/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/"/>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="SwitchyOmega" scheme="http://www.gcidea.info/tags/SwitchyOmega/"/>
    
      <category term="Charles" scheme="http://www.gcidea.info/tags/Charles/"/>
    
  </entry>
  
  <entry>
    <title>React开发框架Dva.js项目结构简单小结</title>
    <link href="http://www.gcidea.info/2017/01/20/react-dva-structure/"/>
    <id>http://www.gcidea.info/2017/01/20/react-dva-structure/</id>
    <published>2017-01-20T05:54:23.000Z</published>
    <updated>2017-02-11T06:08:26.813Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p101.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　本篇简单对Dva.js项目的工程结构进行说明，具体的概念，设计，文档，详见<a href="https://github.com/dvajs/dva/blob/master/README_zh-CN.md" target="_blank" rel="external">Dva.js官网</a></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/dva-structure.png" alt=""></p>
<hr>
<h3 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h3><p>属于前后端分离的一种实践，在后端接口未完全实现时，前端可通过mock数据的方式自测。</p>
<hr>
<h3 id="node-modules"><a href="#node-modules" class="headerlink" title="node_modules"></a>node_modules</h3><p>项目依赖采用npm管理，所以来包均在此目录。</p>
<hr>
<h3 id="src"><a href="#src" class="headerlink" title="src"></a>src</h3><h4 id="assets"><a href="#assets" class="headerlink" title="assets"></a>assets</h4><p>项目静态资源目录（图片等）</p>
<h4 id="components"><a href="#components" class="headerlink" title="components"></a>components</h4><p>无状态组件目录。根据react组件化的要求，该目录下的组件是根据具体业务逻辑进行合理划分，细粒度的无状态组件，业务相关的state交付上层容器组件管理。（当然，在具体实践中，该目录下的组件也可以维护少量的仅组件内部使用的状态，不涉及与后端的业务逻辑交互）</p>
<h4 id="configs"><a href="#configs" class="headerlink" title="configs"></a>configs</h4><p>配置文件目录。项目中可能会有一些配置项，统一写在这里方便管理。</p>
<h4 id="models"><a href="#models" class="headerlink" title="models"></a>models</h4><p>状态model目录。项目所有状态管理均在此目录。对应是redux概念中的store。</p>
<h4 id="routes"><a href="#routes" class="headerlink" title="routes"></a>routes</h4><p>路由配置目录。路由是单页应用中的重要概念。这里统一配置整个项目的所有路由状态。</p>
<h4 id="services"><a href="#services" class="headerlink" title="services"></a>services</h4><p>services层目录。这里就是一个“服务”层，负责对后端接口数据的请求和处理。在这里主要可以做两件事：<br>1.发出异步请求（此处不是直接发出，而是调用了下面的utils层的工具，为的是便于管理http全局状态）<br>2.对该接口返回的数据做数据适配adaptor，因为后端接口的数据格式、字段名等往往不一定与前端对应，便可以在这里对其做数据适配。</p>
<h4 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h4><p>工具函数层。主要是异步请求，全局http状态管理等全局公用的函数工具。</p>
<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><p>单页应用的入口html。整个工程仅这一个html文件。</p>
<h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h4><p>单页应用入口js。在这里进行dva项目的初始化。可配置全局使用的history类型，接入日志等中间件，做好全局错误状态的拦截，引入上述routes的路由文件，引入项目所有model状态文件，最后启动整个应用。</p>
<h4 id="index-less"><a href="#index-less" class="headerlink" title="index.less"></a>index.less</h4><p>全局通用样式配置。典型的有，对body html等元素的margin padding 做统一处理（设置为0，由于这些元素有默认margin padding，防止对后续样式设计产生影响）。</p>
<h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h4><p>全局路由状态管理目录。在这里对整个应用的跳转关系进行设置。可以在某个路由上设置进入、离开等钩子函数，做出相应逻辑。</p>
<hr>
<h3 id="editorconfig"><a href="#editorconfig" class="headerlink" title=".editorconfig"></a>.editorconfig</h3><p>编辑器统一设置，比如缩进方式等。</p>
<h3 id="eslintignore"><a href="#eslintignore" class="headerlink" title=".eslintignore"></a>.eslintignore</h3><p>.eslintignore ,如同 .gitignore 一样忽略对于某些文件，文件夹的检查。</p>
<h3 id="eslintrc"><a href="#eslintrc" class="headerlink" title=".eslintrc"></a>.eslintrc</h3><p>代码风格检查文件。</p>
<h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>git版本管理忽略文件，对这里设置的目录不作为代码库的管理内容，推荐使用<a href="https://github.com/github/gitignore" target="_blank" rel="external">github上的gitignore项目的统一配置</a>，比较全面。</p>
<h3 id="gitlab-ci-yml"><a href="#gitlab-ci-yml" class="headerlink" title=".gitlab-ci.yml"></a>.gitlab-ci.yml</h3><p>项目CI持续集成配置文件</p>
<h3 id="npm-debug-log"><a href="#npm-debug-log" class="headerlink" title="npm-debug.log"></a>npm-debug.log</h3><p>npm日志</p>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>npm包管理文件</p>
<h3 id="proxy-config-js"><a href="#proxy-config-js" class="headerlink" title="proxy.config.js"></a>proxy.config.js</h3><p>项目开发测试服务器dora配置文件</p>
<h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><p>webpack打包工具配置文件</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p101.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;
    
    </summary>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
    
      <category term="前端框架" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
      <category term="实现/应用" scheme="http://www.gcidea.info/tags/%E5%AE%9E%E7%8E%B0-%E5%BA%94%E7%94%A8/"/>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="React" scheme="http://www.gcidea.info/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>git merge 与 git rebase 的对比分析</title>
    <link href="http://www.gcidea.info/2017/01/17/git-merge-git-rebase/"/>
    <id>http://www.gcidea.info/2017/01/17/git-merge-git-rebase/</id>
    <published>2017-01-17T13:45:08.000Z</published>
    <updated>2017-02-11T05:25:34.061Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p46.jpg" alt=""></p>
<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><p>　　以下概念和示例参考<a href="http://blog.csdn.net/wh_19910525/article/details/7554489" target="_blank" rel="external">http://blog.csdn.net/wh_19910525/article/details/7554489</a></p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>假设现在基于远程分支”origin”，创建一个叫”mywork”的分支。<br><code>$ git checkout -b mywork origin</code><br>假设远程分支”origin”已经有了2个提交，那么新创建的mywork分支在现在未修改的状态下是和origin具有相同指向的。如图<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-1.jpg" alt=""><br>现在我们在这个分支做一些修改，然后生成两个提交(commit)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vi file.txt</span><br><span class="line">$ git commit</span><br><span class="line">$ vi otherfile.txt</span><br><span class="line">$ git commit</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>但是与此同时，有些人也在”origin”分支上做了一些修改并且做了提交了. 这就意味着”origin”和”mywork”这两个分支各自”前进”了，它们之间”分叉”了。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-2.jpg" alt=""><br>在这里，你可以用”pull”命令把”origin”分支上的修改拉下来并且和你的修改合并； 结果看起来就像一个新的”合并的提交”(merge commit)。而具体合并的方式，则有以下要说的git merge 与 git rebase两种。</p>
<h3 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a>git merge</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将b分支合并到当前分支</span><br><span class="line">git merge b</span><br></pre></td></tr></table></figure>
<p>　　git merge有很多参数，可通过<code>git merge --help</code>查看其命令。关于其详细使用，可参考<a href="http://blog.csdn.net/hudashi/article/details/7664382" target="_blank" rel="external">http://blog.csdn.net/hudashi/article/details/7664382</a><br>　　经过merge合并的分支示意如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-3.jpg" alt="">
　　</p>
<h3 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h3><p>如果想让”mywork”分支历史看起来像没有经过任何合并一样（没有上边的“diamond shape”），也许可以用 git rebase:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将b分支合并到当前分支</span><br><span class="line">git rebase b</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout mywork</span><br><span class="line">$ git rebase origin</span><br></pre></td></tr></table></figure>
<p>这些命令会把你的”mywork”分支里的每个提交(commit)取消掉，并且把它们临时 保存为补丁(patch)(这些补丁放到”.git/rebase”目录中),然后把”mywork”分支更新 为最新的”origin”分支，最后把保存的这些补丁应用到”mywork”分支上。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-4.jpg" alt=""><br>当’mywork’分支更新之后，它会指向这些新创建的提交(commit),而那些老的提交会被丢弃。 如果运行垃圾收集命令(pruning garbage collection), 这些被丢弃的提交就会删除.<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-5.jpg" alt=""><br>在rebase的过程中，也许会出现冲突(conflict)。在这种情况，Git会停止rebase并会让你去解决冲突；在解决完冲突后，用”git-add”命令去更新这些内容的索引(index), 然后，你无需执行 git-commit,只要执行:<br><code>$ git rebase --continue</code><br>git会继续应用(apply)余下的补丁。<br>在任何时候，你可以用–abort参数来终止rebase的行动，并且”mywork” 分支会回到rebase开始前的状态。<br><code>$ git rebase --abort</code></p>
<h3 id="git-merge-与-git-rebase的区别和适用场景"><a href="#git-merge-与-git-rebase的区别和适用场景" class="headerlink" title="git merge 与 git rebase的区别和适用场景"></a>git merge 与 git rebase的区别和适用场景</h3><ul>
<li>区别<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-6.jpg" alt=""></li>
</ul>
<p>当我们使用Git log来参看commit时，其commit的顺序也有所不同。<br>假设C3提交于9:00AM,C5提交于10:00AM,C4提交于11:00AM，C6提交于12:00AM,<br>对于使用git merge来合并所看到的commit的顺序（从新到旧）是：C7 ,C6,C4,C5,C3,C2,C1<br>对于使用git rebase来合并所看到的commit的顺序（从新到旧）是：C7 ,C6‘,C5’,C4,C3,C2,C1<br> 因为C6’提交只是C6提交的克隆，C5’提交只是C5提交的克隆，从用户的角度看使用git rebase来合并后所看到的commit的顺序（从新到旧）是：C7 ,C6,C5,C4,C3,C2,C1 </p>
<p>　　对于两个分支而言，rebase和merge没有区别，但是rebase更干净，因为log hisitory是线性的，但commit不一定按日期先后排，而是local commit总在后面,merge之后history变得比较复杂，但是commit按日期排序<br>　　更多地，stackoverflow上对两者的区别有很好的回答：<br><a href="http://stackoverflow.com/questions/16666089/whats-the-difference-between-Git-merge-and-git-rebase" target="_blank" rel="external">What’s the difference between ‘git merge’ and ‘git rebase’?</a></p>
<ul>
<li>适用场景<br>可参考<a href="http://blog.csdn.net/rryqsh/article/details/8230560" target="_blank" rel="external">http://blog.csdn.net/rryqsh/article/details/8230560</a></li>
</ul>
<hr>
<h2 id="实际测试"><a href="#实际测试" class="headerlink" title="实际测试"></a>实际测试</h2><h3 id="git-merge的过程"><a href="#git-merge的过程" class="headerlink" title="git merge的过程"></a>git merge的过程</h3><p>　　根据以上概念和示例，做如下测试：<br>1.新建文件夹并初始化为git仓库<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-8.png" alt=""></p>
<p>2.默认是master分支，先在这个分支上做一次修改并commit，否则git不会真正创建master分支（git branch -a命令结果为空）<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-9.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-10.png" alt=""><br>使用git log查看历史，只有一次提交，符合预期。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-11.png" alt=""></p>
<p>3.切换分支dev，在dev分支上对同一个文件进行修改（制造冲突的地方，观察合并效果）后commit<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-12.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-13.png" alt=""><br>使用git log查看历史，有2次提交，一次是master分支的，一次是dev分支自己的，符合预期。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-14.png" alt=""></p>
<p>4.切换回master分支，在master分支上对同一个文件进行第二次修改后commit。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-15.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-16.png" alt=""><br>使用git log查看历史，有2次master上的提交，符合预期。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-17.png" alt=""></p>
<p>5.在master分支上合并（git merge）dev的内容，会出现冲突，如下所示<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-18.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-19.png" alt=""></p>
<p>6.解决冲突后，在master上再次commit<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-20.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-21.png" alt=""></p>
<p>7.使用git log观察历史版本情况<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-22.png" alt=""></p>
<p>可以看出，将dev分支合并过来以后，dev分支上的历史记录也是被合并过来了的。并且，所有commit记录的顺序严格遵守时间先后。</p>
<h3 id="git-rebase的过程"><a href="#git-rebase的过程" class="headerlink" title="git rebase的过程"></a>git rebase的过程</h3><p>1-4地步骤与git merge中的相同，都是为了构造两个分支并模拟冲突情况，不再重复（但是是创建的全新文件夹，内容上与上面没有重复），下面从第五步合并使用git rebase开始。</p>
<p>5..在master分支上合并（git rebase）dev的内容，会出现冲突，如下所示<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-23.png" alt=""><br>可以看到提示我们由于冲突rebase过程暂时停止，并且patch文件保存在.git\rebase-apply，查看其内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/test.txt b/test.txt</span><br><span class="line">index 3dd79bb0b2a0e259cfac50c354f16a537c8217b9..d9180eaac8dd0a81ba9cad1e08a69a0ebd0d6646 100644</span><br><span class="line">--- a/test.txt</span><br><span class="line">+++ b/test.txt</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-master:edit-1</span><br><span class="line">+master:edit-1///master:edit-2</span><br></pre></td></tr></table></figure></p>
<p>根据提示在冲突解决完成后使用git rebase –continue继续合并过程</p>
<p>6.手动解决冲突后使用git rebase –continue继续合并<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-24.png" alt=""></p>
<p>发现提示我们在解决完成后要使用git add命令将其标记为解决。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-25.png" alt=""></p>
<p>7.git add后继续git rebase –continue<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-26.png" alt=""></p>
<p>8.使用git log查看历史<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/merge-rebase-27.png" alt=""></p>
<p>可以看到，在文件操作完全相同的情况下，与git merge的历史相比，所合并的dev分支只保留了一次在dev分支上最新的提交记录（将其合并进master分支，由于本例在dev上只commit了一次，没有明显看出）。这样，提交记录就是线性的了。并且，我们可以明显看到，使用git rebase进行合并的时候不会产生新的commit（对应git merge中的那次“resolve conflict”）</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p46.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;相关概念&quot;&gt;&lt;a href=&quot;#相关概念&quot; class=&quot;headerlink&quot; title=&quot;相关概念&quot;&gt;&lt;/a&gt;相关
    
    </summary>
    
      <category term="FE综合" scheme="http://www.gcidea.info/categories/FE%E7%BB%BC%E5%90%88/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="版本控制" scheme="http://www.gcidea.info/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中比较运算的详细总结</title>
    <link href="http://www.gcidea.info/2017/01/12/js-compare/"/>
    <id>http://www.gcidea.info/2017/01/12/js-compare/</id>
    <published>2017-01-12T14:11:06.000Z</published>
    <updated>2017-02-11T05:25:56.758Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p77.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　在javascript开发中，比较操作是十分常见的。由于显式/隐式强制类型转换机制的存在，我们在使用比较运算时显得过于随意，也许表面上看并没有什么错误（比如在if()语句中判断两值相等时顺手就写成 == ），但是这可能会埋下很多不易发现的隐患。对于比较操作（相等关系和不等关系），在javascript中其实是有一套完善的机制的。本文依据ES5规范<strong>《ECMAScript Language Specification ECMA-262<br>5.1 Edition / June 2011》</strong>的11.8节和11.9节：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/ecma-relational-equality-operator.png" alt=""></p>
<p>对javascript中比较操作相关内容进行系统总结。</p>
<hr>
<h2 id="相等比较"><a href="#相等比较" class="headerlink" title="相等比较"></a>相等比较</h2><h3 id="严格相等"><a href="#严格相等" class="headerlink" title="严格相等"></a>严格相等</h3><p>　　严格相等指“===”，它<strong>不允许比较双方进行强制类型转换</strong>。因此，问题考虑变得简单，对于<code>x === y</code>，javascript引擎在进行判断时所遵循的算法如下：</p>
<ol>
<li>如果x和y的数据类型不同，返回false。</li>
<li>如果x是undefined，返回true。</li>
<li>如果x是null，返回true。</li>
<li>如果x是number类型：<br>　4.1 如果x是NaN，返回false。<br>　4.2 如果y是NaN，返回false。<br>　4.3 如果x和y的值相等，返回true。<br>　4.4 如果x是+0，y是-0，返回true。<br>　4.5 如果x是-0，y是+0，返回true。<br>　4.6 否则，返回false。</li>
<li>如果x是string类型，如果x和y是长度相等且对应位置上字符相同的序列，返回true；否则返回false。</li>
<li>如果x是Boolean类型，如果x和y均为true或者x和y均为false，返回true；否则，返回false。</li>
<li>如果x是对象（普通对象，函数，数组等），那么如果x和y指向同一个对象（是内存中同一个对象的引用），返回true；否则，返回false。</li>
</ol>
<hr>
<h3 id="宽松相等"><a href="#宽松相等" class="headerlink" title="宽松相等"></a>宽松相等</h3><p>　　宽松相等指“==”，它<strong>会对比较双方进行隐式强制类型转换</strong>。下面先根据ES5规范进行系统说明：</p>
<ol>
<li>如果x和y的数据类型相同：<br>　1.1 如果x的类型是undefined，返回true。<br>　1.2 如果x的类型是null，返回true。<br>　1.3 如果x的类型是number：<br>　　1.3.1 如果x是NaN，返回false。<br>　　1.3.2 如果y是NaN，返回false。<br>　　1.3.3 如果x和y的值相同，返回true。<br>　　1.3.4 如果x是+0，y是-0，返回true。<br>　　1.3.5 如果x是-0，y是+0，返回true。<br>　　1.3.6 否则，返回false。<br>　1.4 如果x是string类型，如果x和y是长度相等且对应位置上字符相同的序列，返回true；否则返回false。<br>　1.5 如果x是Boolean类型，如果x和y均为true或者x和y均为false，返回true；否则，返回false。<br>　1.6 如果x是对象（普通对象，函数，数组等），那么如果x和y指向同一个对象（是内存中同一个对象的引用），返回true；否则，返回false。</li>
<li>如果x是null，y是undefined，返回true。</li>
<li>如果x是undefined，y是null，返回true。</li>
<li>如果x是number类型，y是string类型，则对y进行类型转换，转换为number类型，返回 x == ToNumber(y) 的结果（参见上述1.3）。</li>
<li>如果x是string类型，y是number类型，则对x进行类型转换，转换为number类型，返回 ToNumber(x) == y 的结果（参见上述1.3）。</li>
<li>如果x是Boolean类型，则对x进行类型转换，转换为number类型，返回 ToNumber(x) == y 的结果（此时y的类型还是不确定的，应将其转换为number类型后进行比较）。</li>
<li>如果y是Boolean类型，则对y进行类型转换，转换为number类型，返回 x == ToNumber(y) 的结果（此时x的类型还是不确定的，应将其转换为number类型后进行比较）。</li>
<li>如果x是string类型或者number类型，y是一个对象（普通对象，函数，数组等），则对y进行类型转换—使用内置的[[ToPrimitive]]方法转换（该方法简单来说，就是先调用该对象上的<code>valueOf()</code>方法，如果有该方法且返回基本类型值，就使用该值进行强制类型转换；如果不存在，就调用该对象上的<code>toString()</code>方法，如果有该方法，就使用其返回值来进行强制类型转换；如果这两个方法都不存在，就产生TypeError错误。），返回 x == ToPrimitive(y) 的结果。</li>
<li>如果x是一个对象（普通对象，函数，数组等），y是string类型或者number类型，则对x进行类型转换—使用内置的[[ToPrimitive]]，返回 ToPrimitive(x) == y 的结果。</li>
<li>否则（非上述所有情况），返回false。</li>
</ol>
<blockquote>
<p>注：针对以上10条有几点注意事项：<br>1.对a,b强制按字符串string类型进行比较，可采用如下方法：<br><code>&quot;&quot; + a == &quot;&quot; + b</code></p>
<p>2.对a,b强制按数字number类型进行比较，可采用如下方法：<br><code>+a == +b</code></p>
<p>3.对a,b强制按布尔值boolean类型进行比较，可采用如下方法：<br><code>!!a == !!b</code></p>
<p>4.相等比较操作有以下恒等性：</p>
<ul>
<li>A != B 等价于 !(A == B)</li>
<li>A == B 等价于 B == A (除非A B有顺序上的互相计算关系)</li>
</ul>
<p>5.相等操作并不是总具有传递性。<br>new String(“a”) == “a” 和 “a” == new String(“a”) 结果都返回true；<br>new String(“a”) == new String(“a”) 却返回false。<br>因为new String(“a”)是一个对象，按照上述规则会被转换为”a”，因此相等；而new String(“a”) == new String(“a”)，==左右两边是两个不同的对象，在内存中位于不同地址，因此结果返回false。</p>
</blockquote>
<hr>
<p>由于强制类型转换的存在，宽松相等的情况变得复杂，比较容易出现问题的有以下几种：</p>
<h4 id="更改内置原生原型后的相等比较"><a href="#更改内置原生原型后的相等比较" class="headerlink" title="更改内置原生原型后的相等比较"></a>更改内置原生原型后的相等比较</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.prototype.valueOf = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">2</span>) == <span class="number">3</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>这只是为了说明这种情况的存在，应该不会有人这么去改原型上的方法。</p>
<h4 id="假值的相等比较"><a href="#假值的相等比较" class="headerlink" title="假值的相等比较"></a>假值的相等比较</h4><p>这部分应该是比较复杂的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"0"</span> == <span class="literal">null</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="string">"0"</span> == <span class="literal">undefined</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="string">"0"</span> == <span class="literal">false</span>;			</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="string">"0"</span> == <span class="literal">NaN</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="string">"0"</span> == <span class="number">0</span>;			</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="string">"0"</span> == <span class="string">""</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="literal">false</span> == <span class="literal">null</span>;		</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="literal">false</span> == <span class="literal">undefined</span>;	</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="literal">false</span> == <span class="literal">NaN</span>;		</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="literal">false</span> == <span class="number">0</span>;			</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">""</span>;		</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="literal">false</span> == [];		</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="literal">false</span> == &#123;&#125;;		</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="string">""</span> == <span class="literal">null</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="string">""</span> == <span class="literal">undefined</span>;	</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="string">""</span> == <span class="literal">NaN</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="string">""</span> == <span class="number">0</span>;			</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="string">""</span> == [];			</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="string">""</span> == &#123;&#125;;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> == <span class="literal">null</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">undefined</span>;		</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">NaN</span>;			</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line"><span class="number">0</span> == [];			</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line"><span class="number">0</span> == &#123;&#125;;			</span><br><span class="line"><span class="comment">//false</span></span><br></pre></td></tr></table></figure></p>
<p>解释如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"0"</span> == <span class="literal">null</span>;  		</span><br><span class="line"><span class="comment">//false：null转换为"null"</span></span><br><span class="line"><span class="string">"0"</span> == <span class="literal">undefined</span>;   </span><br><span class="line"><span class="comment">//false：undefined转换为"undefined"</span></span><br><span class="line"><span class="string">"0"</span> == <span class="literal">false</span>;  		</span><br><span class="line"><span class="comment">//true：false转换为0；"0"转换为0</span></span><br><span class="line"><span class="string">"0"</span> == <span class="literal">NaN</span>;         </span><br><span class="line"><span class="comment">//false：NaN转换为"NaN"</span></span><br><span class="line"><span class="string">"0"</span> == <span class="number">0</span>; 			</span><br><span class="line"><span class="comment">//true："0"转换为0</span></span><br><span class="line"><span class="string">"0"</span> == <span class="string">""</span>; 			</span><br><span class="line"><span class="comment">//false：都是字符串，值不同</span></span><br><span class="line"></span><br><span class="line"><span class="literal">false</span> == <span class="literal">null</span>; 		</span><br><span class="line"><span class="comment">//false：false转换为0；null转换为"null"，进而转换为数字，得到NaN</span></span><br><span class="line"><span class="literal">false</span> == <span class="literal">undefined</span>; </span><br><span class="line"><span class="comment">//false：false转换为0；undefined转换为"undefined"，进而转换为数字，得到NaN</span></span><br><span class="line"><span class="literal">false</span> == <span class="literal">NaN</span>; 		</span><br><span class="line"><span class="comment">//false：false转换为0；与NaN不同</span></span><br><span class="line"><span class="literal">false</span> == <span class="number">0</span>; 		</span><br><span class="line"><span class="comment">//true：false转换为0</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">""</span>; 		</span><br><span class="line"><span class="comment">//true：false转换为0；""转换为0</span></span><br><span class="line"><span class="literal">false</span> == []; 		</span><br><span class="line"><span class="comment">//true：false转换为0；[]转换为0</span></span><br><span class="line"><span class="literal">false</span> == &#123;&#125;; 		</span><br><span class="line"><span class="comment">//false：false转换为0；&#123;&#125;转换为NaN</span></span><br><span class="line"></span><br><span class="line"><span class="string">""</span> == <span class="literal">null</span>; 		</span><br><span class="line"><span class="comment">//false：""转换为0；null转换为"null"，进而转换为数字，得到NaN</span></span><br><span class="line"><span class="string">""</span> == <span class="literal">undefined</span>; 	</span><br><span class="line"><span class="comment">//false：""转换为0；undefined转换为"undefined"，进而转换为数字，得到NaN</span></span><br><span class="line"><span class="string">""</span> == <span class="literal">NaN</span>; 			</span><br><span class="line"><span class="comment">//false：""转换为0；与NaN不同</span></span><br><span class="line"><span class="string">""</span> == <span class="number">0</span>; 			</span><br><span class="line"><span class="comment">//true：""转换为0</span></span><br><span class="line"><span class="string">""</span> == []; 			</span><br><span class="line"><span class="comment">//true：""转换为0；[]转换为0</span></span><br><span class="line"><span class="string">""</span> == &#123;&#125;; 			</span><br><span class="line"><span class="comment">//false：""转换为0；&#123;&#125;转换为NaN</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> == <span class="literal">null</span>; 			</span><br><span class="line"><span class="comment">//false：null转换为"null"，进而转换为数字，得到NaN</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">undefined</span>; 	</span><br><span class="line"><span class="comment">//false：undefined转换为"undefined"，进而转换为数字，得到NaN</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">NaN</span>; 			</span><br><span class="line"><span class="comment">//false：0与NaN不同</span></span><br><span class="line"><span class="number">0</span> == []; 			</span><br><span class="line"><span class="comment">//true：[]转换为0</span></span><br><span class="line"><span class="number">0</span> == &#123;&#125;; 			</span><br><span class="line"><span class="comment">//false：&#123;&#125;转换为NaN</span></span><br></pre></td></tr></table></figure></p>
<h4 id="一些极端情况"><a href="#一些极端情况" class="headerlink" title="一些极端情况"></a>一些极端情况</h4><p>a. [] == ![]; //true<br>　　[]被转换为0，![]被转换为false，进而被转换为0。<br>b. 2 == [2];  //true<br>　　[2]调用数组的<code>valueOf()</code>方法，返回”2”，进而被转换为2。<br>c. “” == [null]; //true<br>　　[null]调用数组的<code>valueOf()</code>方法，进而调用<code>toString()</code>方法，返回””。
　　</p>
<hr>
<h3 id="一些选用的原则"><a href="#一些选用的原则" class="headerlink" title="一些选用的原则"></a>一些选用的原则</h3><ol>
<li>如果==两边有true或者false（指本身，不是经过类型转换以后的），绝对不使用==。</li>
<li>如果==两边有[]，””，0，尽量不使用==。</li>
<li>==和===选取哪一个取决于是否允许比较双方进行强制类型转换。</li>
<li>不应该一味地使用===来避免考虑这些可能的问题，因为有时候隐式类型转换可以让代码更加简洁，只要用的对。‘</li>
<li><code>typeof x == &quot;function&quot;</code>、<code>typeof x ！= &quot;undefined&quot;</code>这样的用法是完全正确且安全的，开发中也常用。</li>
</ol>
<hr>
<h3 id="经典的相等比较关系图"><a href="#经典的相等比较关系图" class="headerlink" title="经典的相等比较关系图"></a>经典的相等比较关系图</h3><p>GitHub上有一个经典的比较关系图，<a href="http://dorey.github.io/JavaScript-Equality-Table/" target="_blank" rel="external">http://dorey.github.io/JavaScript-Equality-Table/</a>，以表格的形式系统总结了宽松相等==，严格相等===，if()条件语句中使用不同数据类型对应的结果，很有意义：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-equality-table-1.png" alt=""></p>
<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-equality-table-2.png" alt=""></p>
<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-equality-table-3.png" alt=""></p>
<hr>
<h2 id="不等比较"><a href="#不等比较" class="headerlink" title="不等比较"></a>不等比较</h2><h3 id="和"><a href="#和" class="headerlink" title="!= 和 !=="></a>!= 和 !==</h3><p>　　只要搞清楚上面详细描述的==和===，对应取反即可。</p>
<h3 id="gt-lt-gt-lt"><a href="#gt-lt-gt-lt" class="headerlink" title="&gt;  &lt;  &gt;=  &lt;="></a>&gt;  &lt;  &gt;=  &lt;=</h3><blockquote>
<p>这些比较的基础是 x &lt; y:</p>
<p>x &lt; y会返回true或者false或者undefined。如果返回undefined，说明x,y两者至少有一个是NaN。比较算法中需要使用一个布尔值的标记LeftFirst作为参数。这个参数的作用是控制可能具有副作用的操作作用于x和y的顺序。这个标志是有必要的，因为在ECMAScript指定了从左到右的运算顺序，LeftFirst的默认值是true，表示x的表达式是在y的表达式左边的。如果LeftFirst值为false，情况相反，表明关于y的操作必须先于x进行。据此，比较操作规则如下：</p>
<ol>
<li>如果LeftFirst值为true：<br>　1.1 ToPrimitive(x, hint Number)的结果记为px<br>　1.2 ToPrimitive(y, hint Number)的结果记为py</li>
<li>否则，运算顺序改为从右向左：<br>　2.1 ToPrimitive(y, hint Number)的结果记为py<br>　2.2 ToPrimitive(x, hint Number)的结果记为px</li>
<li>经过如上转换，如果px和py至少有一个的类型不为string：<br>　3.1 ToNumber(px)的结果记为nx<br>　3.2 ToNumber(py)的结果记为ny<br>　3.3 如果nx是NaN，返回undefined<br>　3.4 如果ny是NaN，返回undefined<br>　3.5 如果nx和ny的值相同，返回false<br>　3.6 如果nx是+0，ny是-0，返回false<br>　3.7 如果nx是-0，ny是+0，返回false<br>　3.8 如果nx是+Infinity，返回false<br>　3.9 如果ny是+Infinity，返回true<br>　3.10 如果ny是-Infinity，返回false<br>　3.11 如果nx是-Infinity，返回true<br>　3.12 如果nx的值小于ny，返回true；否则，返回false</li>
<li>如果px和py都是string：<br>　4.1 如果py是px的前缀，返回false<br>　4.2 如果px是py的前缀，返回true<br>　4.3 设置变量k，k表示px和py对应位上出现不同值时，位置的索引。<br>　4.4 记px的位置k上的字母对应的字符编码值为m<br>　4.5 记py的位置k上的字母对应的字符编码值为n<br>　4.6 如果m &lt; n，返回true；否则返回false</li>
</ol>
</blockquote>
<p>因此，&gt;  &lt;  &gt;=  &lt;=就有如下的规则：
　</p>
<h4 id="RelationalExpression-gt-ShiftExpression"><a href="#RelationalExpression-gt-ShiftExpression" class="headerlink" title="RelationalExpression &gt; ShiftExpression"></a>RelationalExpression &gt; ShiftExpression</h4><ol>
<li>记lref为RelationalExpression的运算结果值。</li>
<li>记lval为lref类型转换后获取的value值。</li>
<li>记rref为ShiftExpression的运算结果值。</li>
<li>记rval为rref类型转换后获取的value值。</li>
<li>设LeftFirst为false，将rval &lt; lval按照上述规则进行运算，结果为r。</li>
<li>如果r是undefined返回false，否则返回r。</li>
</ol>
<h4 id="RelationalExpression-lt-ShiftExpression"><a href="#RelationalExpression-lt-ShiftExpression" class="headerlink" title="RelationalExpression &lt; ShiftExpression"></a>RelationalExpression &lt; ShiftExpression</h4><ol>
<li>记lref为RelationalExpression的运算结果值。</li>
<li>记lval为lref类型转换后获取的value值。</li>
<li>记rref为ShiftExpression的运算结果值。</li>
<li>记rval为rref类型转换后获取的value值。</li>
<li>将lval &lt; rval按照上述规则进行运算，结果为r。</li>
<li>如果r是undefined返回false，否则返回r。</li>
</ol>
<h4 id="RelationalExpression-gt-ShiftExpression-1"><a href="#RelationalExpression-gt-ShiftExpression-1" class="headerlink" title="RelationalExpression &gt;= ShiftExpression"></a>RelationalExpression &gt;= ShiftExpression</h4><ol>
<li>记lref为RelationalExpression的运算结果值。</li>
<li>记lval为lref类型转换后获取的value值。</li>
<li>记rref为ShiftExpression的运算结果值。</li>
<li>记rval为rref类型转换后获取的value值。</li>
<li>设LeftFirst为false，将rval &lt; lval按照上述规则进行运算，结果为r。</li>
<li>如果r是true或者undefined返回false，否则返回true。</li>
</ol>
<h4 id="RelationalExpression-lt-ShiftExpression-1"><a href="#RelationalExpression-lt-ShiftExpression-1" class="headerlink" title="RelationalExpression &lt;= ShiftExpression"></a>RelationalExpression &lt;= ShiftExpression</h4><ol>
<li>记lref为RelationalExpression的运算结果值。</li>
<li>记lval为lref类型转换后获取的value值。</li>
<li>记rref为ShiftExpression的运算结果值。</li>
<li>记rval为rref类型转换后获取的value值。</li>
<li>将lval &lt; rval按照上述规则进行运算，结果为r。</li>
<li>如果r是true或者undefined返回false，否则返回true。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p77.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中对象属性存在性及相关检测方法总结</title>
    <link href="http://www.gcidea.info/2017/01/11/js-obj-attr-exist-or-not-and-related-detect-function/"/>
    <id>http://www.gcidea.info/2017/01/11/js-obj-attr-exist-or-not-and-related-detect-function/</id>
    <published>2017-01-11T03:14:54.000Z</published>
    <updated>2017-02-11T05:26:16.372Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p89.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　访问一个对象中的某个属性时，返回的结果可能是undefined，这有可能是本身该属性存储的值就是undefined，也有可能是该属性在对象中不存在。对此，就产生了判断属性存在性的相关问题和解决方法。</p>
<hr>
<h2 id="in操作符"><a href="#in操作符" class="headerlink" title="in操作符"></a>in操作符</h2><h3 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="string">"name"</span> <span class="keyword">in</span> obj);  <span class="comment">//true</span></span><br><span class="line">(<span class="string">"sex"</span> <span class="keyword">in</span> obj);   <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<h3 id="是否查找原型链"><a href="#是否查找原型链" class="headerlink" title="是否查找原型链"></a>是否查找原型链</h3><p><strong>是</strong><br>该操作会检查属性在对象本身及其[[prototype]]原型链中是否存在。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = &#123;</span><br><span class="line">    sex : <span class="string">"m"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.__proto__ = pro;</span><br><span class="line"></span><br><span class="line"><span class="string">"sex"</span> <span class="keyword">in</span> obj;    <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="所查找的属性是否必须满足可枚举（enumerable-true）"><a href="#所查找的属性是否必须满足可枚举（enumerable-true）" class="headerlink" title="所查找的属性是否必须满足可枚举（enumerable:true）"></a>所查找的属性是否必须满足可枚举（enumerable:true）</h3><p><strong>否</strong><br>该操作会检查对象本身及其[[prototype]]原型链上的所有属性，无论其是否可枚举。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"own"</span>, &#123;</span><br><span class="line">	enumerable : <span class="literal">false</span>,</span><br><span class="line">	value : <span class="number">5</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">(<span class="string">"own"</span> <span class="keyword">in</span> obj);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h3><p><code>in</code>检查的是属性名，而非属性值。</p>
<hr>
<h2 id="obj-hasOwnProperty-attr"><a href="#obj-hasOwnProperty-attr" class="headerlink" title="obj.hasOwnProperty(attr)"></a>obj.hasOwnProperty(attr)</h2><h3 id="语法格式-1"><a href="#语法格式-1" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.hasOwnProperty(<span class="string">"name"</span>);  <span class="comment">//true</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">"sex"</span>);   <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<h3 id="是否查找原型链-1"><a href="#是否查找原型链-1" class="headerlink" title="是否查找原型链"></a>是否查找原型链</h3><p><strong>否</strong><br>该操作仅会检查属性在对象本身是否存在，不会检查其[[prototype]]原型链。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = &#123;</span><br><span class="line">    sex : <span class="string">"m"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.__proto__ = pro;</span><br><span class="line"></span><br><span class="line">obj.hasOwnProperty(<span class="string">"sex"</span>);    <span class="comment">//false</span></span><br></pre></td></tr></table></figure></p>
<h3 id="所查找的属性是否必须满足可枚举（enumerable-true）-1"><a href="#所查找的属性是否必须满足可枚举（enumerable-true）-1" class="headerlink" title="所查找的属性是否必须满足可枚举（enumerable:true）"></a>所查找的属性是否必须满足可枚举（enumerable:true）</h3><p><strong>否</strong><br>该操作会检查属对象本身上的所有属性，无论其是否可枚举。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"own"</span>, &#123;</span><br><span class="line">	enumerable : <span class="literal">false</span>,</span><br><span class="line">	value : <span class="number">5</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">obj.hasOwnProperty(<span class="string">"own"</span>);    <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="其他说明-1"><a href="#其他说明-1" class="headerlink" title="其他说明"></a>其他说明</h3><p>一般来讲，所有普通对象都可以通过对Object.prototype的委托来访问hasOwnProperty()，但是，对于有些特殊情况，比如通过Object.create(null)来创建的对象，它就没有连接到Object.prototype，因此就无法使用该方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">a.name = <span class="string">"bob"</span>;</span><br><span class="line">a.hasOwnProperty(<span class="string">"name"</span>); <span class="comment">//VM2137:1 Uncaught TypeError: a.hasOwnProperty is not a function(…)</span></span><br></pre></td></tr></table></figure></p>
<p>这时可通过显式绑定来达到效果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">a.name = <span class="string">"bob"</span>;</span><br><span class="line"><span class="built_in">Object</span>.prototype.hasOwnProperty.call(a, <span class="string">"name"</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="for-var-k-in-obj-循环"><a href="#for-var-k-in-obj-循环" class="headerlink" title="for(var k in obj)循环"></a>for(var k in obj)循环</h2><h3 id="语法格式-2"><a href="#语法格式-2" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> obj)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(k, obj[k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//name Bob</span></span><br><span class="line"><span class="comment">//age 24</span></span><br></pre></td></tr></table></figure>
<h3 id="是否查找原型链-2"><a href="#是否查找原型链-2" class="headerlink" title="是否查找原型链"></a>是否查找原型链</h3><p><strong>是</strong><br>该操作会检查属性在对象本身及其[[prototype]]原型链中是否存在。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = &#123;</span><br><span class="line">    sex : <span class="string">"m"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.__proto__ = pro;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//name Bob</span></span><br><span class="line"><span class="comment">//age 24</span></span><br><span class="line"><span class="comment">//sex m</span></span><br></pre></td></tr></table></figure></p>
<h3 id="所查找的属性是否必须满足可枚举（enumerable-true）-2"><a href="#所查找的属性是否必须满足可枚举（enumerable-true）-2" class="headerlink" title="所查找的属性是否必须满足可枚举（enumerable:true）"></a>所查找的属性是否必须满足可枚举（enumerable:true）</h3><p><strong>是</strong><br>该操作仅会检查对象本身及其[[prototype]]原型链上的所有可枚举属性<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"own"</span>, &#123;</span><br><span class="line">	enumerable : <span class="literal">false</span>,</span><br><span class="line">	value : <span class="number">5</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> obj)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(k, obj[k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//name Bob</span></span><br><span class="line"><span class="comment">//age 24</span></span><br></pre></td></tr></table></figure></p>
<h3 id="其他说明-2"><a href="#其他说明-2" class="headerlink" title="其他说明"></a>其他说明</h3><p>不要在数组上运用这种for(var k in obj)循环，因为这种枚举不仅会包含所有数值索引，还会包含所有可枚举属性，可能会产生一些问题。对于数组遍历，采用普通for循环或者forEach()方法就好。</p>
<hr>
<h2 id="obj-propertyIsEnumerable"><a href="#obj-propertyIsEnumerable" class="headerlink" title="obj.propertyIsEnumerable"></a>obj.propertyIsEnumerable</h2><h3 id="语法格式-3"><a href="#语法格式-3" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.propertyIsEnumerable(<span class="string">"name"</span>);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h3 id="是否查找原型链-3"><a href="#是否查找原型链-3" class="headerlink" title="是否查找原型链"></a>是否查找原型链</h3><p><strong>否</strong><br>该操作仅会检查属性在对象本身是否存在，不会检查其[[prototype]]原型链。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = &#123;</span><br><span class="line">    sex : <span class="string">"m"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.__proto__ = pro;</span><br><span class="line"></span><br><span class="line">obj.propertyIsEnumerable(<span class="string">"sex"</span>);  <span class="comment">//false</span></span><br></pre></td></tr></table></figure></p>
<h3 id="所查找的属性是否必须满足可枚举（enumerable-true）-3"><a href="#所查找的属性是否必须满足可枚举（enumerable-true）-3" class="headerlink" title="所查找的属性是否必须满足可枚举（enumerable:true）"></a>所查找的属性是否必须满足可枚举（enumerable:true）</h3><p><strong>是</strong><br>从名字容易看出，属性必须满足enumerable:true<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"own"</span>, &#123;</span><br><span class="line">	enumerable : <span class="literal">false</span>,</span><br><span class="line">	value : <span class="number">5</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">obj.propertyIsEnumerable(<span class="string">"own"</span>);  <span class="comment">//false</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="Object-getOwnPropertyNames-obj"><a href="#Object-getOwnPropertyNames-obj" class="headerlink" title="Object.getOwnPropertyNames(obj)"></a>Object.getOwnPropertyNames(obj)</h2><h3 id="语法格式-4"><a href="#语法格式-4" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj);    <span class="comment">//["name", "age"]</span></span><br></pre></td></tr></table></figure>
<h3 id="是否查找原型链-4"><a href="#是否查找原型链-4" class="headerlink" title="是否查找原型链"></a>是否查找原型链</h3><p><strong>否</strong><br>该操作仅会检查属性在对象本身是否存在，不会检查其[[prototype]]原型链。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = &#123;</span><br><span class="line">    sex : <span class="string">"m"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.__proto__ = pro;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj);    <span class="comment">//["name", "age"]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="所查找的属性是否必须满足可枚举（enumerable-true）-4"><a href="#所查找的属性是否必须满足可枚举（enumerable-true）-4" class="headerlink" title="所查找的属性是否必须满足可枚举（enumerable:true）"></a>所查找的属性是否必须满足可枚举（enumerable:true）</h3><p><strong>否</strong><br>该操作会检查属对象本身上的所有属性，无论其是否可枚举。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"own"</span>, &#123;</span><br><span class="line">	enumerable : <span class="literal">false</span>,</span><br><span class="line">	value : <span class="number">5</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj);  <span class="comment">//["name", "age", "own"]</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="Object-keys-obj"><a href="#Object-keys-obj" class="headerlink" title="Object.keys(obj)"></a>Object.keys(obj)</h2><h3 id="语法格式-5"><a href="#语法格式-5" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj);    <span class="comment">//["name", "age"]</span></span><br></pre></td></tr></table></figure>
<h3 id="是否查找原型链-5"><a href="#是否查找原型链-5" class="headerlink" title="是否查找原型链"></a>是否查找原型链</h3><p><strong>否</strong><br>该操作仅会检查属性在对象本身是否存在，不会检查其[[prototype]]原型链。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = &#123;</span><br><span class="line">    sex : <span class="string">"m"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.__proto__ = pro;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj);    <span class="comment">//["name", "age"]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="所查找的属性是否必须满足可枚举（enumerable-true）-5"><a href="#所查找的属性是否必须满足可枚举（enumerable-true）-5" class="headerlink" title="所查找的属性是否必须满足可枚举（enumerable:true）"></a>所查找的属性是否必须满足可枚举（enumerable:true）</h3><p><strong>是</strong><br>该操作仅会检查对象本身上的所有可枚举属性<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name : <span class="string">"Bob"</span>,</span><br><span class="line">	age : <span class="number">24</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"own"</span>, &#123;</span><br><span class="line">	enumerable : <span class="literal">false</span>,</span><br><span class="line">	value : <span class="number">5</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj);    <span class="comment">//["name", "age"]</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p89.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>【探究】当页面关闭时，不同浏览器对尚未完成的异步请求如何处理？</title>
    <link href="http://www.gcidea.info/2017/01/09/ajax-status-when-browser-window-close/"/>
    <id>http://www.gcidea.info/2017/01/09/ajax-status-when-browser-window-close/</id>
    <published>2017-01-09T09:23:24.000Z</published>
    <updated>2017-02-11T05:26:52.383Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p4.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　以使用$.ajax()方法发出一个异步请求为例，探究当执行完发出异步请求的同步代码但尚未执行异步回调的函数的时候，关闭浏览器，不同浏览器对此有何处理。并且，这个问题是因为看到了一种不规范写法而发现的—场景是，执行完相关保存任务（异步请求）后关闭当前页面。这种写法把window.close()相关代码却写在了$ajax()的外面（后面）。违背了在成功保存的回调内关闭页面的做法。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/ajax-close-1.jpg" alt=""></p>
<hr>
<h2 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h2><p>　　现有逻辑下（window.close写在外面）这个ajax请求会被丢弃，用fiddler抓包，没有”../mktools/customized-template-page!save.action?random=”+ new Date().getTime(),这个请求。</p>
<hr>
<h2 id="Firefox"><a href="#Firefox" class="headerlink" title="Firefox"></a>Firefox</h2><p>　　同chrome 。但是如果在$.ajax上打个断点，是可以看到请求发出去了的，也好理解，因为还没执行到window.close，未完成的请求不会被抛弃。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/ajax-close-2.png" alt=""></p>
<hr>
<h2 id="IE"><a href="#IE" class="headerlink" title="IE"></a>IE</h2><p>　　IE 即便不打断点，现有逻辑下（window.close写在外面），请求依然会发出去。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/ajax-close-3.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p4.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>常见数据格式的正则表达式验证</title>
    <link href="http://www.gcidea.info/2017/01/07/js-common-dataformat-regexp/"/>
    <id>http://www.gcidea.info/2017/01/07/js-common-dataformat-regexp/</id>
    <published>2017-01-07T03:27:52.000Z</published>
    <updated>2017-02-26T11:46:43.973Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p76.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　正则表达式是一种强大的工具，可以在很多场景下对我们需要的内容进行快速匹配过滤。比如，在前端提交表单时，就可以通过编写合理的正则表达式对用户输入进行首次过滤（当然服务端程序在接收到数据后一样要进行严格的数据检查，保证程序正常运行，防止通过postman等工具绕过前端验证进行恶意攻击。）</p>
<h2 id="正则表达式的学习"><a href="#正则表达式的学习" class="headerlink" title="正则表达式的学习"></a>正则表达式的学习</h2><p>　　网上有很多系统学习正则表达式的资源，掌握基本的语法和相关机制是实现常见数据格式验证的基础。快速了解正则表达式的内容，推荐<a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434499503920bb7b42ff6627420da2ceae4babf6c4f2000" target="_blank" rel="external">廖雪峰JavaScript教程中的正则RegExp部分</a>。<br>　　需要单独说明的是，以下提到的各种数据格式的验证，都采用JavaScript中的如下写法：<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/正则表达式/</span>;</span><br><span class="line"><span class="keyword">var</span> strToTest = <span class="string">"待测试内容"</span>;</span><br><span class="line">reg.test(strToTest); <span class="comment">//返回true或者false表明正则验证通过或失败</span></span><br><span class="line">strToTest.match(reg); <span class="comment">//以数组形式返回匹配正确的部分，若没有返回null</span></span><br></pre></td></tr></table></figure></p>
<h2 id="验证输入是否为空"><a href="#验证输入是否为空" class="headerlink" title="验证输入是否为空"></a>验证输入是否为空</h2><h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p><code>^</code>匹配开始，<code>$</code>匹配结束，上述表达式的意思是匹配的字符串开始结束之间没有内容。test()方法返回true则表示输入内容为空（输入空格等并不为空）。</p>
<hr>
<h2 id="验证输入是否为英文字母-大小写-数字"><a href="#验证输入是否为英文字母-大小写-数字" class="headerlink" title="验证输入是否为英文字母(大小写)+数字"></a>验证输入是否为英文字母(大小写)+数字</h2><h3 id="表达式-1"><a href="#表达式-1" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[a-zA-Z0-9]+$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-1"><a href="#解释-1" class="headerlink" title="解释"></a>解释</h3><p>分别列出小写a-z，大写A-Z，数字0-9即可。</p>
<h2 id="验证输入是否为英文字母-大小写-数字-下划线"><a href="#验证输入是否为英文字母-大小写-数字-下划线" class="headerlink" title="验证输入是否为英文字母(大小写)+数字+下划线"></a>验证输入是否为英文字母(大小写)+数字+下划线</h2><h3 id="表达式-2"><a href="#表达式-2" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\w+$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-2"><a href="#解释-2" class="headerlink" title="解释"></a>解释</h3><p>正则表达式中\w就表示匹配一个数字或者字母，也包含了下划线。</p>
<h2 id="验证输入是否为汉字"><a href="#验证输入是否为汉字" class="headerlink" title="验证输入是否为汉字"></a>验证输入是否为汉字</h2><h3 id="表达式-3"><a href="#表达式-3" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[\u4e00-\u9fa5]&#123;0,&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-3"><a href="#解释-3" class="headerlink" title="解释"></a>解释</h3><p><code>\u4e00</code>是汉字“一”，<code>\u9fa5</code>是汉字“龥”，该范围包含了汉字的Unicode编码。</p>
<h2 id="验证输入是否为整数"><a href="#验证输入是否为整数" class="headerlink" title="验证输入是否为整数"></a>验证输入是否为整数</h2><h3 id="表达式-4"><a href="#表达式-4" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\-?[1-9]\d*$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-4"><a href="#解释-4" class="headerlink" title="解释"></a>解释</h3><ol>
<li>这个表达式可以用来匹配除0以外的任意正负整数。</li>
<li>开始是一个负号“-”，用来匹配负数的负号，?表示非贪婪匹配模式（也就是说匹配尽量少的内容，一旦匹配上就不再考虑后面的字符串）。并且?表示匹配其前面的内容0次或者1次，这样就包括了正数和负数都可以。注意这里的<code>-</code>号后面不能接<code>*</code>或者<code>+</code>，必须只能至多有一个。</li>
<li>[1-9]则表示匹配一个1-9的数字，作为整个这个整数的开头。注意这里必须将第一位这样处理，因为不能为0，无法和后面的\d*合并。</li>
<li>\d*则表示后续接的0个或多个数字，和前面的部分共同构成整数。</li>
</ol>
<h2 id="验证输入是否为正整数"><a href="#验证输入是否为正整数" class="headerlink" title="验证输入是否为正整数"></a>验证输入是否为正整数</h2><h3 id="表达式-5"><a href="#表达式-5" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\+?[1-9]\d*$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-5"><a href="#解释-5" class="headerlink" title="解释"></a>解释</h3><ol>
<li>开始可以有一个正号（最多一个），当然也可以没有。并且由于<code>+</code>在正则表达式中有特殊含义，因此必须转义。</li>
<li>[1-9]则表示匹配一个1-9的数字，作为整个这个整数的开头。注意这里必须将第一位这样处理，因为不能为0，无法和后面的\d*合并。</li>
<li>\d*则表示后续接的0个或多个数字，和前面的部分共同构成整数。</li>
</ol>
<h2 id="验证输入是否为负整数"><a href="#验证输入是否为负整数" class="headerlink" title="验证输入是否为负整数"></a>验证输入是否为负整数</h2><h3 id="表达式-6"><a href="#表达式-6" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\-[1-9]\d*$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-6"><a href="#解释-6" class="headerlink" title="解释"></a>解释</h3><ol>
<li>一开始必须有一个负号，并且由于<code>-</code>在正则表达式中有特殊含义，因此转义。</li>
<li>[1-9]则表示匹配一个1-9的数字，作为整个这个整数的开头。注意这里必须将第一位这样处理，因为不能为0，无法和后面的\d*合并。</li>
<li>\d*则表示后续接的0个或多个数字，和前面的部分共同构成整数。</li>
</ol>
<h2 id="验证输入是否为非负整数（正整数-0）"><a href="#验证输入是否为非负整数（正整数-0）" class="headerlink" title="验证输入是否为非负整数（正整数 + 0）"></a>验证输入是否为非负整数（正整数 + 0）</h2><h3 id="表达式-7"><a href="#表达式-7" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^((\+?[1-9]\d*)|(0))$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-7"><a href="#解释-7" class="headerlink" title="解释"></a>解释</h3><ol>
<li>正数前面可能会有正号，<code>\+?</code>限制有0个或者1个正号。</li>
<li>随后是一位1-9的数字<code>[1-9]</code>，再随后是任意多位0-9的数字<code>\d*</code>，排除掉“+02”这样无意义的写法。</li>
<li>对于0，直接匹配(0)。</li>
<li>上述情况，居其一，用或<code>|</code>区分，整体上必须还用括号()包起来，否则无法正确过滤”-0”这种情况。</li>
</ol>
<h2 id="验证输入是否为非正整数（负整数-0）"><a href="#验证输入是否为非正整数（负整数-0）" class="headerlink" title="验证输入是否为非正整数（负整数 + 0）"></a>验证输入是否为非正整数（负整数 + 0）</h2><h3 id="表达式-8"><a href="#表达式-8" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^((\-[1-9]\d*)|(0))$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-8"><a href="#解释-8" class="headerlink" title="解释"></a>解释</h3><ol>
<li>对于0，直接匹配(0)。</li>
<li>对于小于零的负整数，开头是负号<code>-</code>，随后是一位1-9的数字<code>[1-9]</code>，再随后是任意多位0-9的数字<code>\d*</code>。</li>
<li>上述两种情况，居其一，用或<code>|</code>区分，整体上必须还用括号()包起来，否则无法正确过滤”-0”这种情况。</li>
</ol>
<h2 id="验证输入是否为n位的数字"><a href="#验证输入是否为n位的数字" class="headerlink" title="验证输入是否为n位的数字"></a>验证输入是否为n位的数字</h2><h3 id="表达式-9"><a href="#表达式-9" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;n&#125;$/</span>; <span class="comment">//具体使用时n取某个特定数字</span></span><br></pre></td></tr></table></figure>
<h3 id="解释-9"><a href="#解释-9" class="headerlink" title="解释"></a>解释</h3><p>{n}表示\d数字的个数。</p>
<h2 id="验证输入是否为至少n位的数字"><a href="#验证输入是否为至少n位的数字" class="headerlink" title="验证输入是否为至少n位的数字"></a>验证输入是否为至少n位的数字</h2><h3 id="表达式-10"><a href="#表达式-10" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;n,&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-10"><a href="#解释-10" class="headerlink" title="解释"></a>解释</h3><p>{n,}表示\d数字的个数范围。</p>
<h2 id="验证输入是否为m-n位的数字"><a href="#验证输入是否为m-n位的数字" class="headerlink" title="验证输入是否为m~n位的数字"></a>验证输入是否为m~n位的数字</h2><h3 id="表达式-11"><a href="#表达式-11" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;m,n&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-11"><a href="#解释-11" class="headerlink" title="解释"></a>解释</h3><p>{n,m}表示\d数字的个数范围。</p>
<h2 id="验证输入是否为浮点数"><a href="#验证输入是否为浮点数" class="headerlink" title="验证输入是否为浮点数"></a>验证输入是否为浮点数</h2><h3 id="表达式-12"><a href="#表达式-12" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(\-?\d+)(\.\d+)?$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-12"><a href="#解释-12" class="headerlink" title="解释"></a>解释</h3><ol>
<li>开始是一个负号“-”，用来匹配负数的负号，?表示非贪婪匹配模式（也就是说匹配尽量少的内容，一旦匹配上就不再考虑后面的字符串）。并且?表示匹配其前面的内容0次或者1次，这样就包括了正数和负数都可以。注意这里的<code>-</code>号后面不能接<code>*</code>或者<code>+</code>，必须只能至多有一个。</li>
<li>随后<code>\d+</code>表示1位或者多位数字，代表该浮点数的整数部分。</li>
<li><code>\.</code>转义表示小数点。</li>
<li><code>\d+</code>表示1位或者多位数字，代表该浮点数的小数部分。</li>
</ol>
<h2 id="验证输入是否为正浮点数"><a href="#验证输入是否为正浮点数" class="headerlink" title="验证输入是否为正浮点数"></a>验证输入是否为正浮点数</h2><h3 id="表达式-13"><a href="#表达式-13" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-13"><a href="#解释-13" class="headerlink" title="解释"></a>解释</h3><ol>
<li>开始一位1-9的数字<code>[1-9]</code>，再随后是任意多位0-9的数字<code>\d*</code>，表示正浮点数整数部分（且是大于等于1的浮点数）。</li>
<li><code>\.</code>转义表示小数点。</li>
<li><code>\d*</code>表示0位或者多位数字，代表该浮点数的小数部分。</li>
<li>再考虑0-1之间的浮点数，<code>\d*[1-9]\d*</code>的写法是为了防止0.000这种情况。</li>
</ol>
<h2 id="验证输入是否为负浮点数"><a href="#验证输入是否为负浮点数" class="headerlink" title="验证输入是否为负浮点数"></a>验证输入是否为负浮点数</h2><h3 id="表达式-14"><a href="#表达式-14" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-14"><a href="#解释-14" class="headerlink" title="解释"></a>解释</h3><ol>
<li>开头匹配负号’-‘</li>
<li>考虑小于等于-1的浮点数，一位1-9的数字<code>[1-9]</code>，再随后是任意多位0-9的数字<code>\d*</code>，表示负浮点数整数部分。</li>
<li><code>\.</code>转义表示小数点。</li>
<li><code>\d*</code>表示0位或者多位数字，代表该浮点数的小数部分。</li>
<li>再考虑-1~0之间的浮点数，<code>0</code>直接匹配0。</li>
<li><code>\.</code>转义表示小数点。</li>
<li><code>\d*[1-9]\d*</code>的写法是为了防止0.000这种情况。</li>
</ol>
<h2 id="验证输入是否为非负浮点数"><a href="#验证输入是否为非负浮点数" class="headerlink" title="验证输入是否为非负浮点数"></a>验证输入是否为非负浮点数</h2><h3 id="表达式-15"><a href="#表达式-15" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-15"><a href="#解释-15" class="headerlink" title="解释"></a>解释</h3><ol>
<li>前半部分<code>[1-9]\d*\.\d*|0\.\d*[1-9]\d*</code>与正浮点数一样，不再赘述。</li>
<li><code>0?</code>表示0个或1个‘0’，这是允许的，针对的是“.666”这种写法的浮点数。</li>
<li>最后一部分直接匹配“0”，也是可以的。</li>
</ol>
<h2 id="验证输入是否为非正浮点数"><a href="#验证输入是否为非正浮点数" class="headerlink" title="验证输入是否为非正浮点数"></a>验证输入是否为非正浮点数</h2><h3 id="表达式-16"><a href="#表达式-16" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(\-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-16"><a href="#解释-16" class="headerlink" title="解释"></a>解释</h3><ol>
<li>前半部分<code>\-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)</code>与负浮点数一样，不再赘述。</li>
<li><code>0?</code>表示0个或1个‘0’，这是允许的，针对的是“.666”这种写法的浮点数。</li>
<li>最后一部分直接匹配“0”，也是可以的。</li>
</ol>
<h2 id="验证输入是否为有两位小数的正实数"><a href="#验证输入是否为有两位小数的正实数" class="headerlink" title="验证输入是否为有两位小数的正实数"></a>验证输入是否为有两位小数的正实数</h2><h3 id="表达式-17"><a href="#表达式-17" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^([1-9]\d*(\.[0-9]&#123;2&#125;)?)|(0\.[1-9][0-9])|(0\.[0-9][1-9])$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-17"><a href="#解释-17" class="headerlink" title="解释"></a>解释</h3><ol>
<li>([1-9]\d*(.[0-9]{2})?)匹配大于等于1的两位小数实数</li>
<li>(0.[1-9][0-9])匹配0.10~0.99的两位小数实数</li>
<li>(0.[0-9][1-9])匹配0.01~0.99（但不含0.10 0.20 0.30 … 0.90这些数）</li>
<li>2,3中的处理是为了排除0.00这个数（非正）</li>
</ol>
<h2 id="验证输入是否为有1-3位小数的正数或负数"><a href="#验证输入是否为有1-3位小数的正数或负数" class="headerlink" title="验证输入是否为有1~3位小数的正数或负数"></a>验证输入是否为有1~3位小数的正数或负数</h2><h3 id="表达式-18"><a href="#表达式-18" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(\-)?\d+(\.\d&#123;1,2&#125;)?$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-18"><a href="#解释-18" class="headerlink" title="解释"></a>解释</h3><ol>
<li>(-)?匹配0或1个负号</li>
<li>\d+表示该数的整数部分</li>
<li>(.\d{1,3})?匹配小数点和1~3位小数</li>
</ol>
<h2 id="验证输入是否为email地址"><a href="#验证输入是否为email地址" class="headerlink" title="验证输入是否为email地址"></a>验证输入是否为email地址</h2><h3 id="表达式-19"><a href="#表达式-19" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-19"><a href="#解释-19" class="headerlink" title="解释"></a>解释</h3><ol>
<li><code>\w+</code>表明必须以字母数字下划线开头。</li>
<li>随后可接任意个([-+.]\w+)的组合。组合的内容是：一个’-‘或’+’或’.’加上至少一个字母数字下划线。</li>
<li><code>@</code>直接匹配地址符@。</li>
<li>@后面必须接至少一个字母数字下划线。</li>
<li>随后可接任意个([-.]\w+)的组合。组合的内容是：一个’-‘或’.’加上至少一个字母数字下划线。</li>
<li>随后单独匹配一个<code>\.</code>，表明@后面至少是二级域名。</li>
<li>随后仍可接任意个([-.]\w+)的组合。注意必须以字母数字下划线结尾。</li>
</ol>
<h2 id="验证输入是否为中国邮政编码"><a href="#验证输入是否为中国邮政编码" class="headerlink" title="验证输入是否为中国邮政编码"></a>验证输入是否为中国邮政编码</h2><h3 id="表达式-20"><a href="#表达式-20" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;6&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-20"><a href="#解释-20" class="headerlink" title="解释"></a>解释</h3><p>邮编为6位数字。另外有些地方关于邮编的正则验证是<code>[1-9]\d{5}(?!\d)</code>。我认为有两个问题：</p>
<ol>
<li>邮编第一位可以为零，比如027200：内蒙古自治区 锡林郭勒盟 正蓝旗</li>
<li>最后加一个零宽负向先行断言<code>(?!\d)</code>是没有必要的，想限制第六位后面没有数字，直接$即可。</li>
</ol>
<h2 id="验证输入是否为URL"><a href="#验证输入是否为URL" class="headerlink" title="验证输入是否为URL"></a>验证输入是否为URL</h2><h3 id="表达式-21"><a href="#表达式-21" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-21"><a href="#解释-21" class="headerlink" title="解释"></a>解释</h3><p>URL的灵活性很强，因此不好找到一种能包罗万象的匹配方式，上述提供的只能说可以应对大部分，但使用时要注意，如果加上了这个限制反而导致用户本来正确合理的输入无法通过验证进而提交表单，那么不如不用。</p>
<h2 id="验证输入是否为身份证号码"><a href="#验证输入是否为身份证号码" class="headerlink" title="验证输入是否为身份证号码"></a>验证输入是否为身份证号码</h2><h3 id="表达式-22"><a href="#表达式-22" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(\d&#123;15&#125;$|^\d&#123;18&#125;$|^\d&#123;17&#125;(x|X))$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-22"><a href="#解释-22" class="headerlink" title="解释"></a>解释</h3><ol>
<li>早期身份证号码为15位，均为数字；后来增加为18位编码，最后一位是校验位，可能出现“10”，对应地采用罗马字母X表示。</li>
<li>分别验证了15位数字、18位数字、17位数字+字母x/X三种情况。要注意的是每种情况必须都写结束符$，否则只要大于等于15位都会匹配成功。</li>
<li>以上正则验证只能说是对数字位数和是否有字母做出了限定，但并不能详细校验是否符合规则-比如地区编号，性别等，这些超出了正则的验证范围（或者说正则解决起来反而会变得麻烦），这时候，想进一步验证输入，要采取更详细的办法，详见<a href="http://mp.weixin.qq.com/s?__biz=MzAwMzMxOTUxOA==&amp;mid=402994766&amp;idx=1&amp;sn=fbf98b406af41e2415b5d5e263682dd4&amp;scene=0#rd" target="_blank" rel="external">JavaScript 18位身份证验证及身份证号码规则</a>。</li>
</ol>
<h2 id="验证输入是否为一年的12个月"><a href="#验证输入是否为一年的12个月" class="headerlink" title="验证输入是否为一年的12个月"></a>验证输入是否为一年的12个月</h2><h3 id="表达式-23"><a href="#表达式-23" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(0?[1-9]|1[0-2])$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-23"><a href="#解释-23" class="headerlink" title="解释"></a>解释</h3><ol>
<li><code>0?</code>这种写法保证了比如9、09都可以被接受，而不是非得两位。</li>
<li>10，11，12月单独处理。</li>
</ol>
<h2 id="验证输入是否为一月的31天"><a href="#验证输入是否为一月的31天" class="headerlink" title="验证输入是否为一月的31天"></a>验证输入是否为一月的31天</h2><h3 id="表达式-24"><a href="#表达式-24" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(0?[1-9]|(1|2)[0-9]|3[0-1])$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-24"><a href="#解释-24" class="headerlink" title="解释"></a>解释</h3><p><code>0?</code>这种写法保证了比如9、09都可以被接受，而不是非得两位。</p>
<h2 id="验证输入是否为YYYY-MM-DD格式的日期"><a href="#验证输入是否为YYYY-MM-DD格式的日期" class="headerlink" title="验证输入是否为YYYY-MM-DD格式的日期"></a>验证输入是否为YYYY-MM-DD格式的日期</h2><h3 id="表达式-25"><a href="#表达式-25" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(?:(?!0000)[0-9]&#123;4&#125;-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-25"><a href="#解释-25" class="headerlink" title="解释"></a>解释</h3><ol>
<li><p>考虑了平年闰年。</p>
</li>
<li><p><code>(?:(?!0000)[0-9]{4}</code>匹配年份。<br>2.1 <code>?:</code>表明这是非捕获分组，后面括号匹配到的内容不会被存入内存中，这样是为了提高匹配效率和性能（后面大量出现<code>?:</code>，都是这个作用）。<br>2.2 <code>?!</code>表明这是零宽负向先行断言，表明在此位置后面的不是“0000”才会匹配，结合<code>[0-9]{4}</code>来看，这是为了去掉年份为“0000”的。</p>
</li>
<li><p>后面分多种情况匹配了月和日：<br>　3.1 “(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)”<br>　　3.1.1 “?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])”<br>　　　　3.1.1.1 “?:(?:0[1-9]|1[0-2])”<br>　　　　　　匹配01-09月，以及10-12月。<br>　　　　3.1.1.2 “(?:0[1-9]|1[0-9]|2[0-8])”<br>　　　　　　匹配01-09日，10-19日，20-28日。这些是任何一年的任何一个月都会有的日期。<br>　　3.1.2 “(?:0[13-9]|1[0-2])-(?:29|30)”<br>　　　　3.1.2.1 “(?:0[13-9]|1[0-2])”<br>　　　　　　匹配01月、03-09月，以及10-12月。也就是除去02月，考虑到02月只有28/29天。<br>　　　　3.1.2.2 “(?:29|30)”<br>　　　　　　当月份匹配01月、03-09月，以及10-12月时，对应的日就可以有29、30日。<br>　　3.1.3 “(?:0[13578]|1[02])-31)”<br>　　　　3.1.3.1 “(?:0[13578]|1[02])”<br>　　　　　　匹配01,03,05,07,08,10,12月，这些月份会有31号。<br>　　　　3.1.3.2 “-31”<br>　　　　　　匹配31日。<br>　3.2 “(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29”<br>　　3.2.1 “(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)”<br>　　　　3.2.1.1 “(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])”<br>　　　　　　从3.2开始是匹配一些特殊的年份-闰年。即年份“能被400整除”或者“能被4整除且不能被100整除”的。先考虑“能被4整除且不能被100整除”：前两位0-9皆可。后两位只要不是“00”，就能保证不被100整除，因此只需要考虑后两位被4整除的情况，也就是考虑01-99之中能被4整除的有哪些，即(?:0[48]|[2468][048]|[13579][26])。<br>　　　　3.2.1.2 “(?:0[48]|[2468][048]|[13579][26])00”<br>　　　　　　再考虑“能被400整除”的，后两位肯定是00，考虑前两位。只要前两位能被4整除即可，也即(?:0[48]|[2468][048]|[13579][26])。<br>　　3.2.2 “-02-29”<br>　　　　处理完年份后，即得到所有的闰年后，月日就是固定的02-29。</p>
</li>
</ol>
<h2 id="验证输入是否为YYYY-MM-DD-hh-mm-ss格式的日期"><a href="#验证输入是否为YYYY-MM-DD-hh-mm-ss格式的日期" class="headerlink" title="验证输入是否为YYYY-MM-DD hh:mm:ss格式的日期"></a>验证输入是否为YYYY-MM-DD hh:mm:ss格式的日期</h2><h3 id="表达式-26"><a href="#表达式-26" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(?:(?!0000)[0-9]&#123;4&#125;-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) (([0-1][0-9])|(2[0-3]))\:[0-5][0-9]\:[0-5][0-9]$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-26"><a href="#解释-26" class="headerlink" title="解释"></a>解释</h3><ol>
<li>YYYY-MM-DD部分与上面相同，不再赘述。</li>
<li><code>(([0-1][0-9])|(2[0-3]))</code>整体是一个分组，要加括号，匹配时：00-23</li>
<li><code>[0-5][0-9]</code>，匹配分：00-59</li>
<li><code>[0-5][0-9]</code>，匹配秒：00-59</li>
</ol>
<h2 id="验证输入是否为hh-mm-ss格式的时间"><a href="#验证输入是否为hh-mm-ss格式的时间" class="headerlink" title="验证输入是否为hh:mm:ss格式的时间"></a>验证输入是否为hh:mm:ss格式的时间</h2><h3 id="表达式-27"><a href="#表达式-27" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(([0-1][0-9])|(2[0-3]))\:[0-5][0-9]\:[0-5][0-9]$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-27"><a href="#解释-27" class="headerlink" title="解释"></a>解释</h3><p>与上面的hh:mm:ss相同，不再赘述。</p>
<h2 id="验证输入是否为手机号码"><a href="#验证输入是否为手机号码" class="headerlink" title="验证输入是否为手机号码"></a>验证输入是否为手机号码</h2><h3 id="表达式-28"><a href="#表达式-28" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^1[3|4|5|7|8]\d&#123;9&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-28"><a href="#解释-28" class="headerlink" title="解释"></a>解释</h3><ol>
<li>号段分布<br>中国移动号段：<br>134 135 136 137 138 139 147 150 151 152 157 158 159 178 182 183 184 187 188<br>中国联通号段：<br>130 131 132 145 155 156 171 175 176 185 186<br>中国电信号段：<br>133 149 153 173 177 180 181 189<br>虚拟运营商:<br>170</li>
<li>第一位匹配1即可。</li>
<li>第二位从上面的分布看有3,4,5,7,8。</li>
<li>后面的9位可以是任意9位数字。</li>
<li>该正则基于以上号段，号段可能会更新，因此相应正则表达式也需要调整。</li>
</ol>
<h2 id="验证输入是否为中国座机号码"><a href="#验证输入是否为中国座机号码" class="headerlink" title="验证输入是否为中国座机号码"></a>验证输入是否为中国座机号码</h2><h3 id="表达式-29"><a href="#表达式-29" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-29"><a href="#解释-29" class="headerlink" title="解释"></a>解释</h3><ol>
<li>考虑区号3位，电话号8位的情况，格式示例010-62281100</li>
<li>考虑区号4位，电话号7位的情况，格式示例0532-1111111</li>
<li>考虑区号4位，电话号8位的情况，格式示例0571-88856088</li>
</ol>
<h2 id="验证输入是否为IPV4地址"><a href="#验证输入是否为IPV4地址" class="headerlink" title="验证输入是否为IPV4地址"></a>验证输入是否为IPV4地址</h2><h3 id="表达式-30"><a href="#表达式-30" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-30"><a href="#解释-30" class="headerlink" title="解释"></a>解释</h3><ol>
<li><code>\b</code>代表着单词的开头或结尾，也就是单词的分界处。此处使用的意思是IP地址前后要是“分开的”，没有和其他任何内容连在一起</li>
<li>“(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}”<br>IPV4格式为“xxx.xxx.xxx.xxx”,这部分匹配前三个，还带上了点号”.”。一共考虑了这几种情况：<br>　2.1 <code>[01]?[0-9][0-9]?</code>: 可能只有一位，如0.0.0.0；可能两位：如10.3.8.211；可能三位，如121.43.160.59<br>　2.2 <code>2[0-4][0-9]</code>: 考虑200~249的情况<br>　2.3 <code>25[0-5]</code>: 考虑250-255的情况</li>
</ol>
<h2 id="验证输入是否为IPV6地址"><a href="#验证输入是否为IPV6地址" class="headerlink" title="验证输入是否为IPV6地址"></a>验证输入是否为IPV6地址</h2><h3 id="表达式-31"><a href="#表达式-31" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(([0-9a-fA-F]&#123;1,4&#125;:)&#123;7&#125;[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,7&#125;:|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,6&#125;:[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,5&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,2&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,3&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,3&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,2&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,5&#125;|[0-9a-fA-F]&#123;1,4&#125;:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,6&#125;)|:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,7&#125;|:)|fe80:(:[0-9a-fA-F]&#123;0,4&#125;)&#123;0,4&#125;%[0-9a-zA-Z]&#123;1,&#125;|::(ffff(:0&#123;1,4&#125;)&#123;0,1&#125;:)&#123;0,1&#125;((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;:((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9]))$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-31"><a href="#解释-31" class="headerlink" title="解释"></a>解释</h3><h2 id="验证输入是否为密码要求的格式"><a href="#验证输入是否为密码要求的格式" class="headerlink" title="验证输入是否为密码要求的格式"></a>验证输入是否为密码要求的格式</h2><h3 id="表达式-32"><a href="#表达式-32" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[a-zA-Z]\w&#123;5,19&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-32"><a href="#解释-32" class="headerlink" title="解释"></a>解释</h3><p>密码格式要求不是固定的，上述只是其中一种：以字母开头，只能包含大小写字母、数字、下划线。长度在6~20位。</p>
<h2 id="验证输入密码安全强度"><a href="#验证输入密码安全强度" class="headerlink" title="验证输入密码安全强度"></a>验证输入密码安全强度</h2><h3 id="表达式-33"><a href="#表达式-33" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).&#123;15,20&#125;$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-33"><a href="#解释-33" class="headerlink" title="解释"></a>解释</h3><p>1.”.”在正则中表示“元字符”，它可以匹配除”\n”以外的任何字符。<br>2.”?=pattern”是一个零宽正向先行断言，紧接该位置之后的字符序列能够匹配pattern。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。<br>3.”(?=.<em>\d)(?=.</em>[a-z])(?=.*[A-Z])”这段表示在有任意个除”\n”以外的任何字符的同时，密码中必须包括数字，大小写字母。<br>4.多长的密码算“高强度”，视需求而定，这里取15位以上为高强度。</p>
<h2 id="匹配首尾空白字符"><a href="#匹配首尾空白字符" class="headerlink" title="匹配首尾空白字符"></a>匹配首尾空白字符</h2><h3 id="表达式-34"><a href="#表达式-34" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\s*|\s*$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-34"><a href="#解释-34" class="headerlink" title="解释"></a>解释</h3><p><code>\s</code>匹配任何空白字符，包括空格、制表符、换页符、回车符、换行符等等。等价于 [\f\n\r\t\v]。</p>
<h2 id="匹配中文标点符号"><a href="#匹配中文标点符号" class="headerlink" title="匹配中文标点符号"></a>匹配中文标点符号</h2><h3 id="表达式-35"><a href="#表达式-35" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]+$/</span>;</span><br></pre></td></tr></table></figure>
<h3 id="解释-35"><a href="#解释-35" class="headerlink" title="解释"></a>解释</h3><p>上述表达式匹配了如下常见的中文标点符号：<br>。 ？ ！ ， 、 ； ： “ ” ‘ ‘ （ ） 《 》 〈 〉 【 】 『 』 「 」 ﹃ ﹄ 〔 〕 … — ～ ﹏ ￥</p>
<h2 id="匹配邮箱地址"><a href="#匹配邮箱地址" class="headerlink" title="匹配邮箱地址"></a>匹配邮箱地址</h2><h3 id="表达式-36"><a href="#表达式-36" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/</span></span><br></pre></td></tr></table></figure>
<h3 id="解释-36"><a href="#解释-36" class="headerlink" title="解释"></a>解释</h3><p>前一种显式写明构成email地址的字符为字母大小写，数字和下划线；后一种使用‘\w’，简洁地表示了字符匹配，并且，考虑到了邮箱名有“.”连接的情况，比如：<br>gaochang.gcidea@gmail.com</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p76.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="正则表达式" scheme="http://www.gcidea.info/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="正则" scheme="http://www.gcidea.info/tags/%E6%AD%A3%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>前端优化：[dns-prefetch] DNS预解析</title>
    <link href="http://www.gcidea.info/2017/01/04/fe-dns-prefetch/"/>
    <id>http://www.gcidea.info/2017/01/04/fe-dns-prefetch/</id>
    <published>2017-01-04T08:27:56.000Z</published>
    <updated>2017-02-11T06:07:29.299Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p44.jpg" alt=""></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>　　对提升网页性能，提高加载速度和用户体验的不断重视。</p>
<hr>
<h2 id="定义与优势"><a href="#定义与优势" class="headerlink" title="定义与优势"></a>定义与优势</h2><p>　　DNS Prefetch，即DNS预获取，是前端优化的一部分。当你浏览网页时，浏览器会在加载网页时对网页中的域名进行解析缓存，这样在你单击当前网页中的连接时就无需进行 DNS 的解析，减少用户等待时间，提高用户体验。一般来说，在前端优化中与 DNS 有关的有两点：</p>
<ul>
<li>减少DNS的请求次数</li>
<li>进行DNS预获取 </li>
</ul>
<p>现在大多数新浏览器已经针对DNS解析进行了优化，典型的一次DNS解析需要耗费20-120毫秒，减少DNS解析时间和次数是个很好的优化方式。DNS Prefetching 是让具有此属性的域名不需要用户点击链接就在后台解析，而域名解析和内容载入是串行的网络操作，所以这个方式能 减少用户的等待时间，提升用户体验 。</p>
<p>默认情况下浏览器会对页面中和当前域名（正在浏览网页的域名）不在同一个域的域名进行预获取，并且缓存结果，这就是隐式的 DNS Prefetch。如果想对页面中没有出现的域进行预获取，那么就要使用显示的 DNS Prefetch 了。</p>
<hr>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="写法"><a href="#写法" class="headerlink" title="写法"></a>写法</h3><p>　　DNS Prefetch 应该尽量的放在html文档的前面。具体使用方法如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"x-dns-prefetch-control"</span> <span class="attr">content</span>=<span class="string">"on"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"xxxxx"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"xxxxx"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"xxxxx"</span>&gt;</span></span><br><span class="line">... ...</span><br></pre></td></tr></table></figure></p>
<h3 id="在Chrome中进行观察"><a href="#在Chrome中进行观察" class="headerlink" title="在Chrome中进行观察"></a>在Chrome中进行观察</h3><p>　　在Chrome浏览器地址栏输入”about:dns”可查看当前浏览器的预解析数据。<br>举例如下：<br>1.今日头条<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/prefetch-1.png" alt=""></p>
<p>2.Github<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/prefetch-2.png" alt=""></p>
<p>3.新浪微博<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/prefetch-3.png" alt=""></p>
<p>4.阿里云<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/prefetch-4.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p44.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="HTTP" scheme="http://www.gcidea.info/categories/HTTP/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="HTTP" scheme="http://www.gcidea.info/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>React的state初始化及其在dva框架中的具体表现</title>
    <link href="http://www.gcidea.info/2017/01/02/react-state-initialize/"/>
    <id>http://www.gcidea.info/2017/01/02/react-state-initialize/</id>
    <published>2017-01-02T05:54:23.000Z</published>
    <updated>2017-02-11T06:25:32.664Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/blog-illustration-3.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　本篇结合在使用<a href="https://github.com/dvajs" target="_blank" rel="external">dva框架</a>进行React应用开发过程中遇到的问题，简要分析React中state的机制和Redux对state的状态管理。</p>
<hr>
<h2 id="使用dva框架开发时遇到的一个问题"><a href="#使用dva框架开发时遇到的一个问题" class="headerlink" title="使用dva框架开发时遇到的一个问题"></a>使用dva框架开发时遇到的一个问题</h2><p>　　关于dva框架的基本结构和开发模式，在之前的文章中已经有所提及，见<a href="http://www.gcidea.info/2017/01/20/react-dva-structure/">React开发框架Dva.js项目结构简单小结</a>。下面的描述直接基于框架中的概念。</p>
<h3 id="问题现象描述"><a href="#问题现象描述" class="headerlink" title="问题现象描述"></a>问题现象描述</h3><p><strong>确定接口所需数据结构</strong><br>　　在进行一个应用模块的开发，与后端确立的数据接口返回数据项格式如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"status"</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="string">"message"</span>: <span class="string">"查询成功"</span>,</span><br><span class="line">  <span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"advertisement_index_top"</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"99"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"path"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"url"</span>: <span class="string">"xxx"</span></span><br><span class="line">      &#125;</span><br><span class="line">     ],</span><br><span class="line">    <span class="string">"article_index_top"</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"68"</span>,</span><br><span class="line">        <span class="string">"content"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">      &#125;</span><br><span class="line">     ],</span><br><span class="line">    <span class="string">"advertisement_index_middle"</span>:&#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"99"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"xxx"</span>, </span><br><span class="line">        <span class="string">"subtitle"</span>:<span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"path"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"url"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"count_down"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">     &#125;</span><br><span class="line">     ,</span><br><span class="line">     <span class="string">"live_index_bottom"</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"1"</span>, </span><br><span class="line">        <span class="string">"abstract"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"dispatch_time"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"tag"</span>: <span class="string">"xxx"</span>, </span><br><span class="line">        <span class="string">"color"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"path"</span>:<span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"nickname"</span>:<span class="string">"xxx"</span>,</span><br><span class="line">        <span class="string">"avatar"</span>:<span class="string">"xxx"</span>,</span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>model的定义</strong><br>　　根据如上的数据接口，进行了模块数据model层的设计，可以看出返回的数据项结构是比较复杂的，整体有4项，其中三项是数组，每个数组中是若干个对象；另一个是一个单独的对象。在model设计的时候，对于store中的state，最开始只声明了最外层的4个变量，见如下第4行开始的state声明：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespace: <span class="string">"homePage"</span>,</span><br><span class="line"></span><br><span class="line">  state: &#123;</span><br><span class="line">    advertisement_index_top: [],</span><br><span class="line">    article_index_top: [],</span><br><span class="line">    advertisement_index_middle: &#123;&#125;,</span><br><span class="line">    live_index_bottom: [],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  subscriptions: &#123;</span><br><span class="line">    setup(&#123;dispatch, history&#125;) &#123;</span><br><span class="line">      history.listen(location =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(location.pathname === <span class="string">'/'</span>)&#123;</span><br><span class="line">          dispatch(&#123;</span><br><span class="line">            type: <span class="string">'query'</span>,</span><br><span class="line">            payload: &#123;&#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  effects: &#123;</span><br><span class="line">    *query(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">yield</span> call(query, parse(payload));</span><br><span class="line">        <span class="keyword">if</span>(data &amp;&amp; data.status == <span class="string">"200"</span>) &#123;</span><br><span class="line">          <span class="keyword">yield</span> put(&#123;</span><br><span class="line">            type: <span class="string">"queryFinished"</span>,</span><br><span class="line">            payload: &#123;</span><br><span class="line">              advertisement_index_top: data.data.advertisement_index_top,</span><br><span class="line">              article_index_top: data.data.article_index_top,</span><br><span class="line">              advertisement_index_middle: data.data.advertisement_index_middle,</span><br><span class="line">              live_index_bottom: data.data.live_index_bottom,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">yield</span> put(&#123; type: <span class="string">'queryFinished'</span> &#125;);</span><br><span class="line">          <span class="keyword">throw</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">yield</span> put(&#123; type: <span class="string">"queryFinished"</span>&#125;);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"查询失败，请重试。"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  reducers: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><strong>容器组件(container component)的定义</strong>(代码有省略)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, PropTypes &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'dva'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'dva/router'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./HomePage.less'</span>;</span><br><span class="line"><span class="keyword">import</span> ... ...</span><br><span class="line"></span><br><span class="line">function HomePage(&#123; location, dispatch, homePage &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    advertisement_index_top,</span><br><span class="line">    article_index_top,</span><br><span class="line">    advertisement_index_middle,</span><br><span class="line">    live_index_bottom,</span><br><span class="line">  &#125; = homePage;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      ... ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HomePage.propTypes = &#123;</span><br><span class="line">  homepage: PropTypes.object,</span><br><span class="line">  location: PropTypes.object,</span><br><span class="line">  dispatch: PropTypes.func,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">&#123; homePage &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; homePage &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(HomePage);</span><br></pre></td></tr></table></figure></p>
<p><strong>异步请求模块</strong><br>上面涉及到的dispatch的effects异步请求，与一般结构一致，不再描述。</p>
<p><strong>进行测试，出现问题</strong><br>按如上步骤进行测试，报错如下:<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-1.png" alt=""></p>
<h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>　　上面所报错误并不是错误的直接原因，而是由真正错误所引发的后续的初始化和渲染错误。那么具体过程是怎样的，需要通过断点单步调试：<br>1.组件路由成功注册后，订阅的路由监听事件检测到路由匹配，dispatch出查询事件action。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-2.png" alt=""></p>
<p>这一步没有问题，是框架执行的正常环节。</p>
<p>2.上一步dispatch出查询action交付异步effects中的query函数，将调用真正的查询接口。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-3.png" alt=""></p>
<p>这一步没有问题，是框架执行的正常环节。</p>
<p>3.请求到达request函数，由fetch将请求发出。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-4.png" alt=""></p>
<p>这一步没有问题，是框架执行的正常环节。</p>
<p>4.以上3步，是model中的执行流程，按照dva框架的规定，接下来将按照router进行组件路由匹配，此处匹配到了HomePage组件。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-5.png" alt=""></p>
<p>问题就出在这里。</p>
<p>可以看到，变量homePage中有4个字段没错，但是内容却都是空数组或者空对象，这样后续的子组件会由于拿不到正常数据（是undefined）而报出各种错误。然而通过查看网络请求，我们可以看到数据是成功请求了的：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-6.png" alt=""></p>
<p>为什么请求返回的数据没有能够正常更新到state中去？</p>
<p>按一般想法，上面model中定义的更新事件：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(data &amp;&amp; data.status == <span class="string">"200"</span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> put(&#123;</span><br><span class="line">    type: <span class="string">"queryFinished"</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      advertisement_index_top: data.data.advertisement_index_top,</span><br><span class="line">      article_index_top: data.data.article_index_top,</span><br><span class="line">      advertisement_index_middle: data.data.advertisement_index_middle,</span><br><span class="line">      live_index_bottom: data.data.live_index_bottom,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>不就会将data.data中取出的四个变量赋值给state中的4个变量吗？那这样的话，像上面写的那样，state初始化时候直接给4个变量赋值为[]或者{}好像没什么问题（反正4个变量内部的字段会完整赋值过去）。<br>但是问题就产生在这里，这是由于对react redux对状态管理的机制不够了解造成的。一句话来概括，“state不是立即更新的，而是通过一个队列机制实现异步更新”。</p>
<p>为了更好说明这一点，我们看一下dva框架的入口文件index.js，了解执行过程：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./index.html'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'lib-flexible'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.less'</span>;</span><br><span class="line"><span class="keyword">import</span> dva <span class="keyword">from</span> <span class="string">'dva'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hashHistory &#125; <span class="keyword">from</span> <span class="string">'dva/router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. Initialize</span></span><br><span class="line"><span class="keyword">const</span> app = dva(&#123;</span><br><span class="line">  history: hashHistory,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//全局错误处理配置</span></span><br><span class="line">  onError(e) &#123;</span><br><span class="line">    message.config(&#123;</span><br><span class="line">      top: <span class="number">8</span>,</span><br><span class="line">      duration: <span class="number">3</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    message.error(e.message, <span class="number">3</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Plugins</span></span><br><span class="line"><span class="comment">//app.use(&#123;&#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Model</span></span><br><span class="line">app.model(<span class="built_in">require</span>(<span class="string">'./models/homePage'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. Router</span></span><br><span class="line">app.router(<span class="built_in">require</span>(<span class="string">'./router'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. Start</span></span><br><span class="line">app.start(<span class="string">'#root'</span>);</span><br></pre></td></tr></table></figure></p>
<p>　　如前面大篇幅描述的，第三步引入model执行完成后，在当前调用栈中将立即进入第四步去执行react-router相关的匹配。<strong>此时第三步model相关逻辑虽然执行完成了，但是由其发出的异步操作并没有执行完成</strong>。因此，进入第四步去执行，并且路由成功找到HomePage组件的时候，这时候HomePage组件拿到的homePage变量并不是真正向后端请求回来的数据，而是model中的state初始值，也就是那些空对象或者空数组。错误就在这里。<br>　　为了证明这一点，我们修改一下model中的state初始值：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">state: &#123;</span><br><span class="line">  advertisement_index_top: [</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="string">"1"</span>,</span><br><span class="line">      name: <span class="string">"12"</span>,</span><br><span class="line">      path: <span class="string">"123"</span>,</span><br><span class="line">      url: <span class="string">"1234"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  article_index_top: [],</span><br><span class="line">  advertisement_index_middle: &#123;&#125;,</span><br><span class="line">  live_index_bottom: [],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>再次调试可以看到HomePage组件拿到的homePage变量如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-7.png" alt=""></p>
<h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><p>　　由上述过程了解了问题所在，下面就要进行修改—将state中所有将要从后台取到的变量全部进行初始化，而不只是最外层。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">state: &#123;</span><br><span class="line">    advertisement_index_top: [</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">""</span>,</span><br><span class="line">        name: <span class="string">""</span>,</span><br><span class="line">        path: <span class="string">""</span>,</span><br><span class="line">        url: <span class="string">""</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    article_index_top: [</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">""</span>,</span><br><span class="line">        content: <span class="string">""</span>,</span><br><span class="line">        title: <span class="string">""</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    advertisement_index_middle: &#123;</span><br><span class="line">      id: <span class="string">""</span>,</span><br><span class="line">      name: <span class="string">""</span>,</span><br><span class="line">      subtitle:<span class="string">""</span>,</span><br><span class="line">      path: <span class="string">""</span>,</span><br><span class="line">      url: <span class="string">""</span>,</span><br><span class="line">      count_down: <span class="string">""</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    live_index_bottom: [</span><br><span class="line">      &#123;</span><br><span class="line">        id: <span class="string">""</span>,</span><br><span class="line">        abstract: <span class="string">""</span>,</span><br><span class="line">        dispatch_time: <span class="string">""</span>,</span><br><span class="line">        tag: <span class="string">""</span>,</span><br><span class="line">        color: <span class="string">"#666FFF"</span>,</span><br><span class="line">        path:<span class="string">""</span>,</span><br><span class="line">        nickname:<span class="string">""</span>,</span><br><span class="line">        avatar:<span class="string">""</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>这样的话，当程序执行到HomePage组件内部的时候，就不会因为空值而报错：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-8.png" alt=""></p>
<p>并且由进一步的调试可以知道，实际上是在上图这个断点之后，请求数据才返回回来的（这个先后过程不好通过文字表述，但经过实际调试是这样。）：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-9.png" alt=""></p>
<p>数据返回后，再分发一个更新state的action：reducers中的queryFinished：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/react-state-10.png" alt=""></p>
<p>可以看到payload中的数据长度已经不是最初的“1”了，而是“4”、“5”、“10”等，也就是真正从服务器取回的数据。通过这个reducer去更新state，就相当于原生react写法中的setState()函数，因此state更新后react框架会自动进行UI的更新，把真实数据渲染在页面上。</p>
<hr>
<h2 id="该问题的另一个规范化解决方案-在service层做好数据adaptor转换"><a href="#该问题的另一个规范化解决方案-在service层做好数据adaptor转换" class="headerlink" title="该问题的另一个规范化解决方案-在service层做好数据adaptor转换"></a>该问题的另一个规范化解决方案-在service层做好数据adaptor转换</h2><p>　　详见<a href="http://www.gcidea.info/2017/01/20/react-dva-structure/#services">React开发框架Dva.js项目结构简单小结#2.3.6. services</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/blog-illustration-3.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;
    
    </summary>
    
      <category term="React" scheme="http://www.gcidea.info/categories/React/"/>
    
    
      <category term="前端框架" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="React" scheme="http://www.gcidea.info/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中的对象、constructor属性、prototype属性对比分析</title>
    <link href="http://www.gcidea.info/2016/12/31/js-constructor-prototype/"/>
    <id>http://www.gcidea.info/2016/12/31/js-constructor-prototype/</id>
    <published>2016-12-31T15:13:37.000Z</published>
    <updated>2017-02-11T05:40:12.871Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p78.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　首先想说的是，这篇文章的题目准确怎么定我就考虑了不少时间。想过“JavaScript中的对象及其constructor属性和prototype属性”，想过“JavaScript中的对象、构造函数对象(constructor)和原型对象(prototype)”等等，但总觉得不够清楚。说实话现有的这个题目也不一定是很好的，只是相比较之下，选择一个“三者相对独立”的说法，这样就不会有先入为主的感觉。因为三者的关系并不是简单的“constructor和prototype是对象的两个属性”，并且“到底把constructor看作属性还是构造函数对象”，“到底把prototype看作属性还是原型对象”，这些问题并没有一个固定答案，它们有着互相渗透的关系。更多地我们应该关注这些名词到底想要描述怎样的问题。本文我就结合《JavaScript权威指南》和《JavaScript高级程序设计》两书进行总结和分析，可能有一些还不正确的理解，需要进一步探究。<br>　　另外，要说明的是，不可能只是干巴巴地描述这3个概念，因为它们本质上涉及的是JavaScript面向对象编程中的“类与对象”、“类的继承”等问题，因此本文是从这些方面进行组织的，constructor属性、prototype属性的分析包含其中。</p>
<hr>
<h2 id="JavaScript对象简述"><a href="#JavaScript对象简述" class="headerlink" title="JavaScript对象简述　"></a>JavaScript对象简述　</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>　　在之前关于null和undefined的讨论中提到过，JavaScript中的数据类型分为两类：原始类型和对象类型。本篇主要要总结的就是对象类型。对象是JavaScript中十分重要且常用的概念。<br>　　对象是一种复合值：是多个属性的集合，每个属性都以键/值对的形式体现。其中对于属性值为函数的属性，一般将其称作方法。函数、数组等数据组织形式都是对象的一种特殊表现形式。</p>
<h3 id="属性类型"><a href="#属性类型" class="headerlink" title="属性类型"></a>属性类型</h3><p>　　既然对象是属性的集合，那么有必要对属性进行分类。具体如下：<br>1.数据属性</p>
<blockquote>
<p>示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> student = &#123;</span><br><span class="line">    name: <span class="string">"gaochang"</span>,</span><br><span class="line">    university: <span class="string">"BUPT"</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>　　以上对象中的name和university两个属性就是数据属性，对它们可以进行数据的读取和写入。对于这类属性而言，它们又具备4个“特性”：</p>
<ul>
<li><strong>configurable</strong>：可配置性。<br>　　是指：能否通过delete删除属性，能否对该属性的这些特性进行修改，能否把数据属性修改成访问器属性（访问器属性稍候会提到）。默认<code>true</code>。</li>
<li><strong>enumerable</strong>：可枚举性。<br>　　是指：该数据属性能否通过<code>for-in</code>循环遍历到。默认为<code>true</code>。</li>
<li><strong>writable</strong>：可写性。<br>　　是指：是否能够修改该属性的属性值。默认为<code>true</code>。</li>
<li><strong>value</strong>：值。<br>　　是指： 该属性的具体属性值，比如name属性的value：”gaochang”。</li>
</ul>
<p>2.访问器属性</p>
<blockquote>
<p>示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">    name: <span class="string">"Professional JavaScript for Web Developers"</span>,</span><br><span class="line">    _isbn: <span class="string">"978-7-115-27579-0"</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(book, <span class="string">"isbn"</span>, &#123;</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._isbn;</span><br><span class="line">    &#125;</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._isbn = str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>　　以上对象中的_isbn属性就是访问器属性（前缀下划线表示是内部属性）。特别地，访问器属性不能直接定义，必须借助<code>Object.defineProperty()</code>方法。对于这类属性而言，它们又具备4个“特性”：</p>
<ul>
<li><strong>configurable</strong>：可配置性。<br>　　是指：能否通过delete删除属性，能否对该属性的这些特性进行修改，能否把数据属性修改成访问器属性（访问器属性稍候会提到）。默认<code>true</code>。</li>
<li><strong>enumerable</strong>：可枚举性。<br>　　是指：该数据属性能否通过<code>for-in</code>循环遍历到。默认为<code>true</code>。</li>
<li><strong>get</strong>：取值。<br>　　是指：读取属性时调用。</li>
<li><strong>set</strong>：赋值。<br>　　是指：赋值时调用。</li>
</ul>
<h3 id="对象共有的“特性”"><a href="#对象共有的“特性”" class="headerlink" title="对象共有的“特性”"></a>对象共有的“特性”</h3><p>　　除了属性之外，每个对象还具有3个“特性”：</p>
<ul>
<li>原型（prototype）：可以理解成一个指针，指向另一个对象-原型对象，后面将做详细讨论。</li>
<li>类（class）：是一个标识对象类型的字符串。</li>
<li>扩展标记（extensible flag）：ES5新增，表明是否可以向该对象添加新属性。</li>
</ul>
<hr>
<h2 id="JavaScript对象创建方式"><a href="#JavaScript对象创建方式" class="headerlink" title="JavaScript对象创建方式"></a>JavaScript对象创建方式</h2><p>　　了解了对象的基本概念后，就可以进一步分析对象的创建方式。在《JavaScript高级程序设计》中具体分为7种：</p>
<ul>
<li>工厂模式</li>
<li>构造函数模式</li>
<li>原型模式</li>
<li>组合模式（构造函数+原型）</li>
<li>动态原型模式</li>
<li>寄生构造函数模式</li>
<li>稳妥构造模式</li>
</ul>
<p>　　而在《JavaScript权威指南》中，对象创建方式分为3种：</p>
<ul>
<li>对象字面量创建（<code>var obj = {}</code>）</li>
<li>关键字<code>new</code>构造函数创建</li>
<li><code>Object.create()</code>基于原型创建</li>
</ul>
<p>　　分为这3类，虽说内容和上面的基本一致，但考虑问题的角度不同，个人感觉没有层层递进（《JavaScript权威指南》的分类标准是从本质上区分了创建对象的3种方式，但不利于初次理解）。因此建议理解的过程按照《JavaScript高级程序设计》进行，之后可以再看《JavaScript权威指南》补缺。本文也是按照《JavaScript高级程序设计》进行总结。<br>　　对于7种分类的方式而言，其基础还是“构造函数模式”和“原型模式”两种，其他的都是因为解决之前的某种缺陷而逐步演进得来的，因此下面重点分析这两个。
　　</p>
<hr>
<h2 id="创建对象-构造函数模式（constructor属性相关）"><a href="#创建对象-构造函数模式（constructor属性相关）" class="headerlink" title="创建对象-构造函数模式（constructor属性相关）"></a>创建对象-构造函数模式（constructor属性相关）</h2><h3 id="工厂模式与构造函数模式的对比"><a href="#工厂模式与构造函数模式的对比" class="headerlink" title="工厂模式与构造函数模式的对比"></a>工厂模式与构造函数模式的对比</h3><p>　　在看构造函数模式之前，先看一个工厂模式的例子，从而和构造函数模式进行对比。</p>
<blockquote>
<p>使用工厂模式创建对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createNews</span>(<span class="params">title, subtitle</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.title = title;</span><br><span class="line">    o.subtitle = subtitle;</span><br><span class="line">    o.release = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(o.title + <span class="string">"--"</span> + o.subtitle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstNews = createNews(<span class="string">"important news"</span>, <span class="string">"strategy"</span>);</span><br><span class="line"><span class="keyword">var</span> secondNews = createNews(<span class="string">"interesting news"</span>, <span class="string">"strategy"</span>);</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>　　接下来看看用构造函数模式如何重构上述代码：</p>
<blockquote>
<p>使用构造函数模式创建对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">News</span>(<span class="params">title, subtitle</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">    <span class="keyword">this</span>.subtitle = subtitle;</span><br><span class="line">    <span class="keyword">this</span>.release = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.title + <span class="string">"--"</span> + <span class="keyword">this</span>.subtitle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstNews = <span class="keyword">new</span> News(<span class="string">"important news"</span>, <span class="string">"strategy"</span>);</span><br><span class="line"><span class="keyword">var</span> secondNews = <span class="keyword">new</span> News(<span class="string">"interesting news"</span>, <span class="string">"strategy"</span>);</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>　　对比可得构造函数模式的特点：</p>
<ol>
<li>函数名一般首字母大写，代表这是一类特殊的函数-构造函数；</li>
<li>构造函数内并不直接新建对象，所以自然也不会返回初始化好的对象；</li>
<li>使用构造函数时明确要用<code>new</code>关键字，具体的调用经历了如下四个步骤：</li>
</ol>
<ul>
<li><code>new</code>创建一个新对象</li>
<li>将构造函数的作用域赋给这个新对象</li>
<li>执行构造函数中的代码，添加属性</li>
<li>得到初始化好的新对象</li>
</ul>
<p>　　</p>
<h3 id="对象的constructor属性"><a href="#对象的constructor属性" class="headerlink" title="对象的constructor属性"></a>对象的constructor属性</h3><p>　　以上构造函数模式代码中的firstNews和secondNews两个对象分别保存着News的一个实例（是不同的）。<font color="red">这里就要提到constructor了。firstNews和secondNews两个对象各自有一个constructor属性-构造函数属性。</font>如下所示：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-constructor-1.png" alt=""></p>
<p>　　换句话说，<strong>由构造函数创建的对象</strong>，它有一个constructor属性，属性值为构造函数本身（指向构造函数），如下所示：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-constructor-2.png" alt=""></p>
<p>　　而对于<strong>使用工厂模式创建的对象</strong>，也具有constructor属性，只不过直接指向“最高层”的对象Object，如下所示：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-constructor-3.png" alt=""></p>
<p>　　对于<strong>字面量直接创建的对象</strong>，也具有constructor属性，也是直接指向“最高层”的对象Object，如下所示：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-constructor-4.png" alt=""></p>
<p>　　对于<strong><code>Object.create()</code>方法创建的对象</strong>，也具有constructor属性，也是直接指向“最高层”的对象Object，如下所示：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-constructor-5.png" alt=""></p>
<p>　　以上内容可总结如下：</p>
<ol>
<li><p>任何对象都具有constructor属性。</p>
<blockquote>
<p>注意，这里顺便说一下，即便是原始类型的数据，也可以调用constructor属性，原因应该是，JavaScript自动将其转换为对应的包装类型（对象），再调用相应包装类型的constructor属性（对象），如下图所示：（当然，null和undefined没有属性和方法，也就不用讨论了）<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-constructor-6.png" alt=""></p>
</blockquote>
</li>
<li><p>使用构造函数模式创建的对象，其constructor指向创建该对象的构造函数</p>
</li>
<li>其他各类对象，其constructor指向Object()函数</li>
</ol>
<h3 id="构造函数模式存在的缺陷"><a href="#构造函数模式存在的缺陷" class="headerlink" title="构造函数模式存在的缺陷"></a>构造函数模式存在的缺陷</h3><p>　　相比于工厂模式，构造函数模式有其优点—它可以准确识别创建的对象的类型。但是，它本身也存在问题：构造函数中的方法，在每个新创建的对象上都要重新实例化一次，也就是说每个对象的该方法都不是同一个实例，然而它们的作用却是相同的，这就增大了开销。<br>　　为了解决这个问题，可以采取的方法是：把构造函数中的方法单独剥离出来，提出全局作用域上的函数，而在构造函数内部仅保留对这个全局函数的引用。这样，通过构造函数创建的所有实例都是共享了同一个函数。<strong>但是，这又产生了新的问题：</strong>如果构造函数中需要很多方法，全部都提到全局作用域中，就破坏了封装性，结构很不好。对于此问题，则需要采用下面提到的原型模式了。</p>
<hr>
<h2 id="创建对象-原型模式（prototype属性相关）"><a href="#创建对象-原型模式（prototype属性相关）" class="headerlink" title="创建对象-原型模式（prototype属性相关）"></a>创建对象-原型模式（prototype属性相关）</h2><h3 id="原型模式的案例"><a href="#原型模式的案例" class="headerlink" title="原型模式的案例"></a>原型模式的案例</h3><blockquote>
<p>使用原型模式模式创建对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">News</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">News.prototype.title = <span class="string">"important news"</span>;</span><br><span class="line">News.prototype.subtitle = <span class="string">"strategy"</span>;</span><br><span class="line">News.prototype.release = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.title + <span class="string">"--"</span> + <span class="keyword">this</span>.subtitle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstNews = <span class="keyword">new</span> News();</span><br><span class="line">firstNews.title;        <span class="comment">//"important news"</span></span><br><span class="line"><span class="keyword">var</span> secondNews = <span class="keyword">new</span> News();</span><br><span class="line">secondNews.subtitle;    <span class="comment">//"strategy"</span></span><br><span class="line"></span><br><span class="line">firstNews.title = <span class="string">"interesting news"</span>;</span><br><span class="line">firstNews.title;        <span class="comment">//"interesting news"</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>　　每个函数其实都有一个prototype（原型）属性，这个属性是一个指针，指向一个对象-原型对象，而这个对象的作用是包含好可以由特定类型的实例所共享的属性和方法。因此，如上所示，构造函数是空的也可以（但必须有这个构造函数），需要共享的内容写在prototype对象上就好了。</p>
<h3 id="理解原型对象（prototype属性）"><a href="#理解原型对象（prototype属性）" class="headerlink" title="理解原型对象（prototype属性）"></a>理解原型对象（prototype属性）</h3><p>　　到底什么是原型对象呢？<br>　　首先，我们看看上述例子中通过原型模式创建的对象实例firstNews的原型对象是什么：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-1.png" alt=""></p>
<p>　　这里发现显示的结果是<code>undefined</code>？原型对象没有定义吗？不是这样的。是因为在JavaScript中，prototype是一个内部属性，没有提供标准的直接访问方式，但是在各个主流浏览器的实现中，为我们提供了<code>__proto__</code>属性，可以帮我们“窥探”一个对象的原型对象。如下所示：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-2.png" alt=""></p>
<p>  从上图我们能清楚地看到firstNews的原型对象的结构，<font color="red">并且和constructor联系起来了</font>：</p>
<ol>
<li>原型对象有一个constructor属性，它反过来指向了创建该实例的构造函数</li>
<li>原型对象本身有我们自定义的两个属性title、subtitle和一个方法release()</li>
<li><p>从另一个角度（“继承”的角度），原型对象自己可以看做是一个实例对象，它自己也有prototype属性（指向它的原型对象），并且通过<code>__proto__</code>表现出来。</p>
<p>其次，上述是创建了函数对象，那么对于其他几种方式创建的对象呢？我们来看看：</p>
</li>
</ol>
<p><strong>通过字面量直接创建对象</strong><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-3.png" alt=""></p>
<p>可以看出，对象的prototype属性时存在的，并且由于没有构造函数，它的constructor属性直接指向了Object,也就是说字面量对象是由Object()直接创建的。</p>
<p><strong>通过<code>Object.create()</code>创建对象</strong><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-4.png" alt=""></p>
<p>可以看出，实例对象o的原型对象是{x:1, y:2}，并且不带任何诸如constructor之类的属性。原因是，根据API<code>Object.create((proto [, propertiesObject ]))</code>，传入的参数就是要创建的对象的原型proto。传入的是{x:1, y:2}，因此<code>__proto__</code>的结果自然也就是{x:1, y:2}。</p>
<p>通过以上分析，可作总结：<br>1.任何时候，只要创建一个对象，就会有prototype属性，并且大多数情况通过<code>__proto__</code>进行展现<br>2.在此基础上，通过构造函数创建对象稍有特殊（因为constructor不会直接指向Object）。只要创建了一个新的函数对象，就会根据一组特定规则为函数创建一个prototype属性，这个属性指向函数的原型对象。并且，默认的这个原型对象又会自动获取一个constructor属性，反过来指向prototype属性所在的函数（也就是构造函数）。通过以下实验可以很好理解这一点：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-5.png" alt=""></p>
<p>　　值得说明的是，根据之前提到的，prototype是内部属性不能直接访问（否则会报错），用<code>__proto__</code>可以间接访问，所以上图是通过<code>firstNews.__proto__.constructor</code>来测试的。但实际上我们要讨论的是<code>firstNews.prototype.constructor</code>，即prototype和constructor的关系，要特别注意这一点。</p>
<p>3.<font color="red"><strong>但是，要特别注意</strong>,以上所说的<code>prototype</code>是内部属性无法访问，是针对创建的实例对象。而对于函数对象，是可以直接访问<code>prototype</code>属性的</font>，如下所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-14.png" alt=""></p>
<blockquote>
<p><code>prototype</code>和<code>__proto__</code>还有更多区别，详见这篇文章<a href="http://gcidea.info/2016/06/12/js-proto-prototype/" target="_blank" rel="external">JavaScript中<code>__proto__</code>和<code>prototype</code>的对比分析</a></p>
</blockquote>
<p>4.可以通过下图更好地理解prototype和constructor的关系。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-6.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-7.png" alt="">
　　</p>
<h3 id="原型链操作"><a href="#原型链操作" class="headerlink" title="原型链操作"></a>原型链操作</h3><p>　　每次执行对象属性的读取操作时，其实就是执行了一次搜索。搜索会从实例对象本身开始，如果找到了该属性，则返回该属性的值；如果没有找到，则会根据实例对象的prototype指针找到该实例对象的原型对象，在原型对象上执行搜索。如果找到了，则返回该属性的值；如果没找到，则继续向上，根据原型对象的prototype指针向上查找… …，这样就形成了“链式结构”，也就是原型链。<br>　　关于原型链操作必须明确的是：<font color="red">只有在查询属性值的操作中才会感觉到原型链的存在，在修改属性值的过程中是没有原型链的概念的，也就是说修改属性值只会在实例对象中对原有属性进行覆盖，但并不会影响原型链上上层对象中的属性。</font>通过如下过程可以理解：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-8.png" alt=""></p>
<h3 id="某个属性属于谁？（实例-or-原型？）"><a href="#某个属性属于谁？（实例-or-原型？）" class="headerlink" title="某个属性属于谁？（实例 or 原型？）"></a>某个属性属于谁？（实例 or 原型？）</h3><p>　　根据原型链操作的分析，对象属性在实例中和原型中的表现可能是不一样的，但自然就产生了这样的需求：某个属性是属于实例还是原型？<br>　　JavaScript主要提供了以下几种方式来解决这个问题：</p>
<ol>
<li><p>单独使用<code>in</code>操作符<br>　　格式：<code>&quot;title&quot; in firstNews;</code></p>
<blockquote>
<p><code>in</code>操作符能筛选出一个属性，无论它是在实例中还是原型中。</p>
</blockquote>
</li>
<li><p>使用<code>for-in</code>循环<br>　　格式：<code>for(var prop in firstNews){}</code></p>
<blockquote>
<p><code>for-in</code>循环会返回所有可枚举的属性，无论它是在实例中还是原型中。</p>
</blockquote>
</li>
<li><p>使用<code>Object.keys()</code><br>　　格式：<code>Object.keys(obj)</code></p>
<blockquote>
<p><code>Object.keys()</code>会返回所有可枚举的属性，仅来自实例对象。</p>
</blockquote>
</li>
<li><p>使用<code>Object.getOwnPropertyNames()</code><br>　　格式：<code>Object.getOwnPropertyNames(obj)</code></p>
<blockquote>
<p><code>Object.keys()</code>会返回所有属性（无论是否可枚举），仅来自实例对象。</p>
</blockquote>
</li>
</ol>
<h3 id="原型对象的重写"><a href="#原型对象的重写" class="headerlink" title="原型对象的重写"></a>原型对象的重写</h3><p>　　写法如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">News</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">News.prototype = &#123;</span><br><span class="line">    title: <span class="string">"important news"</span>,</span><br><span class="line">    subtitle: <span class="string">"strategy"</span>,</span><br><span class="line">    release: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.title + <span class="string">"--"</span> + <span class="keyword">this</span>.subtitle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstNews = <span class="keyword">new</span> News();</span><br></pre></td></tr></table></figure></p>
<p>　　这样的写法不是另一种模式，只是为了说明一个问题。根据之前的分析，我们知道<code>firstNews.constructor</code>会指向构造函数本身，也就是<code>function News(){}</code>。那么在现在这样的写法中，<code>firstNews.constructor</code>还是指向<code>function News(){}</code>吗？答案是否定的，如下：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-9.png" alt=""><br>　　可以发现现在指向了<code>function Object()</code>，为什么呢？<br>　　原因是，在这种写法中，直接将一个”{}”对象赋给了<code>News.prototype</code>，本质上是完全重写了<code>News.prototype</code>，而不是像之前只是给<code>News.prototype</code>添加属性，比如<code>News.prototype.title</code>。因此，<code>News.prototype</code>的constructor属性也就发生了变化，变成了新的”{}”对象的constructor属性，而新对象”{}”是字面量直接对象，根据之前的分析知道它的constructor属性指向<code>function Object()</code>，所以现在的<code>firstNews.constructor</code>指向了<code>function Object()</code>。<br>　　如果想恢复到原来的状态，可以显式声明prototype对象的constructor属性：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-10.png" alt=""></p>
<h3 id="原型对象的动态性"><a href="#原型对象的动态性" class="headerlink" title="原型对象的动态性"></a>原型对象的动态性</h3><p>　　根据原型链操作的分析，每一次属性获取都是一次查询，因此可以动态向原型中添加属性，并且可以立即反映出来。<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-11.png" alt=""></p>
<p>　　但是，如果是重写整个原型对象，情况就不同了：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-12.png" alt=""><br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/js-prototype-13.png" alt=""></p>
<h3 id="原生对象的原型"><a href="#原生对象的原型" class="headerlink" title="原生对象的原型"></a>原生对象的原型</h3><p>　　原生对象是指String()、Number()、Boolean()等包装类型产生的对象，它们的原型对象也是可以自定义的。但是，并不应该直接去修改这些内置类型的原型，因为可能会产生命名空间冲突，移植性差。</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>　　通过上述过程，详细分析了JavaScript中对象创建的相关方法和极其重要的两个属性constructor和prototype。关于JavaScript中的“类的继承”将会在后续单独讨论（以此篇为基础）。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p78.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中值传递和引用传递的典例探究</title>
    <link href="http://www.gcidea.info/2016/12/27/js-value-copy-reference-copy/"/>
    <id>http://www.gcidea.info/2016/12/27/js-value-copy-reference-copy/</id>
    <published>2016-12-27T03:18:20.000Z</published>
    <updated>2017-02-11T05:28:27.631Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p93.jpg" alt=""></p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>　　在Javascript中，基本类型（null, undefined, number, string, boolean, symbol）是通过值传递方式进行，而复合类型（object, array, function）则是通过引用传递方式进行。<br>　　但是，由于Javascript工作机制所决定，在js中，引用指向的其实是值，而无法指向其他引用，这和其他语言中的指针并不相同。<br>　　其实，两者都可以算是“值”传递，只不过“值传递”传递的是基本类型本来的值，而“引用传递”传递的则是复合对象的地址值。</p>
<hr>
<h2 id="值传递"><a href="#值传递" class="headerlink" title="值传递"></a>值传递</h2><p>案例一：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line">b++;</span><br><span class="line">b;  <span class="comment">//3</span></span><br><span class="line">a;  <span class="comment">//2</span></span><br></pre></td></tr></table></figure></p>
<p>上例说明基本类型的a的值在赋值给b时，是将2这个值赋给了b，此后b++不会改变a的值。</p>
<p>案例二：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line">b.push(<span class="number">4</span>);</span><br><span class="line">b;  <span class="comment">//[1,2,3,4]</span></span><br><span class="line">a;  <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure></p>
<p>上例说明复合类型的a在赋值给b时，是将2内存中[1,2,3,4]这个对象的引用赋给了b，因此a,b实际上操作的是一个地址中的内容。</p>
<hr>
<h2 id="引用传递"><a href="#引用传递" class="headerlink" title="引用传递"></a>引用传递</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	x.push(<span class="number">4</span>);</span><br><span class="line">	x;  <span class="comment">//[1,2,3,4]</span></span><br><span class="line"></span><br><span class="line">	x = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line">	x.push(<span class="number">7</span>);</span><br><span class="line">	x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">foo(a);</span><br><span class="line"></span><br><span class="line">a;  <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure>
<p>该例中函数foo()接收一个复合类型对象作为参数。按照引用传递的规则，可以理解为变量a所引用的对象[1,2,3]在内存中的地址被赋给了x，在foo()内部所做的操作，会直接影响到a所代表的值。但是，<code>x = [4,5,6];</code>相当于以字面量的形式将x所指向的内存中的地址进行了改变（一个新对象，其值为[4,5,6]），因此这部分不会体现在a中。</p>
<hr>
<h2 id="两者的“互相转换”"><a href="#两者的“互相转换”" class="headerlink" title="两者的“互相转换”"></a>两者的“互相转换”</h2><p>1.对于符合类型的，即对象，如果想按照值传递来实现某些功能（即不影响传入的实参本身），那么就要创建一个副本。比如对于数组，使用<code>foo(a.slice())</code>，通过slice()方法对a进行一次浅复制。</p>
<p>2.对于基本类型的，如果想按照引用传递的效果实现某些功能（即能够改变传入函数并将其本身进行修改），那么就要将该值封装到一个复合类型（数组，对象等）中，然后通过引用传递的方式进行传递。如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">	obj.a = <span class="string">"new value"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">	a : <span class="string">"old value"</span></span><br><span class="line">&#125;</span><br><span class="line">foo(bar);</span><br><span class="line">bar.a; <span class="comment">// new value</span></span><br></pre></td></tr></table></figure></p>
<p>但是，这并不是说将基本类型装箱为对应的包装类型再传入函数就可以达到这种效果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">Number</span>(a);</span><br><span class="line">foo(b);</span><br><span class="line">a; <span class="comment">// 2</span></span><br><span class="line">b; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></p>
<p>原因是foo()内部在进行加法操作时候对x进行了自动拆箱。x变成了基本类型值，但是外部的b仍然指向有Number()构造出的对象，因此是2，不是加1后的3。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p93.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中创建对象的7种模式和实现继承的6种方式</title>
    <link href="http://www.gcidea.info/2016/12/20/js-7-create-object-solutions-6-inherit-solutions/"/>
    <id>http://www.gcidea.info/2016/12/20/js-7-create-object-solutions-6-inherit-solutions/</id>
    <published>2016-12-20T14:40:47.000Z</published>
    <updated>2017-02-11T06:27:20.861Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p64.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　JavaScript是一种面向对象（OO）的语言，但由于ECMAScript没有类的概念（ES6引入关键字class），所以在js中创建对象的方法也与其他基于类的语言有所不同。本篇总结在JavaScript中创建对象的7种方法；并在此基础上，总结实现继承的6种方式。</p>
<hr>
<h2 id="JavaScript中对象的基本概念"><a href="#JavaScript中对象的基本概念" class="headerlink" title="JavaScript中对象的基本概念"></a>JavaScript中对象的基本概念</h2><h3 id="创建对象的2种基本方法"><a href="#创建对象的2种基本方法" class="headerlink" title="创建对象的2种基本方法"></a>创建对象的2种基本方法</h3><hr>
<h4 id="创建一个Object实例"><a href="#创建一个Object实例" class="headerlink" title="创建一个Object实例"></a>创建一个Object实例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">person.name = <span class="string">"Bob"</span>;</span><br><span class="line">person.age = <span class="number">24</span>;</span><br><span class="line">person.greet = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">` </span><br><span class="line">　　通过上述方法，创建了一个对象，并为其添加了3个属性，属性值有字符串，数字，函数。</span><br><span class="line">#### 对象字面量</span><br><span class="line">`</span><span class="string">``</span> javascript</span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">	name: <span class="string">"Bob"</span>,</span><br><span class="line">	age: <span class="number">24</span>,</span><br><span class="line">	greet: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alert(<span class="keyword">this</span>.name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　 创建的对象与上述相同，只不过使用<code>{}</code>的字面量方式创建。</p>
<h3 id="属性与特性"><a href="#属性与特性" class="headerlink" title="属性与特性"></a>属性与特性</h3><p>　　关于属性和特性的细节，可以参考<a href="http://www.gcidea.info/2016/05/10/js-attribute-property/">JavaScript中attribute(特性)和property(属性)的对比分析</a>。对象就是由众多的属性(property)构成的，而每个属性(property)又具有多个特性(attribute)。这些特性(attribute)是为了实现JavaScript引擎使用的，在JavaScript语言使用中不能直接访问它们。为了表示是内部值，将各个特性(attribute)放在两对方括号<code>[[]]</code>中表示。</p>
<h4 id="数据属性的特性"><a href="#数据属性的特性" class="headerlink" title="数据属性的特性"></a>数据属性的特性</h4><p>1.<code>[[Configurable]]</code></p>
<ul>
<li>名称：可配置性。</li>
<li>默认值：true</li>
<li>含义：能否通过delete删除属性并重新定义；能否修改属性的这几个特性；能否把数据属性修改为访问器属性。</li>
</ul>
<p>2.<code>[[Enumerable]]</code></p>
<ul>
<li>名称：可枚举性。</li>
<li>默认值：true</li>
<li>含义：能否通过通过for-in循环返回当前属性。</li>
</ul>
<p>3.<code>[[Writable]]</code></p>
<ul>
<li>名称：可写性。</li>
<li>默认值：true</li>
<li>含义：能否修改当前属性的值。</li>
</ul>
<p>4.<code>[[Value]]</code></p>
<ul>
<li>名称：值。</li>
<li>默认值：undefined</li>
<li>含义：读属性值，从这个位置读；写入属性时，保存在这个位置。</li>
</ul>
<h4 id="访问器属性的特性"><a href="#访问器属性的特性" class="headerlink" title="访问器属性的特性"></a>访问器属性的特性</h4><p>1.<code>[[Configurable]]</code></p>
<ul>
<li>名称：可配置性。</li>
<li>默认值：true</li>
<li>含义：能否通过delete删除属性并重新定义；能否修改属性的这几个特性；能否把访问器属性修改为数据属性。</li>
</ul>
<p>2.<code>[[Enumerable]]</code></p>
<ul>
<li>名称：可枚举性。</li>
<li>默认值：true</li>
<li>含义：能否通过通过for-in循环返回当前属性。</li>
</ul>
<p>3.<code>[[Get]]</code></p>
<ul>
<li>名称：值。</li>
<li>默认值：undefined</li>
<li>含义：读属性值时调用该函数。</li>
</ul>
<p>4.<code>[[Set]]</code></p>
<ul>
<li>名称：值。</li>
<li>默认值：undefined</li>
<li>含义：写属性值时调用该函数。</li>
</ul>
<h3 id="ES5新增的关于Object的几个实用方法"><a href="#ES5新增的关于Object的几个实用方法" class="headerlink" title="ES5新增的关于Object的几个实用方法"></a>ES5新增的关于Object的几个实用方法</h3><p>1.<code>Object.defineProperty()</code><br>使用示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">"name"</span>,&#123;</span><br><span class="line">	configurable: <span class="literal">false</span>,</span><br><span class="line">	value: <span class="string">"Bob"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>2.<code>Object.defineProperties()</code><br>使用示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(book, &#123;</span><br><span class="line">	_year: &#123;</span><br><span class="line">		writable: <span class="literal">true</span>,</span><br><span class="line">		value: <span class="number">2016</span></span><br><span class="line">	&#125;,</span><br><span class="line">	edition: &#123;</span><br><span class="line">		writable: <span class="literal">true</span>,</span><br><span class="line">		value: <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>3.<code>Object.getOwnPropertyDescriptor()</code><br>使用示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(book, &#123;</span><br><span class="line">	_year: &#123;</span><br><span class="line">		writable: <span class="literal">true</span>,</span><br><span class="line">		value: <span class="number">2016</span></span><br><span class="line">	&#125;,</span><br><span class="line">	edition: &#123;</span><br><span class="line">		writable: <span class="literal">true</span>,</span><br><span class="line">		value: <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book, <span class="string">"_year"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(desc.value);  <span class="comment">//2016</span></span><br></pre></td></tr></table></figure></p>
<p>4.<code>Object.getOwnPropertyNames()</code><br>5.<code>Object.isPrototypeOf()</code><br>6.<code>Object.create()</code><br>7.<code>Object.keys()</code><br>8.<code>XXX.getPrototypeOf()</code><br>9.<code>XXX.hasOwnProperty()</code></p>
<hr>
<h2 id="创建对象的7种模式"><a href="#创建对象的7种模式" class="headerlink" title="创建对象的7种模式"></a>创建对象的7种模式</h2><h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><p>示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">	o.name = name;</span><br><span class="line">	o.age = age;</span><br><span class="line">	o.job = job;</span><br><span class="line">	o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alert(<span class="keyword">this</span>.name);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = createPerson(<span class="string">"A"</span>, <span class="number">25</span>, <span class="string">"teacher"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = createPerson(<span class="string">"B"</span>, <span class="number">26</span>, <span class="string">"engineer"</span>);</span><br></pre></td></tr></table></figure></p>
<p>说明：<br>1.函数createPerson()就是一个工厂，该工厂内部封装了生成对象的细节（新建对象实例并初始化等）</p>
<p>2.正如名字表示的，通过该函数可以批量创建多个同类型对象，而不必书写大量重复代码</p>
<p>3.工厂模式缺点：未解决对象识别问题—无法知道对象的类型</p>
<h3 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h3><p>示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.age = age;</span><br><span class="line">	<span class="keyword">this</span>.job = job;</span><br><span class="line">	<span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alert(<span class="keyword">this</span>.name);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"A"</span>, <span class="number">25</span>, <span class="string">"teacher"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"B"</span>, <span class="number">26</span>, <span class="string">"engineer"</span>);</span><br></pre></td></tr></table></figure></p>
<p>说明：<br>1.函数Person()未显式创建对象，且无返回值</p>
<p>2.使用<code>new</code>关键字调用构造函数</p>
<p>3.约定构造函数首字母大写</p>
<p>4.关于对象类型：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alert(person1.constructor == Person); <span class="comment">//true</span></span><br><span class="line">alert(person2.constructor == Person); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">alert(person1 <span class="keyword">instanceof</span> Person); <span class="comment">//true</span></span><br><span class="line">alert(person2 <span class="keyword">instanceof</span> Person); <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<p>5.如果构造函数不像<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"A"</span>, <span class="number">25</span>, <span class="string">"teacher"</span>);</span><br></pre></td></tr></table></figure></p>
<p>这样通过new关键字来调用，而是直接<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person(<span class="string">"A"</span>, <span class="number">25</span>, <span class="string">"teacher"</span>);</span><br></pre></td></tr></table></figure></p>
<p>也是可以使用的，只不过生成的对象会直接添加到宿主对象上，在浏览器中就是<code>window</code>对象上。</p>
<p>6.构造函数模式缺点：<br><strong>由于将函数绑定到了特定的对象实例上面，每个方法都要在每个实例上重新创建一遍，浪费空间且并没有什么用处。</strong><br>以下可以证明这一点：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(person1.sayName == person2.sayName); <span class="comment">//false</span></span><br></pre></td></tr></table></figure></p>
<p>为此，我们可以让构造函数创建的对象中的方法共享函数，也就是在方法属性处不显式声明函数，而只是写明一个函数引用，将这个函数移至构造函数外部。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.age = age;</span><br><span class="line">	<span class="keyword">this</span>.job = job;</span><br><span class="line">	<span class="keyword">this</span>.sayName = sayName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"A"</span>, <span class="number">25</span>, <span class="string">"teacher"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"B"</span>, <span class="number">26</span>, <span class="string">"engineer"</span>);</span><br></pre></td></tr></table></figure></p>
<p>可是这种方法又会有新的缺点：</p>
<ul>
<li>身在全局作用于中的函数sayName()却只能用于让构造函数调用，让全局作用域名不副实</li>
<li>如果构造函数有很多方法属性，那么就要在全局作用于中写很多函数，代码结构松散，毫无封装性可言</li>
</ul>
<p>在这种情况下，考虑使用原型模式来解决。</p>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.name = <span class="string">"Nicholas"</span>;</span><br><span class="line">Person.prototype.age = <span class="number">29</span>;</span><br><span class="line">Person.prototype.job = <span class="string">"Software Engineer"</span>;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.sayName();   <span class="comment">//"Nicholas"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line">person2.sayName();   <span class="comment">//"Nicholas"</span></span><br><span class="line"></span><br><span class="line">alert(person1.sayName == person2.sayName);  <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">alert(Person.prototype.isPrototypeOf(person1));  <span class="comment">//true</span></span><br><span class="line">alert(Person.prototype.isPrototypeOf(person2));  <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>原型模式的缺点：<br>1.所有实例在默认情况下都将取得相同的值。<br>2.由于共享属性，一旦一个对象修改，可能引发其他变量意外地受到影响。<br>如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: Person,</span><br><span class="line">    name : "Nicholas",</span><br><span class="line">    age : 29,</span><br><span class="line">    job : "Software Engineer",</span><br><span class="line">    friends : ["Shelby", "Court"],</span><br><span class="line">    sayName : function () &#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line">person1.friends.push(<span class="string">"Van"</span>);</span><br><span class="line"></span><br><span class="line">alert(person1.friends);    <span class="comment">//"Shelby,Court,Van"</span></span><br><span class="line">alert(person2.friends);    <span class="comment">//"Shelby,Court,Van"</span></span><br><span class="line">alert(person1.friends === person2.friends);  <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="组合使用构造函数模式和原型模式"><a href="#组合使用构造函数模式和原型模式" class="headerlink" title="组合使用构造函数模式和原型模式"></a>组合使用构造函数模式和原型模式</h3><p>核心：构造函数模式用于定义实例属性，原型模式用于定义方法和共享属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.name = name;</span><br><span class="line">    o.age = age;</span><br><span class="line">    o.job = job;</span><br><span class="line">    o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;    </span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">"Nicholas"</span>, <span class="number">29</span>, <span class="string">"Software Engineer"</span>);</span><br><span class="line">friend.sayName();  <span class="comment">//"Nicholas"</span></span><br></pre></td></tr></table></figure></p>
<p>以上方式是目前应用最广泛、认可度最高的方式。</p>
<h3 id="动态原型模式"><a href="#动态原型模式" class="headerlink" title="动态原型模式"></a>动态原型模式</h3><p>该种方式将所有信息封装在构造函数中，通过在构造函数中“有选择”地初始化原型，来保持构造函数模式+原型模式的有点。所谓的“有选择的”，是指针对工厂模式中多次创建实例上功能相同的函数的问题，在构造函数内部通过判断实例方法的类型（即是否存在）来保证实例方法只创建一次。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//properties</span></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.job = job;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//methods</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.sayName != <span class="string">"function"</span>)&#123;</span><br><span class="line">    </span><br><span class="line">        Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            alert(<span class="keyword">this</span>.name);</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">"Nicholas"</span>, <span class="number">29</span>, <span class="string">"Software Engineer"</span>);</span><br><span class="line">friend.sayName();</span><br></pre></td></tr></table></figure></p>
<h3 id="寄生构造函数模式"><a href="#寄生构造函数模式" class="headerlink" title="寄生构造函数模式"></a>寄生构造函数模式</h3><p>这是一种和工厂模式非常类似的方法，只不过使用时要加上关键字<code>new</code>，要说明的是，在构造函数内部创建的对象与构造函数的原型没有什么关系，因此不能通过instanceof操作来判断由此创建的对象的类型。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SpecialArray</span>(<span class="params"></span>)</span>&#123;       </span><br><span class="line"></span><br><span class="line">    <span class="comment">//create the array</span></span><br><span class="line">    <span class="keyword">var</span> values = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//add the values</span></span><br><span class="line">    values.push.apply(values, <span class="built_in">arguments</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//assign the method</span></span><br><span class="line">    values.toPipedString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.join(<span class="string">"|"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//return it</span></span><br><span class="line">    <span class="keyword">return</span> values;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> SpecialArray(<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>);</span><br><span class="line">alert(colors.toPipedString()); <span class="comment">//"red|blue|green"</span></span><br><span class="line"></span><br><span class="line">alert(colors <span class="keyword">instanceof</span> SpecialArray);</span><br></pre></td></tr></table></figure></p>
<h3 id="稳妥构造函数模式"><a href="#稳妥构造函数模式" class="headerlink" title="稳妥构造函数模式"></a>稳妥构造函数模式</h3><p>与寄生模式相比，这种模式的实例方法不引用this，不用<code>new</code>操作符。在这种模式下，除了调用相应属性的get方法，无法访问内部变量，保证了安全性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;       </span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.name = name;</span><br><span class="line">    o.age = age;</span><br><span class="line">    o.job = job;</span><br><span class="line">    o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(name);</span><br><span class="line">    &#125;;    </span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="实现继承的6种方式"><a href="#实现继承的6种方式" class="headerlink" title="实现继承的6种方式"></a>实现继承的6种方式</h2><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.property = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SuperType.prototype.getSuperValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.property;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.subproperty = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//inherit from SuperType</span></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line"></span><br><span class="line">SubType.prototype.getSubValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.subproperty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType();</span><br><span class="line">alert(instance.getSuperValue());   <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">alert(instance <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">//true</span></span><br><span class="line">alert(instance <span class="keyword">instanceof</span> SuperType);   <span class="comment">//true</span></span><br><span class="line">alert(instance <span class="keyword">instanceof</span> SubType);     <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">Object</span>.prototype.isPrototypeOf(instance));    <span class="comment">//true</span></span><br><span class="line">alert(SuperType.prototype.isPrototypeOf(instance)); <span class="comment">//true</span></span><br><span class="line">alert(SubType.prototype.isPrototypeOf(instance));   <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>原型链继承主要有以下两个问题：<br>1.当原型包含引用类型值，一个实例对变量的修改会影响到其他变量：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123;            </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//inherit from SuperType</span></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> SubType();</span><br><span class="line">instance1.colors.push(<span class="string">"black"</span>);</span><br><span class="line">alert(instance1.colors);    <span class="comment">//"red,blue,green,black"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> SubType();</span><br><span class="line">alert(instance2.colors);    <span class="comment">//"red,blue,green,black"</span></span><br></pre></td></tr></table></figure></p>
<p>2.在创建子类型的实例时，没有办法在不影响所有实例的情况下向超类构造函数传递参数。</p>
<h3 id="借用构造函数"><a href="#借用构造函数" class="headerlink" title="借用构造函数"></a>借用构造函数</h3><p>核心：在子类型内部调用超类型构造函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">//inherit from SuperType</span></span><br><span class="line">    SuperType.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> SubType();</span><br><span class="line">instance1.colors.push(<span class="string">"black"</span>);</span><br><span class="line">alert(instance1.colors);    <span class="comment">//"red,blue,green,black"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> SubType();</span><br><span class="line">alert(instance2.colors);    <span class="comment">//"red,blue,green"</span></span><br></pre></td></tr></table></figure></p>
<p>存在的问题：<br>1.方法都在构造函数中定义，函数复用无从谈起。<br>2.超类型的原型中定义的方法，对子类型不可见。</p>
<h3 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h3><p>核心：原型继承+借用构造函数。<br>使用原型链实现对原型属性和方法的继承，使用借用构造函数模式实现对实例属性的继承。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>)</span>&#123;  </span><br><span class="line">    SuperType.call(<span class="keyword">this</span>, name);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line"></span><br><span class="line">SubType.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.age);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> SubType(<span class="string">"Nicholas"</span>, <span class="number">29</span>);</span><br><span class="line">instance1.colors.push(<span class="string">"black"</span>);</span><br><span class="line">alert(instance1.colors);  <span class="comment">//"red,blue,green,black"</span></span><br><span class="line">instance1.sayName();      <span class="comment">//"Nicholas";</span></span><br><span class="line">instance1.sayAge();       <span class="comment">//29</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> SubType(<span class="string">"Greg"</span>, <span class="number">27</span>);</span><br><span class="line">alert(instance2.colors);  <span class="comment">//"red,blue,green"</span></span><br><span class="line">instance2.sayName();      <span class="comment">//"Greg";</span></span><br><span class="line">instance2.sayAge();       <span class="comment">//27</span></span><br></pre></td></tr></table></figure></p>
<h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h3><p>在给出一个想要作为基础的（即被继承）的对象的条件下，可以使用这种方式实现继承。但其问题和原型链继承类似，不同实例会共享属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    F.prototype = o;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">"Nicholas"</span>,</span><br><span class="line">    friends: [<span class="string">"Shelby"</span>, <span class="string">"Court"</span>, <span class="string">"Van"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> anotherPerson = object(person);</span><br><span class="line">anotherPerson.name = <span class="string">"Greg"</span>;</span><br><span class="line">anotherPerson.friends.push(<span class="string">"Rob"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> yetAnotherPerson = object(person);</span><br><span class="line">yetAnotherPerson.name = <span class="string">"Linda"</span>;</span><br><span class="line">yetAnotherPerson.friends.push(<span class="string">"Barbie"</span>);</span><br><span class="line"></span><br><span class="line">alert(person.friends);   <span class="comment">//"Shelby,Court,Van,Rob,Barbie"</span></span><br></pre></td></tr></table></figure></p>
<p>ES5的<code>Object.create(obj)</code>方法对此做出了规范：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">"Nicholas"</span>,</span><br><span class="line">    friends: [<span class="string">"Shelby"</span>, <span class="string">"Court"</span>, <span class="string">"Van"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> anotherPerson = <span class="built_in">Object</span>.create(person);</span><br><span class="line">anotherPerson.name = <span class="string">"Greg"</span>;</span><br><span class="line">anotherPerson.friends.push(<span class="string">"Rob"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> yetAnotherPerson = <span class="built_in">Object</span>.create(person);</span><br><span class="line">yetAnotherPerson.name = <span class="string">"Linda"</span>;</span><br><span class="line">yetAnotherPerson.friends.push(<span class="string">"Barbie"</span>);</span><br><span class="line"></span><br><span class="line">alert(person.friends);   <span class="comment">//"Shelby,Court,Van,Rob,Barbie"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h3><p>该种方式和原型式继承紧密相关，思路与寄生构造函数和工厂模式类似。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAnother</span>(<span class="params">original</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> clone = object(original);</span><br><span class="line">	clone.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">"hi"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>和构造函数模式类似，函数无法复用会降低效率。</p>
<h3 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h3><p>组合继承的问题在于，会调用两次超类型的构造函数：<br>1.创建声明子类型原型的时候，这时候会在子类型原型上具有一组超类型的实例变量。<br>2.调用子类型构造函数的时候，这时候会在子类型实例上具有一组超类型的实例变量，他们会屏蔽掉超类上的实例变量（原型链查找机制）<br>下面的寄生组合式继承可以避免这个问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">subType, superType </span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> prototype = object(superType.prototype);</span><br><span class="line">	prototype.constructor = subType;</span><br><span class="line">	subType.prototype = prototype;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释：<br>1.创建超类型的一个副本<br>2.添加constructor属性，从而弥补因为重写原型而失去的默认的prototype属性<br>3.将新创建的超类副本赋值给子类原型</p>
<p>好处：<br>只在var prototype = object(superType.prototype);时获取了超类型的属性，避免了在子类实例化时候重写这些不必要的属性。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p64.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>关于JavaScript生成器generator和yield的一些理解</title>
    <link href="http://www.gcidea.info/2016/12/19/js-yield/"/>
    <id>http://www.gcidea.info/2016/12/19/js-yield/</id>
    <published>2016-12-19T13:07:31.000Z</published>
    <updated>2017-02-16T03:21:00.114Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p95.jpg" alt=""></p>
<h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2><p>　　Generator（生成器）函数是ES6提供的一种异步编程解决方案，而yield则是配合生成器函数使用的。</p>
<hr>
<h2 id="Generator函数"><a href="#Generator函数" class="headerlink" title="Generator函数"></a>Generator函数</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>　　function* 声明（function关键字后跟一个星号）定义一个generator（生成器）函数，返回一个Generator对象。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><code>function* name([param[, param[, ... param]]]) { statements }</code><br>其中：</p>
<ul>
<li>name<br>函数名</li>
<li>param<br>传入函数的参数名，一个函数至多可有255个参数。</li>
<li>statements<br>函数的主体</li>
</ul>
<blockquote>
<p>注：ES6没有规定，function关键字与函数名之间的星号必须写在哪个位置，因此下面的写法都正确，但是还是推荐上述写法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">name</span>(<span class="params">[param[, param[, ... param]]]</span>) </span>&#123; statements &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">name</span>(<span class="params">[param[, param[, ... param]]]</span>) </span>&#123; statements &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>*<span class="title">name</span>(<span class="params">[param[, param[, ... param]]]</span>) </span>&#123; statements &#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>　　生成器是一种可以从中退出并在之后重新进入的函数。生成器的环境（绑定的变量）会在每次执行后被保存，下次进入时可继续使用。调用一个生成器函数并不马上执行它的主体，而是返回一个这个生成器函数的迭代器（iterator）对象。当这个迭代器的next()方法被调用时：</p>
<ul>
<li>生成器函数的主体会被执行直至第一个yield表达式，该表达式定义了迭代器返回的值；</li>
<li>或者，被 yield*委派至另一个生成器函数。</li>
</ul>
<p>next()方法返回一个对象，该对象有一个value属性，表示产出的值，和一个done属性，表示生成器是否已经产出了它最后的值。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">idMaker</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(index&lt;<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">yield</span> index++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gen = idMaker();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>　　yield 关键字用来暂停和继续一个生成器函数。</p>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><p><code>yield [[expression]];</code></p>
<ul>
<li>expression<br>用作返回值.  如果忽略, 将返回 undefined .</li>
</ul>
<h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>　　yield关键字使生成器函数暂停执行，并返回跟在它后面的表达式的当前值。可以把它想成是return关键字的一个基于生成器的版本。yield 关键字实际返回一个对象，包含两个属性value和done。value属性为yield expression的值,done是一个布尔值用来指示生成器函数是否已经全部完成。<br>一旦在yield expression处暂停, 除非外部调用生成器的next()方法，否则生成器的代码将不能继续执行。这使得可以对生成器的执行以及渐进式的返回值进行直接控制。</p>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>同上示例。</p>
<hr>
<h2 id="yield-1"><a href="#yield-1" class="headerlink" title="yield*"></a>yield*</h2><h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><p>　　在生成器中，<code>yield*</code> 可以把需要yield的值委托给另外一个生成器或者其他任意的可迭代对象。</p>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p><code>yield* [[expression]];</code></p>
<ul>
<li>expression<br>任意的可迭代对象。</li>
</ul>
<h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>　yield* 一个可迭代对象，就相当于把这个可迭代对象的所有迭代值分次yield出去。yield* 表达式本身的值就是当前可迭代对象迭代完毕（当done为true时）时的返回值。</p>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span>* g1();</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = g2();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 3, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 4, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 5, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol>
<li>yield语句不能用在普通函数（即不带有*的function）中，否则会报错。</li>
<li>Generator函数可以不用yield语句，这时就变成了一个单纯的暂缓执行函数。</li>
<li>Generator函数是分段执行的，yield语句是暂停执行的标记，而next方法可以恢复执行。</li>
<li>参考文档：<a href="http://es6.ruanyifeng.com/#docs/generator" target="_blank" rel="external">阮一峰 ECMAScript6入门</a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/function*" target="_blank" rel="external">MDN官方文档</a>。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p95.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;综述&quot;&gt;&lt;a href=&quot;#综述&quot; class=&quot;headerlink&quot; title=&quot;综述&quot;&gt;&lt;/a&gt;综述&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Base64编码探究</title>
    <link href="http://www.gcidea.info/2016/12/17/base64/"/>
    <id>http://www.gcidea.info/2016/12/17/base64/</id>
    <published>2016-12-17T03:20:30.000Z</published>
    <updated>2017-02-11T06:28:43.673Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p13.jpg" alt=""></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>　　Base64编码是网络传输中的一种常见编码方式。可用于传输任意的8bit(字节Byte)数据，经过编码后的数据不是直接可读的，但也由此保证了一定的安全性和很好的可移植性。这种编解码的算法十分简单，编码后的数据大小仅增加三分之一左右(原因后续讲到)，因而不会对传输造成过大压力。<br>　　我们需要明确的概念是，Base64编码<strong>本质上是将二进制数据编码为文本字符</strong>。而这些二进制数据的来源则可能有很多，比如：</p>
<blockquote>
<ul>
<li>本来就是二进制数据</li>
<li>本来是英文字母或数字，则有对应的ASCII编码，ASCII表一般会表示为十进制和十六进制的值，自然也有对应的二进制值</li>
<li>本来是汉字，可能是多种编码得到的，比如采用UTF-8编码得到，则该汉字的UTF-8编码的值可以用二进制表示</li>
<li>…</li>
</ul>
</blockquote>
<p>上述各种类型的文本转换为二进制后，就可以使用Base64进行编码了。</p>
<hr>
<h2 id="官方规范"><a href="#官方规范" class="headerlink" title="官方规范"></a>官方规范</h2><p>　　Base64编码是作为MIME多用途互联网邮件扩展标准的一部分进行开发的。MIME RFC 2045的6.8节详细介绍了这种编码方式，参见<a href="http://www.ietf.org/rfc/rfc2045.txt.pdf" target="_blank" rel="external">http://www.ietf.org/rfc/rfc2045.txt.pdf</a>，这是Base64编码的官方规范。</p>
<hr>
<h2 id="Base64字母表"><a href="#Base64字母表" class="headerlink" title="Base64字母表"></a>Base64字母表</h2><p>由名字也可以看出，Base64编码将任意字符转换为用下表64个字符(中的某些)进行表示(具体原理稍候分析)。<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/base64-alphabet.png" alt=""></p>
<p>图中最后的<code>(pad) =</code>是Base64编码中使用的填充字符，用于补足，在后面的原理分析中会看到。 </p>
<hr>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>　　之前已经提到过Base64编码是对“字节数据”做处理。一个字节是8bit，也就是8个二进制位。假设现在有一个英文字符串，每个字符由1个字节（8bit）构成，则对应了一个字节序列。Base64编码将这些8位的字节序列拆分成多个6位的片段，计算这个6位二进制数对应的十进制值，根据该十进制值查Base64字母表，使用表中的字符指代该片段。（2^6=64,64种符号刚好可以表示6位二进制数的全部情况。）下面展示了一个具体的例子：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/base64-example.png" alt=""></p>
<p>　　通过这样的分析，我们也就可以知道为什么Base64编码字符串比原始字符串扩大约三分之一：原来一个字符用8位表示，现在6位就代表一个字符，所以扩大(8-6)/6=1/3。<br>　　<br>　　还有一个问题需要考虑：8位的字节序列不一定总能分割成整数个6位的片段。这时候，为了正常编码，就要在原序列末尾补足，使得序列长度成为24的倍数（6,8的最小公倍数）：</p>
<ul>
<li>如果要进行补足的6位片段中包含原序列的位，则使用0补足，构成的6位二进制数按照正常情况进行查表得出对应的编码字符。</li>
<li>如果要进行补足的6位片段中包含原序列的位（即这个片段的6位都是用来补足的，并不含原数据），则这个片段编码为填充字符<code>=</code><br>如下示例：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/base64-example2.png" alt=""></li>
</ul>
<hr>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>Base64编码有很广泛的应用：</p>
<ol>
<li><p>用户输入文本数据可通过Base64编码打包后作为HTTP首部字段的值发送给服务端</p>
</li>
<li><p>HTML5的FileAPI进行文件读取的示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取文件:</span></span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = e.target.result; </span><br><span class="line">    preview.style.backgroundImage = <span class="string">"url("</span> + data + <span class="string">")"</span>;</span><br><span class="line">    preview.style.backgroundSize =<span class="string">'300px 200px'</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>其中变量data保存的是’image/jpeg;base64,/9j/4AAQSk……’这就是典型的Base64编码。编码值作为url()方法的参数去设置background-image。</p>
<blockquote>
<p>注：url()方法不仅可以接受文件路径作为参数，也可以传入上述的这种data类型url，主要有以下几种：<br>data:,&lt;文本数据&gt;<br>data:text/plain,&lt;文本数据&gt;<br>data:text/html,<html代码><br>data:text/html;base64,<base64编码的html代码><br>data:text/css,<css代码><br>data:text/css;base64,<base64编码的css代码><br>data:text/javascript,<javascript代码><br>data:text/javascript;base64,<base64编码的javascript代码><br>data:image/gif;base64,base64编码的gif图片数据<br>data:image/png;base64,base64编码的png图片数据<br>data:image/jpeg;base64,base64编码的jpeg图片数据<br>data:image/x-icon;base64,base64编码的icon图片数据</base64编码的javascript代码></javascript代码></base64编码的css代码></css代码></base64编码的html代码></html代码></p>
</blockquote>
<p>3.上面提到过，Base64编码是作为邮件协议进行开发的。电子邮件一般使用SMTP协议将邮件从客户端发往服务端，使用POP3或者IMAP从服务端获取邮件。最初SMTP协议基于纯ASCII文本，对二进制数据（文件）支持不好，为了解决这个问题，有了base64编码，即对二进制数据进行编码得到ASCII串使其能够正常通过SMTP协议进行传输。<code>Content-Transfer-Encoding: base64</code>表示附件文件内容使用base64编码后传输。</p>
<p>4.HTTP请求需要携带参数，比如GET方法是直接在url中进行参数拼接，这些可能需要转换为适合通过HTTP进行传输的数据，这就可以使用Base64编码。但是，经过Base64编码得到的文本中会包含<code>+ /</code>这样的符号，而这些会在URL编码时被转义，因此还有一些变种的Base64编码，比如它不仅在末尾填充’=’号，并将标准Base64中的“+”和“/”分别改成了“-”和“_”，这样就免去了在URL编解码和数据库存储时所要作的转换。</p>
<hr>
<h2 id="JavaScript实现"><a href="#JavaScript实现" class="headerlink" title="JavaScript实现"></a>JavaScript实现</h2><p>　　使用原生js的实现比较麻烦，这里推荐一个类库<a href="https://github.com/dankogai/js-base64" target="_blank" rel="external">js-base64</a>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p13.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="FE综合" scheme="http://www.gcidea.info/categories/FE%E7%BB%BC%E5%90%88/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="编码" scheme="http://www.gcidea.info/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>使用WebStorm创建webpack工作流的前端项目</title>
    <link href="http://www.gcidea.info/2016/12/16/webpack-demos/"/>
    <id>http://www.gcidea.info/2016/12/16/webpack-demos/</id>
    <published>2016-12-16T15:33:51.000Z</published>
    <updated>2017-02-16T03:19:51.034Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p113.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　webpack是一款极为灵活的前端模块打包构建工具。其诞生和流行主要是由于以下这几个发展趋势：</p>
<ul>
<li>为了完成更加复杂的交互逻辑，一个网页中使用的js代码数量越来越多；</li>
<li>即便有了更多代码，却要求使用中有更少的整页面重新加载；</li>
<li>现代浏览器提供了更多的API接口。</li>
</ul>
<p>　　基于这样的情况，大量代码就需要能够被良好地管理起来，像webpack这样的模块系统就为我们将代码切分为若干模块提供了很好的选择。本篇在webstorm编辑器中构建了一个最简单的使用webpack管理的前端项目，算是对webpack使用的入门探究。</p>
<hr>
<h2 id="JS模块化编程相关背景"><a href="#JS模块化编程相关背景" class="headerlink" title="JS模块化编程相关背景"></a>JS模块化编程相关背景</h2><p>　　在前端开发中有很多定义模块依赖的方法：</p>
<ul>
<li>在html页面中使用<code>&lt;script&gt;</code>标签手动引入（这并没有使用模块管理系统）<br>　　在这种方式下，各模块是将接口暴露给了全局对象，比如window。常见问题：</li>
</ul>
<ol>
<li>全局对象中的命名变量冲突</li>
<li>各js文件加载顺序十分重要，一旦A依赖B而A又在B之前引入，则会报错</li>
<li>需要开发者自己来维护和解决依赖的问题</li>
<li>在大型项目中可能需要引入数十个js文件，代码冗长，难于管理</li>
</ol>
<ul>
<li>编写符合CommonJS规范的代码<br>　　这种规范使用同步的<code>require</code>方法加载依赖，并返回一个暴露出的接口，一个模块可以通过给<code>export</code>对象指定属性的方式来指定输出：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"module"</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"../file.js"</span>);</span><br><span class="line">exports.doStuff = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = someValue;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>　　这种方式主要用在服务端，比如Node.js。</p>
<ul>
<li><p>编写符合AMD规范的代码<br>　　这种规范使用异步的<code>require</code>方法加载依赖，主要适用于客户端，因为在客户端如果同步加载的话会阻塞页面渲染等其他内容的进行，造成假死。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">"module"</span>, <span class="string">"../file"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">module, file</span>) </span>&#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">define(<span class="string">"mymodule"</span>, [<span class="string">"dep1"</span>, <span class="string">"dep2"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">d1, d2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> someExportedValue;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用ES6标准原生模块<br>　　ECMAScript 2015 (6th Edition)给javascript语言增加了新的内容-import关键字，从而构成了另一个模块系统</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"jquery"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">doStuff</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">module</span> <span class="string">"localModule"</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="什么是webpack？"><a href="#什么是webpack？" class="headerlink" title="什么是webpack？"></a>什么是webpack？</h2><p>一句话来概括：webpack能够将相互依赖的模块进行打包，并生成代表着这些模块的静态文件。<br>官网上给出的示意图如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack.png" alt=""></p>
<p>　　市面上已经存在的模块管理和打包工具并不适合大型的项目，尤其单页面Web应用程序。最紧迫的原因是如何在一个大规模的代码库中，维护各种模块资源的分割和存放，维护它们之间的依赖关系，并且无缝的将它们整合到一起生成适合浏览器端请求加载的静态资源。这些已有的模块化工具并不能很好的完成如下的目标：</p>
<ul>
<li>将依赖树拆分成按需加载的块</li>
<li>初始化加载的耗时尽量少</li>
<li>各种静态资源都可以视作模块</li>
<li>将第三方库整合成模块的能力</li>
<li>可以自定义打包逻辑的能力</li>
<li>适合大项目，无论是单页还是多页的Web应用</li>
</ul>
<p>webpack有以下明显特点：</p>
<ol>
<li>代码拆分<br>　　Webpack 有两种组织模块依赖的方式，同步和异步。异步依赖作为分割点，形成一个新的块。在优化了依赖树后，每一个异步区块都作为一个文件被打包。</li>
<li>Loader<br>　　Webpack 本身只能处理原生的 JavaScript 模块，但是 loader 转换器可以将各种类型的资源转换成 JavaScript 模块。这样，任何资源都可以成为 Webpack 可以处理的模块。</li>
<li>智能解析<br>　　Webpack 有一个智能解析器，几乎可以处理任何第三方库，无论它们的模块形式是 CommonJS、 AMD 还是普通的 JS 文件。甚至在加载依赖的时候，允许使用动态表达式 require(“./templates/“ + name + “.jade”)。</li>
<li>插件系统<br>　　Webpack 还有一个功能丰富的插件系统。大多数内容功能都是基于这个插件系统运行的，还可以开发和使用开源的 Webpack 插件，来满足各式各样的需求。</li>
<li>快速运行<br>　　Webpack 使用异步 I/O 和多级缓存提高运行效率，这使得 Webpack 能够以令人难以置信的速度快速增量编译。</li>
</ol>
<hr>
<h2 id="webpack的安装"><a href="#webpack的安装" class="headerlink" title="webpack的安装"></a>webpack的安装</h2><p>1.安装Node.js<br>　　关于Node.js的安装有很多参考，在之前的文章<a href="http://localhost:4000/2016/03/16/2016-03-16-my-first-blog/#安装Node-js" target="_blank" rel="external">【首篇】记录本博客www.gcidea.info的搭建过程</a>也有提及。</p>
<p>2.安装webpack<br>2.1 打开webstorm，创建一个新文件夹webpack-usage作为根目录，后续所有操作都在该项目中完成：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-2.png" alt=""></p>
<p>2.2 Node.js安装完成后，会同时安装npm这个Node.js的包管理工具。我们使用这个工具全局安装webpack。打开Terminal窗口输入如下命令：<br><code>$ npm install webpack -g</code><br>可以看到安装过程正在进行：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-3.png" alt=""></p>
<p>完成后，显示信息如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-4.png" alt=""></p>
<p>3.在项目中添加webpack<br>　　根据最佳实践，最好也在具体的项目中添加webpack。这样的话你可以任意指定在该项目中使用的webpack版本，而不至于局限于使用全局的唯一版本。<br>3.1 为此，通过命令在项目根目录下创建package.json文件，将项目通过npm管理起来：<br><code>npm init</code><br>这个过程中需要填写一些信息，最终会写入package.json：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-5.png" alt=""></p>
<p>之后，项目根目录下多了一个文件，正是package.json：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-6.png" alt=""></p>
<p>3.2 此时，再通过如下命令安装webpack，其中<code>--save-dev</code>表示会将webpack添加到package.json的devDependencies中：<br><code>npm install webpack --save-dev</code></p>
<p>并且，该命令会自动检查安装webpack所需的全部依赖，执行该命令后，项目有3处变化：控制台打印出依赖结构树；根目录下生成node_modules文件夹用于存放所有依赖包；package.json中多出一个devDependencies属性。如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-7.png" alt=""></p>
<p>4.安装webpack-dev-server<br>　　这是一个Node.js Express server，可以帮我们在本地建立一个服务器。此处仅安装，具体使用在下文描述。<br><code>npm install webpack-dev-server --save-dev</code></p>
<p>可以预想，现在package.json文件的依赖项已经变为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^1.13.2"</span>,</span><br><span class="line">    <span class="string">"webpack-dev-server"</span>: <span class="string">"^1.16.2"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="webpack的使用"><a href="#webpack的使用" class="headerlink" title="webpack的使用"></a>webpack的使用</h2><h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><p>1.新建cats.js文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cats = [<span class="string">'dave'</span>, <span class="string">'henry'</span>, <span class="string">'martha'</span>];</span><br><span class="line"><span class="built_in">module</span>.exports = cats;</span><br></pre></td></tr></table></figure></p>
<p>2.新建app.js文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cats = <span class="built_in">require</span>(<span class="string">'./cats.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(cats);</span><br></pre></td></tr></table></figure></p>
<p>3.使用webpack命令进行打包<br><code>webpack ./app.js app.bundle.js</code><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-8.png" alt=""></p>
<p>结果如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-9.png" alt=""></p>
<p>可以发现webpack已经帮我们将两个文件合并在一起并加入很多其他内容，这个过程在官方上详细描述如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-10.png" alt=""></p>
<p>现在，假如我们要将项目部署上线，那么只需要打包后的静态文件即可，实验如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-11.png" alt=""></p>
<p>可以看出，在node环境下执行打包文件，可以正常输出源文件的执行结果。</p>
<hr>
<h3 id="规范使用"><a href="#规范使用" class="headerlink" title="规范使用"></a>规范使用</h3><hr>
<h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><p>　　现在我们已经具备基本的webpack环境且大致了解了webpack的打包使用。为了规范使用，删除app.bundle.js,app.js,cat.js,重新规定项目目录结构如下：</p>
<ul>
<li>src：存放源码</li>
<li>build: 打包后静态文件目录</li>
<li>node_modules: node模块依赖目录</li>
<li>webpack.config.js：webpack配置目录–使用命令行携带参数的方式不便于扩展，统一用此文件管理</li>
<li>index.html: 项目入口页面</li>
</ul>
<p>修改后的项目结构如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-12.png" alt=""></p>
<hr>
<h4 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h4><p><strong>配置webpack.config.js</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">'./build'</span>,</span><br><span class="line">        filename: <span class="string">'app.bundle.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p> 　　以上简单的配置表示指定webpack打包入口为./src/app.js文件，打包结果为app.bundle.js，在./build目录下。</p>
<p> 　　该文件还有很多配置项，详见：<a href="http://webpack.github.io/docs/configuration.html" target="_blank" rel="external">http://webpack.github.io/docs/configuration.html</a></p>
<p> 现在，只需要简单的命令<code>webpack</code>而不需要参数，就可以执行打包。</p>
<hr>
<h4 id="使用loaders"><a href="#使用loaders" class="headerlink" title="使用loaders"></a>使用loaders</h4><p> 　　webpack只能对原生javascript文件打包，但是通过各种强大的loaders，我们可以处理各种类型的文件。Loader 可以理解为是模块和资源的转换器，它本身是一个函数，接受源文件作为参数，返回转换的结果。这样，我们就可以通过 require 来加载任何类型的模块或文件，比如 CoffeeScript、 JSX、 LESS 或图片。<br> 　　loaders具备以下特性：</p>
<ul>
<li>Loader 可以通过管道方式链式调用，每个 loader 可以把资源转换成任意格式并传递给下一个<br>loader ，但是最后一个 loader 必须返回 JavaScript。</li>
<li>Loader 可以同步或异步执行。</li>
<li>Loader 运行在 node.js 环境中，所以可以做任何可能的事情。</li>
<li>Loader 可以接受参数，以此来传递配置项给 loader。</li>
<li>Loader 可以通过文件扩展名（或正则表达式）绑定给不同类型的文件。</li>
<li>Loader 可以通过 npm 发布和安装。</li>
</ul>
<p>　　为了使浏览器能够解析，使用ES6语法编写的代码需要使用babel进行转码，为此我们安装babel-loader。<br>1.安装Babel 和 presets<br><code>npm install --save-dev babel-core babel-preset-es2015</code><br>2.安装babel-loader<br><code>npm install --save-dev babel-loader</code><br>3.在根目录创建Babel配置文件—.babelrc<br>内容为： <code>{ &quot;presets&quot;: [ &quot;es2015&quot; ] }</code><br>4.修改webpack.config.js如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">'./build'</span>,</span><br><span class="line">        filename: <span class="string">'app.bundle.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            loader: <span class="string">'babel-loader'</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="安装其他可能需要的库"><a href="#安装其他可能需要的库" class="headerlink" title="安装其他可能需要的库"></a>安装其他可能需要的库</h4><p> <code>npm install --save jquery babel-polyfill</code></p>
<blockquote>
<p><code>--save</code>而非<code>--save-dev</code>表示库将会在运行环境使用<br><code>--save-dev</code>的内容将会放在package.json 的devDependencies<br>而<code>--save</code>会放在dependencies里面<br>产品模式用dependencies，开发模式用devDependencies<br>因此将会实际运行在用户端浏览器环境中的库就要采用<code>--save</code>安装<br>通过使用babel-polyfill可以让老版本浏览器能够使用ES6新提供的API</p>
</blockquote>
<hr>
<h4 id="修改app-js文件（ES6语法-jquery库）"><a href="#修改app-js文件（ES6语法-jquery库）" class="headerlink" title="修改app.js文件（ES6语法+jquery库）"></a>修改app.js文件（ES6语法+jquery库）</h4> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'babel-polyfill'</span>;</span><br><span class="line"><span class="keyword">import</span> cats <span class="keyword">from</span> <span class="string">'./cats'</span>;</span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">'&lt;h1&gt;Cats&lt;/h1&gt;'</span>).appendTo(<span class="string">'body'</span>);</span><br><span class="line"><span class="keyword">const</span> ul = $(<span class="string">'&lt;ul&gt;&lt;/ul&gt;'</span>).appendTo(<span class="string">'body'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> cat <span class="keyword">of</span> cats) &#123;</span><br><span class="line">    $(<span class="string">'&lt;li&gt;&lt;/li&gt;'</span>).text(cat).appendTo(ul);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将以上代码写入后，编辑器会报错：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-13.png" alt=""></p>
<p>原因是编辑器未能识别ES6语法，在webstorm的settings中做如下配置即可：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-14.png" alt=""></p>
</blockquote>
<hr>
<h4 id="编辑index-html文件"><a href="#编辑index-html文件" class="headerlink" title="编辑index.html文件"></a>编辑index.html文件</h4> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"build/app.bundle.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="重新打包"><a href="#重新打包" class="headerlink" title="重新打包"></a>重新打包</h4><p> <code>webpack</code></p>
<hr>
<h4 id="访问index-html"><a href="#访问index-html" class="headerlink" title="访问index.html"></a>访问index.html</h4><p>可以看到正确结果<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-15.png" alt=""></p>
<hr>
<h4 id="使用plugins"><a href="#使用plugins" class="headerlink" title="使用plugins"></a>使用plugins</h4><p>　　在打包的工作流中可能还会有一些其他的操作，会使用到不同的插件plugins，比较典型的就是uglify plugin这个压缩工具。为此，在webpack.config.js中增加配置项plugins：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">'./build'</span>,</span><br><span class="line">        filename: <span class="string">'app.bundle.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            loader: <span class="string">'babel-loader'</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">            compress: &#123;</span><br><span class="line">                warnings: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            output: &#123;</span><br><span class="line">                comments: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在执行命令<code>webpack</code>重新打包之前，我们先看看app.bundle.js的文件大小,为523KB：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-16.png" alt=""></p>
<p>现在执行命令<code>webpack</code>重新打包，再看app.bundle.js的文件大小,为171KB：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-17.png" alt=""></p>
<p>可以看到，压缩工具去掉了无用的空字符等：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-18.png" alt=""></p>
<hr>
<h2 id="webpack中的重要工具：webpack-dev-server"><a href="#webpack中的重要工具：webpack-dev-server" class="headerlink" title="webpack中的重要工具：webpack-dev-server"></a>webpack中的重要工具：webpack-dev-server</h2><p>　　webpack-dev-server本质上是一个小型的Node.js的Express服务器，使用webpack-dev-middleware作为中间件来支持webpack打包。</p>
<h3 id="安装webpack-dev-server"><a href="#安装webpack-dev-server" class="headerlink" title="安装webpack-dev-server"></a>安装webpack-dev-server</h3><p><code>npm install webpack-dev-server</code><br>package.json变为如下形式：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"webpack-usage"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"webpack-usage-demo"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"gaochang"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-core"</span>: <span class="string">"^6.17.0"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"^6.2.5"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015"</span>: <span class="string">"^6.16.0"</span>,</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^1.13.2"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^1.16.2"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-polyfill"</span>: <span class="string">"^6.16.0"</span>,</span><br><span class="line">    <span class="attr">"jquery"</span>: <span class="string">"^3.1.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="启动webpack-dev-server"><a href="#启动webpack-dev-server" class="headerlink" title="启动webpack-dev-server"></a>启动webpack-dev-server</h3><p>　　安装完成后，在不指定任何参数的情况下，可以直接通过命令<code>webpack-dev-server</code>在本地8080端口运行一个服务器，访问<code>http://localhost:8080</code>可以看到效果：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-19.png" alt=""></p>
<p>访问<code>http://localhost:8080/webpack-dev-server/</code> 可以显示webpack服务器状态条<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-20.png" alt=""></p>
<h3 id="指定content-base"><a href="#指定content-base" class="headerlink" title="指定content base"></a>指定content base</h3><p>webpack-dev-server默认监控的是当前目录的文件，除非声明一个特殊的基本路径：<br><code>webpack-dev-server --content-base build/</code><br>这样的话，webpack就会只监控build文件夹下的静态文件。当你的文件在任何时候发生变化时，都会触发重新编译打包。验证如下：<br>1.使用上述命令启动server：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-21.png" alt=""></p>
<p>控制台会显示打包过程日志，并最终提示打包完成已经可用：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-22.png" alt=""></p>
<p>2.此时，访问<code>http://localhost:8080/webpack-dev-server/</code>可看到：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-23.png" alt=""></p>
<p>即显示了build目录下的文件列表，此时只有app.bundle.js，点开内容如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-24.png" alt=""></p>
<p>红色框中是我们app.js中的部分源码。</p>
<p>3.现在修改上述部分源码，观察控制台日志和<code>http://localhost:8080/webpack-dev-server/</code>目录下文件变化。<br>修改<code>&lt;h1&gt;</code>内容后，发现控制台日志在之前“bundle is now VALID”的基础上，自动开始重新编译，进入“bundle is now INVALID”的状态：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-25.png" alt=""></p>
<p>同时，看到页面状态条变为：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-26.png" alt=""></p>
<p>等待重编译完成后，发现页面文件内容确实变为我们修改后的内容：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-27.png" alt=""></p>
<p>但是，<strong>值得注意的是，这个修改的内容是保存在内存中的</strong>，并没有写入我们在webpack.config.js的output中指定的文件：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-28.png" alt=""></p>
<p>发现文件还是修改之前的内容。也就是说，当相同URL下已经有一个打包的文件时，默认情况下内存中的文件享有优先权。<strong>而如果想要让build目录下的输出文件的内容也跟随发生变化，则要使用<code>webpack</code>命令重新打包</strong>。</p>
<hr>
<p>除了以上分析，还有一点要注意，通过给webpack.config.js的output指定publicPath，可以定制浏览器中的项目访问路径。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: <span class="string">'./build'</span>,</span><br><span class="line">    publicPath: <span class="string">"/assets/"</span>,</span><br><span class="line">    filename: <span class="string">'app.bundle.js'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重新打包，可以在如下路径访问相应文件：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-29.png" alt=""></p>
<p>由于之前content-base指定了监控build目录，我们<strong>在该目录下</strong>创建一个index.html文件，用来加载并使用我们打包好的js文件，而原先在项目根目录webpack-usage下创建的index.html文件就不起作用了：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>在build目录下创建的index.html文件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"assets/app.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>访问<code>http://localhost:8080/</code>：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-30.png" alt=""></p>
<p>访问<code>http://localhost:8080/webpack-dev-server</code>:<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-31.png" alt=""></p>
<p>其中，第一个是打包文件app.bundle.js本身：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-32.png" alt=""><br>注意路径为<code>http://localhost:8080/assets/app.bundle.js</code>，符合publicPath的配置。</p>
<p>第二个是根据打包文件生成的html文件，注意路径为<code>http://localhost:8080/assets/app.bundle</code>，符合publicPath的配置<br>点击“app.bundle”:<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-33.png" alt=""></p>
<p>点击“webpack-dev-server”:<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-34.png" alt=""><br>（<font color="red">该html文件仅针对app.bundle.js，和直接访问<code>http://localhost:8080/</code>对应的index.html并不相同，以上两图中没有“在build目录下创建的index.html文件”这句话就说明了这一点。</font>）</p>
<blockquote>
<p>关于js文件引入的路径，经测试发现以下几种情况，应该与webpack的文件查找算法有关，具体待进一步探究：</p>
<p>1.<code>src=&quot;assets/app.bundle.js&quot;</code> 由于publicPath指定了”/assets/“，因此这种方式肯定能找到app.bundle.js文件；</p>
<p>2.<code>src=&quot;app.bundle.js&quot;</code> 默认在build目录下找该文件，能找到</p>
<p>3.<code>src=&quot;/app.bundle.js&quot;</code> 默认在build目录下找该文件，能找到</p>
<p>4.<code>src=&quot;./app.bundle.js&quot;</code> 默认在build目录下找该文件，能找到</p>
<p>5.<code>src=&quot;../app.bundle.js&quot;</code> 默认在build目录下找该文件，能找到</p>
</blockquote>
<hr>
<h3 id="自动刷新"><a href="#自动刷新" class="headerlink" title="自动刷新"></a>自动刷新</h3><p>　　webpack-dev-server支持两种自动刷新页面的方式。并且两种方式都支持模块热替换。</p>
<h4 id="iframe模式"><a href="#iframe模式" class="headerlink" title="iframe模式"></a>iframe模式</h4><p>　　在这种方式下，页面实际上是被嵌入了一个iframe，使用这种方式不需要额外配置，只要js文件以改变，就会自动”recompiling”。直接访问<code>http://«host»:«port»/webpack-dev-server/«path»</code>，在我们的配置中就是访问<code>http://localhost:8080/webpack-dev-server/index.html</code>。该方式的特点是：</p>
<ul>
<li>无需改变配置</li>
<li>编译信息通过页面顶部信息条体现</li>
<li>浏览器地址栏不会体现出地址的变化</li>
</ul>
<h4 id="inline模式"><a href="#inline模式" class="headerlink" title="inline模式"></a>inline模式</h4><p>　　在这种方式下，我们需要额外的配置，使用以下两种方式之一：</p>
<ul>
<li>在启动命令上加参数”–inline”:<br><code>webpack-dev-server --content-base build/ --inline</code></li>
<li>在webpack.config.js加上<code>devServer: { inline: true }</code></li>
</ul>
<p>　　使用这种方式不需要给URL加上/webpack-dev-server/，直接访问<code>http://«host»:«port»/«path»</code>，在我们的配置中就是访问<code>http://localhost:8080/index.html</code></p>
<p>该方式的特点是：</p>
<ul>
<li>需要改变配置</li>
<li>编译信息通过浏览器的console体现：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-35.png" alt=""></li>
<li>浏览器地址栏会体现出地址的变化</li>
</ul>
<hr>
<h2 id="模块热替换-Hot-Module-Replacement-的应用"><a href="#模块热替换-Hot-Module-Replacement-的应用" class="headerlink" title="模块热替换 Hot Module Replacement 的应用"></a>模块热替换 Hot Module Replacement 的应用</h2><p>　　在webpack-dev-server中使用模块热替换 Hot Module Replacement最简单的办法就是在inline模式中使用。我们只需要在参数中加上”–hot”即可。<br><code>webpack-dev-server --content-base build/ --inline --hot</code></p>
<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-36.png" alt=""></p>
<p>这样，就进入了监听状态，当文件发生修改，看到console打出如下日志：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/webpack-37.png" alt=""></p>
<p>发现提示错误，热替换失败，整个页面进行了重载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[HMR] Cannot apply update. Need to do a full reload!</span><br><span class="line">[HMR] Error: Aborted because 77 is not accepted</span><br><span class="line">    at l (http://localhost:8080/assets/app.bundle.js:1:4169)</span><br><span class="line">    at f (http://localhost:8080/assets/app.bundle.js:1:3117)</span><br><span class="line">    at u (http://localhost:8080/assets/app.bundle.js:1:3017)</span><br><span class="line">    at webpackHotUpdate (http://localhost:8080/assets/app.bundle.js:1:5790)</span><br><span class="line">    at http://localhost:8080/assets/0.ae586ae503d4fe64ca9a.hot-update.js:1:1</span><br></pre></td></tr></table></figure></p>
<p>查阅了很多资料，如<a href="https://github.com/webpack/webpack-dev-server/issues/395" target="_blank" rel="external">https://github.com/webpack/webpack-dev-server/issues/395</a>，但并没有找到准确原因，暂时搁置。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p113.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;
    
    </summary>
    
      <category term="前端工程化" scheme="http://www.gcidea.info/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
    
      <category term="前端工程化" scheme="http://www.gcidea.info/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
      <category term="webpack" scheme="http://www.gcidea.info/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中的__proto__、[[prototype]]和prototype</title>
    <link href="http://www.gcidea.info/2016/12/12/js-proto-prototype/"/>
    <id>http://www.gcidea.info/2016/12/12/js-proto-prototype/</id>
    <published>2016-12-12T04:52:56.000Z</published>
    <updated>2017-02-16T03:09:57.943Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p91.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　<strong>proto</strong>、[[prototype]]和prototype三个概念及相关内容是javascript比较复杂且容易混淆的内容。本文尝试进行总结和分析。</p>
<hr>
<h2 id="prototype相关介绍"><a href="#prototype相关介绍" class="headerlink" title="prototype相关介绍"></a>prototype相关介绍</h2><p>　　待续。</p>
<hr>
<h2 id="proto-与-prototype-相关介绍"><a href="#proto-与-prototype-相关介绍" class="headerlink" title="__proto__与[[prototype]]相关介绍"></a>__proto__与[[prototype]]相关介绍</h2><p>　　待续。</p>
<h2 id="一张图分析三者的关系"><a href="#一张图分析三者的关系" class="headerlink" title="一张图分析三者的关系"></a>一张图分析三者的关系</h2><p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/prototype-proto.jpg" alt=""></p>
<hr>
<h2 id="一系列案例分析"><a href="#一系列案例分析" class="headerlink" title="一系列案例分析"></a>一系列案例分析</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.prototype === Foo.prototype);       <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__ === Foo.prototype);       <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.prototype);       <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__);       <span class="comment">//object&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype = &#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.constructor === Foo);       <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype = &#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.constructor === <span class="built_in">Object</span>);        <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype = &#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.constructor);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype = &#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__);       <span class="comment">//function Object() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype = &#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__.__proto__ === <span class="built_in">Object</span>.prototype);        <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__ === a.prototype);       <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Function</span>();</span><br><span class="line"><span class="built_in">console</span>.log(a.__proto__ === <span class="built_in">Function</span>.prototype);        <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.constructor.prototype === a.__proto__);        <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(a.constructor.prototype === Foo.prototype);        <span class="comment">//true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p91.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/categories/JavaScript/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="JavaScript" scheme="http://www.gcidea.info/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>CSS居中问题总结</title>
    <link href="http://www.gcidea.info/2016/12/09/css-center/"/>
    <id>http://www.gcidea.info/2016/12/09/css-center/</id>
    <published>2016-12-09T05:21:44.000Z</published>
    <updated>2017-02-24T02:29:45.233Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p33.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　本篇集中对CSS中的各种居中问题进行总结。整体上需要居中的元素可以分为两大类-内联元素和块级元素，而居中方式又要考虑水平和垂直两个方向。</p>
<hr>
<h2 id="内联元素居中"><a href="#内联元素居中" class="headerlink" title="内联元素居中"></a>内联元素居中</h2><h3 id="水平居中"><a href="#水平居中" class="headerlink" title="水平居中"></a>水平居中</h3><hr>
<h4 id="使用”text-align-center”"><a href="#使用”text-align-center”" class="headerlink" title="使用”text-align:center”"></a>使用”text-align:center”</h4><p>根据以下W3C的官方文档：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/w3c-css-text-align.png" alt=""></p>
<p>属性“text-align”用于描述块级元素中的行内内容如何布局。我们知道，块级元素的显示占据一整行，而行内元素可以在一行内并列显示，常用的行内元素有<code>&lt;img&gt;</code>、<code>&lt;input&gt;</code>、<code>&lt;label&gt;</code>等。默认地，块级元素中的行内元素是左对齐显示的，比如：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>CSS行内元素居中测试<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-1.png" alt=""></p>
<p>　　这种情况下我们想对行内元素<span>标签中的内容进行居中显示，则可以使用“text-align: center”。要注意的是，这个属性是用来决定行内元素的位置的，没错，但是该属性并不是写在行内元素上，而是要写在行内元素的父级元素，即块级元素这个“container”上，以此来决定内部文本的对齐方式。代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block-center</span> &#123;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>CSS行内元素居中测试<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></span></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-2.png" alt=""></p>
<h4 id="使用CSS3的flexbox”justify-content-center”"><a href="#使用CSS3的flexbox”justify-content-center”" class="headerlink" title="使用CSS3的flexbox”justify-content:center”"></a>使用CSS3的flexbox”justify-content:center”</h4><p>　　和<code>text-align</code>一样的是，justify-content也适用于父类容器上，用于设置或检索弹性盒子元素在主轴（横轴）方向上的对齐方式。当属性值为“center”时，弹性盒子元素将向行中间位置对齐。该行的子元素将相互对齐并在行中居中对齐，同时第一个元素与行的主起始位置的边距等同于最后一个元素与行的主结束位置的边距（如果剩余空间是负数，则保持两端相等长度的溢出）。<br>代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block-center</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex; <span class="comment">/*注意此处要指明flex布局*/</span></span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>CSS行内元素居中测试(此处使用justify-content)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-3.png" alt=""></p>
<h4 id="使用”display-table-cell”"><a href="#使用”display-table-cell”" class="headerlink" title="使用”display: table-cell”"></a>使用”display: table-cell”</h4><p>　　<code>display: table</code>的CSS声明能够让一个HTML元素和它的子节点像table元素一样。使用基于表格的CSS布局，使我们能够轻松定义一个单元格的边界、背景等样式，而不会产生因为使用了table标签所导致的语义化问题。代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: table;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block-center</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: table-cell;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid orangered;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#inline-1</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block-center"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"2.jpg"</span> <span class="attr">id</span>=<span class="string">"inline-1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-3-0.png" alt=""></p>
<hr>
<h3 id="垂直居中"><a href="#垂直居中" class="headerlink" title="垂直居中"></a>垂直居中</h3><hr>
<h4 id="默认情况"><a href="#默认情况" class="headerlink" title="默认情况"></a>默认情况</h4><p>　　对于上述已经水平居中的文本来说，相对于父级元素的垂直居中是默认的，不需要特殊声明，比如下面两张图，修改文本字号，它们始终处于父级div的垂直方向的中间（为了看得清楚，给父级元素加上了边框）。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-4.png" alt=""><br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-5.png" alt=""></p>
<h4 id="行内元素互相之间的垂直居中"><a href="#行内元素互相之间的垂直居中" class="headerlink" title="行内元素互相之间的垂直居中"></a>行内元素互相之间的垂直居中</h4><p>　　如果一个父级元素中有多个行内元素，那么默认它们是在父元素的基线上进行对齐排列，也就是<code>vertical-align: baseline;</code>，以行内元素-图片为例，代码为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block-center</span> &#123;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid orangered;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#inline-1</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#inline-2</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"2.jpg"</span> <span class="attr">id</span>=<span class="string">"inline-1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"3.jpg"</span> <span class="attr">id</span>=<span class="string">"inline-2"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-6.png" alt=""></p>
<p>　　此时如果不想让这些行内元素“底部对齐”呢，而是想让它们互相居中对齐，也就是图片的中线在同一条水平线上呢？那就要对行内元素本身使用<code>vertical-align: middle;</code>，代码为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block-center</span> &#123;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid orangered;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#inline-1</span> &#123;</span><br><span class="line">            <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#inline-2</span> &#123;</span><br><span class="line">            <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block-center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"2.jpg"</span> <span class="attr">id</span>=<span class="string">"inline-1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"3.jpg"</span> <span class="attr">id</span>=<span class="string">"inline-2"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-7.png" alt=""></p>
<hr>
<h2 id="块级元素居中"><a href="#块级元素居中" class="headerlink" title="块级元素居中"></a>块级元素居中</h2><h3 id="水平居中-1"><a href="#水平居中-1" class="headerlink" title="水平居中"></a>水平居中</h3><hr>
<h4 id="使用”margin-0-auto”"><a href="#使用”margin-0-auto”" class="headerlink" title="使用”margin: 0 auto”"></a>使用”margin: 0 auto”</h4><p>　　我们以最常见的块级元素-div为例，看一下居中的过程。首先创建一个div，代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-8.png" alt=""></p>
<p>　　对块级元素本身添加<code>margin: 0 auto</code>可使其水平居中，即左右的外边距margin是auto的，会根据实际屏幕大小进行自动适配。修改上述style部分：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-id">#block</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-9.png" alt=""></p>
<h4 id="使用CSS3的flexbox”justify-content-center”-1"><a href="#使用CSS3的flexbox”justify-content-center”-1" class="headerlink" title="使用CSS3的flexbox”justify-content:center”"></a>使用CSS3的flexbox”justify-content:center”</h4><p>　　<code>justify-content:center</code>不仅可以用来处理行内元素，也可以处理块级元素，为达到与上述方法相同的效果，代码为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block-core</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block-core"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果图与上面的相同。</p>
<h4 id="使用浮动配合相对定位"><a href="#使用浮动配合相对定位" class="headerlink" title="使用浮动配合相对定位"></a>使用浮动配合相对定位</h4><p>为了描述这种方法，我们通过下面的过程逐步深入分析：<br>1.考虑最简单的场景：父级div包含了子级div，代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">2px</span> solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>易于理解，效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-12.png" alt=""></p>
<p>2.上图黑色边框div是一个包裹元素，我们现在把它水平移动50%，也就是设置left属性。我们知道其默认的position属性为“static”，这种情况下left属性不起作用，因此将position改为relative，代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">2px</span> solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-13.png" alt=""></p>
<p>我们发现，此时<code>&lt;div id=&quot;wrapper&quot;&gt;</code>的左边界位于正中间，左右都是610px，也就是说，这个”left: 50%”是相对于wrapper的父级元素即body进行确定的，而body的宽度就是浏览器窗口宽度。同时发现，窗口出现了水平方向滚动条，这是由于wrapper向右进行偏移，但本身宽度又没变导致的水平方向溢出。溢出了多少呢？通过下面的操作容易看出溢出正好是浏览器宽度的一半，也就是wrapper向右偏移的距离：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-14.gif" alt=""></p>
<p>3.为了防止出现滚动条，我们可以将wrapper这个div向左浮动，即加上一句“float: left;”，效果如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-15.png" alt=""></p>
<p>4.现在，想让橙色方块水平居中，只要加50%的left就好了，代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">float</span>: left;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">2px</span> solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">left</span>: -<span class="number">50%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-16.png" alt=""></p>
<h4 id="使用”display-table-cell”-1"><a href="#使用”display-table-cell”-1" class="headerlink" title="使用”display:table-cell”"></a>使用”display:table-cell”</h4><p>　　这种方法我们将在下文中块级元素垂直居中统一介绍-使用”display:table-cell”同时达到水平和垂直居中的效果。</p>
<hr>
<h3 id="垂直居中-1"><a href="#垂直居中-1" class="headerlink" title="垂直居中"></a>垂直居中</h3><hr>
<h4 id="使用“top”属性和“margin-top”属性的结合"><a href="#使用“top”属性和“margin-top”属性的结合" class="headerlink" title="使用“top”属性和“margin-top”属性的结合"></a>使用“top”属性和“margin-top”属性的结合</h4><p>分析：<br>a. 由水平居中部分的分析我们可以知道，当元素水平居中后，在垂直方向还是“密铺”的，也就是从上到下排列，不会向下移动之类的。那么为了把元素“向下拽”，就考虑设置该元素的top属性为某个值，从而相对于父级元素在顶端有一定的空白，经过合理调整后可位于正中间。<br>b. 首先，我们要知道，css中position属性的默认值是static；其次，要知道top属性对于position值为“static”的元素不会产生任何效果。因此，想修改一个元素的top值，必须将元素的position修改为<em>不是</em>static的，这里我们改为“position: relative”。<br>c. 将top属性设置为一个百分比，这个百分比是相对于谁来说的呢？—是逐级向上寻找的，直到找到一个可以确定高度的父级元素，按照这个父级元素的高度结合百分比来设置top的具体值。这里橙色div的父级元素是<code>&lt;body&gt;</code>，再向上的父级元素是<code>&lt;html&gt;</code>。而浏览器在默认状态下，是没有给html和body一个高度的，为了使之成为刚才所说的“可以确定高度的父级元素”，将<code>&lt;body&gt;</code>和<code>&lt;html&gt;</code>的高度均设置为100%。<br>d. 既然是居中，也就是一半，我们考虑先将元素的top属性设置为50%，看看效果，代码为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-100.png" alt=""></p>
<p>e.从上图可以看出，橙色正方形的定边到浏览器窗口上方和下方的距离是一样的，都是298px，也就是说top: 50%;不是将元素居中，而是整体下移了父级元素高度的一半，这也是很好理解的。但是我们已经有了一个基础，在此基础上，通过再设置元素的margin-top,可以进行修正，margin-top是指元素的顶外边距，正值表明元素会继续下移，那么取负值即可向上，橙色正方形的高度为100px，那么margin-top取为-50px，css代码修改如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#block</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">margin-top</span>: -<span class="number">50px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-11.png" alt=""></p>
<p>我们能够看出现在已经完全居中了。</p>
<h4 id="使用CSS3“translateY”属性"><a href="#使用CSS3“translateY”属性" class="headerlink" title="使用CSS3“translateY”属性"></a>使用CSS3“translateY”属性</h4><p>　　在上面方法的基础上，将下移50%的元素向上修正时，可以采取更简单的办法：translateY(-50%)。translateY()方法通过给定一个值，将元素沿Y轴进行移动，并且，给定的是是相对于元素自身的，因此50%就表示元素自身Y方向长度的一半。负号表示沿Y轴反方向移动（Y轴正向向下）。这种方法还有一个明显的好处，就是和margin-top相比，给定的是一个比例，而不像margin-top这样写死，这样后面的可维护性也会好一些。CSS代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#block</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-50%);</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="使用CSS3的flexbox”align-items-center”"><a href="#使用CSS3的flexbox”align-items-center”" class="headerlink" title="使用CSS3的flexbox”align-items: center”"></a>使用CSS3的flexbox”align-items: center”</h4><p>　　弹性盒模型在处理居中问题上真是简单明了。上面说了两种使用flexbox进行水平居中的方法，垂直居中一样可以使用flexbox搞定，align-items 属性定义flex子项在flex容器的纵轴方向上的对齐方式;justify-content属性定义flex子项在flex容器的横轴方向上的对齐方式。代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="使用”display-table-cell”-2"><a href="#使用”display-table-cell”-2" class="headerlink" title="使用”display:table-cell”"></a>使用”display:table-cell”</h4><p>　　我们曾在内联元素的水平居中使用过这种办法，它也可以用于块级元素的水平和垂直居中。核心是使用”text-align: center; vertical-align: middle;”这两个属性。另外特别要注意的是，为了让这两个属性对于想要居中显示的块级元素生效，必须指定该块级元素为”display: inline-block;”。”display:inline-block”将对象呈递为内联对象，但是对象的内容作为块对象呈递。换句话说就是与”display: block”相比，它可以让设置了同类display属性的元素显示在同一行；与”display: inline”相比，可以对设置了该属性的元素设置高度。代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#parent</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: table;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: table-cell;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">            <span class="attribute">display</span>: inline-block;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span>display: table-cell实现块级元素水平和垂直居中<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-17.png" alt=""></p>
<h4 id="使用CSS-before-选择器"><a href="#使用CSS-before-选择器" class="headerlink" title="使用CSS :before 选择器"></a>使用CSS :before 选择器</h4><p>　　关于:before 选择器本身这里不做介绍，使用:before，在想要居中显示的元素前面追加了一个内联元素来占据相应的位置，从而达到垂直居中的效果，代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">body</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">            <span class="attribute">content</span>:<span class="string">''</span>;</span><br><span class="line">            <span class="attribute">display</span>:inline-block;</span><br><span class="line">            <span class="attribute">vertical-align</span>:middle;</span><br><span class="line">            <span class="attribute">height</span>:<span class="number">50%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-id">#block</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: orangered;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">top</span>: -<span class="number">50px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"block"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>效果如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/css-center-18.png" alt=""></p>
<hr>
<h2 id="Bootstrap中关于居中的处理"><a href="#Bootstrap中关于居中的处理" class="headerlink" title="Bootstrap中关于居中的处理"></a>Bootstrap中关于居中的处理</h2><p>　　Bootstrap中关于排版的居中提供了两个class：</p>
<ol>
<li><p>class=”text-center”<br>源码为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.text-center</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>class=”center-block”<br>源码为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.center-block</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin-right</span>: auto;</span><br><span class="line">  <span class="attribute">margin-left</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这两个类中使用到的方法在上文中都有提及。结合Bootstrap提供的其他强大的样式，容易实现各类排版。</p>
<hr>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>　　本文总结了很多使用CSS对元素进行居中的办法，CSS是十分灵活且强大的，一定还有其他更好的办法。以上所列举的方法在正常开发中应该是够用了，并且通过实现居中理解了很多相关原理，这对于排错过程中快速定位问题很重要。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p33.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="CSS/CSS3" scheme="http://www.gcidea.info/categories/CSS-CSS3/"/>
    
    
      <category term="学习笔记" scheme="http://www.gcidea.info/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="CSS/CSS3" scheme="http://www.gcidea.info/tags/CSS-CSS3/"/>
    
  </entry>
  
  <entry>
    <title>【阿里云ECS】GitLab的搭建配置过程和GitLab-CI服务的使用</title>
    <link href="http://www.gcidea.info/2016/12/05/gitlab-gitlab-ci/"/>
    <id>http://www.gcidea.info/2016/12/05/gitlab-gitlab-ci/</id>
    <published>2016-12-05T15:21:14.000Z</published>
    <updated>2017-02-11T06:31:11.692Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/p48.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　GitHub是一个十分著名并相当活跃的社区，每天有世界各地的程序员在这里分享与交流。作为开源项目或者技术分享，我们当然可以将代码维护在这里。但是对于内部项目，我们应该具备私有仓库来进行维护。GitLab就是一个很好的选择。本文主要包括以下几个方面：</p>
<ol>
<li>Git安装与使用</li>
<li>GitLab相关知识介绍</li>
<li>GitLab搭建配置的完整过程</li>
<li>GitLab-CI相关知识介绍</li>
<li>GitLab-CI安装配置的完整过程</li>
<li>GitLab-CI持续集成服务的测试</li>
<li>小结</li>
</ol>
<hr>
<h2 id="准备工具"><a href="#准备工具" class="headerlink" title="准备工具"></a>准备工具</h2><p>　　部署环境：阿里云ECS Centos7.0 64bit(已具备完整LAMP环境)<br>　　远程连接：Xshell 5<br>　　文件传输：Xftp 5</p>
<hr>
<h2 id="Git安装与使用"><a href="#Git安装与使用" class="headerlink" title="Git安装与使用"></a>Git安装与使用</h2><p>　　Git的安装是必要的，安装后我们可以从服务器clone下来GitLab仓库中的最新代码进行开发维护。Centos7自带Git，但是版本为1.8，考虑到使用新版本减少问题，决定升级至2.7.4。具体过程如下：</p>
<ol>
<li>卸载Centos7自带的Git1.8<br><code># yum remove git</code></li>
<li>下载Git2.7.4<br><code># wget https://github.com/git/git/archive/v2.7.4.tar.gz</code></li>
<li>解压该文件<br><code># tar zxvf v2.7.4.tar.gz</code></li>
<li>【配置】，configure用来生成Makefile，指定安装到 /usr/local/git，为下一步的编译做准备<br><code># ./configure --prefix=/usr/local/git</code></li>
<li>【编译】，根据makefile的定义，调用源代码、函数库、编译器来编译<br><code># make configure</code></li>
<li>【安装】<br><code># make install</code></li>
<li>将Git添加至环境变量中<br><code># echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; /etc/bashrc</code></li>
<li>在当前bash环境下读取并执行/etc/bashrc中的每一条命令，使之立刻生效<br><code># source /etc/bashrc</code></li>
</ol>
<p>经过以上过程，Git就安装完成了，我们可以查看Git的版本：<br><code># git --version</code></p>
<p>如下所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/git-version.png" alt=""></p>
<p>具体git知识的学习与git使用，参见<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">廖雪峰的git教程</a>。</p>
<hr>
<h2 id="GitLab相关知识介绍"><a href="#GitLab相关知识介绍" class="headerlink" title="GitLab相关知识介绍"></a>GitLab相关知识介绍</h2><p>　　首先，GitLab的官网是<a href="https://about.gitlab.com/gitlab-com/" target="_blank" rel="external">https://about.gitlab.com/gitlab-com/</a>，这里有最权威的文档与介绍。其次，GitLab中文社区<a href="http://www.gitlab.cc/" target="_blank" rel="external">http://www.gitlab.cc/</a>也比较活跃，可以在上面找找有没有类似的问题。<br>　　Gitlab是一个用Ruby on Rails开发的开源项目管理程序，可以通过WEB界面进行访问公开的或者私人项目。它和GitHub有类似的功能，能够浏览源代码，管理缺陷和注释。GitLab拥有Git仓库管理，code reviews(代码审查)，issue tracking(问题跟踪)，wikis等功能，GitLab搭配GitLab CI，能更简单的实现持续集成和自动部署。还可以使用issue，milestones，逐行code reviwe等功能进行团队协作，查看项目动态。GitLab可无缝集成Slack，Hipchat，LDAP，JIRA，Jenkins等其他流行的工具，提供了非常多的webhooks和完善的API。<br>　　GitLab社区版是开源的，可以免费下载使用。GitLab由超过1000人的社区维护。GitLab企业版提供深度的LDAP和Active Directory集成，以及Jira和Jenkins集成。<br>　　而无论是GitLab还是GitHub，都可以说是一种管理工具，其本质都是要学会Git的思想与使用。推荐<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">廖雪峰的git教程</a>。<br>　　Gitlab官方文档对于Gitlab的原理和重要组件有详细的说明，这里就不再展开了，但要推荐<a href="http://www.jianshu.com/p/a22eaa1fcfe7" target="_blank" rel="external">一位学长的帖子</a>，他在帖子中讲述了一些对于Gitlab工作流程和重要组件的理解，值得一读。</p>
<hr>
<h2 id="GitLab搭建配置的完整过程"><a href="#GitLab搭建配置的完整过程" class="headerlink" title="GitLab搭建配置的完整过程"></a>GitLab搭建配置的完整过程</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>　　GitLab官网上有详细的安装说明，选择操作系统版本后按步骤操作即可。但是<strong>阿里云主机无法连接GitLab Yum源</strong>，因此选择rpm包安装方式。</p>
<ol>
<li>使用curl命令获取相应文件<br><code># curl -LJO https://mirror.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-8.5.4-ce.0.el7.x86_64.rpm</code></li>
<li>rpm方式安装<br><code># rpm -i gitlab-ce-8.5.4-ce.0.el7.x86_64.rpm</code><br>结果如图：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab%E5%AE%89%E8%A3%85.png" alt=""></li>
</ol>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>　　我们在<a href="http://gcidea.info/2016/12/02/lamp/" target="_blank" rel="external">上一篇文章</a>的“phpMyAdmin的安装与配置 3.测试”中提到，由于我的网站线上环境、GitLab都是搭建在一台服务器上的，因此在默认情况下会产生端口冲突。于是做出如下处理。</p>
<ol>
<li>修改Apache端口为4040<br>使用命令：<br><code># cd etc/httpd/conf/</code><br><code># vi httpd.conf</code><br>注释掉Listen 80，改为Listen 4040<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/listen4040.png" alt=""></li>
<li><p>配置GitLab<br>GitLab的配置文件默认位于/etc/gitlab/gitlab.rb<br>使用命令：<br><code># cd /etc/gitlab</code><br><code># vi gitlab.rb</code><br>在该文件的一开始就有关于external_url的配置，这里我填的就是我的阿里云ECS主机的ip地址。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab-port-conf.png" alt=""></p>
<p>这里注意，在配置url时直接指定一个未被占用的端口即可。如果不指定端口（仅填写域名或者IP地址），那么默认的是80端口，此时就必须保证Apache使用的不是80默认端口（修改方法见上述内容），否则冲突。<br>配置完成后，还要使用如下命令使之生效：<br><code># gitlab-ctl reconfigure</code></p>
</li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>　　按照上述过程，GitLab本身的基本配置就可以了。打开浏览器输入external_url地址访问GitLab，却出现了如下界面：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab-502.png" alt=""><br><strong>原因</strong>：<br>查阅了相关资料，引起502的原因多样，比如设置的超时时间过短等。经过排查，我这里遇到这个问题是因为阿里云centos7默认的虚拟内存swap交换分区设置过小导致的。<br><strong>解决方法</strong>：<br>增加系统的swap分区：</p>
<ol>
<li>新建一个分区，创建/home/swap分区文件。文件的大小是1024000个block，1个block为1024，所以这里空间是1G<br><code># dd if=/dev/zero of=/home/swap/swap bs=1024 count=1024000</code></li>
<li>将该分区格式化成swap分区，使其成为有效状态<br><code># swapon /home/swap/swap</code></li>
<li>查看最新的分区情况：</li>
</ol>
<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/free.png" alt=""></p>
<p>发现swap分区已经创建成功。但这里还有一个问题，<strong>当系统重启后，这块分区将会消失</strong>。为此，我们需要将新分区设置为开机自动挂载。/etc/fstab文件正是负责配置Linux开机时自动挂载分区的，对其进行修改。<br>使用命令：<br><code># cd /etc</code><br><code># vi fstab</code><br>在最后增加如下一句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/swap/swap/swap swap swap defaults 0 0</span><br></pre></td></tr></table></figure></p>
<p><img src="http://7xrz3r.com1.z0.glb.clouddn.com/fstab-swap.png" alt=""></p>
<p>配置完分区后，再次访问external_url的地址，就可以看到正常的GitLab登录页。默认用户名：admin@local.host，密码5iveL!fe，登陆后可修改。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab-ce.png" alt=""><br>GitLab的管理员面板(Admin area)如下，在这里我们可以新增成员，创建项目，新建分组，邀请成员进入项目，项目持续集成配置等等，具体的问题可以进行相应搜索。<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab-panel.png" alt=""></p>
<p>至此，我们就成功搭建了GitLab~</p>
<hr>
<h2 id="GitLab-CI相关知识介绍"><a href="#GitLab-CI相关知识介绍" class="headerlink" title="GitLab-CI相关知识介绍"></a>GitLab-CI相关知识介绍</h2><p>　　目前，我们已经拥有了自己的GitLab仓库，可以进行正常的开发和版本控制了。我们现在需要考虑这样的场景：<font color="#2ca6cb">在团队合作开发中，每天每位成员都要做出很多修改，向GitHub仓库提交大量代码，且时间不定。版本库中代码虽是最新的，可是线上部署的却没有同时更新，如果测试人员需要及时跟进，或者比如APP端的同学需要调用最新的接口进行测试，就需要手动在线上进行部署，为了保证实时性一天可能就要部署很多次，烦。</font><br>　　这种场景，当然被很多人注意到了，CI–持续集成正是说的这样的问题。</p>
<blockquote>
<p>持续集成(Continuous integration)是一种软件开发实践，即团队开发成员经常集成它们的工作，通过每个成员每天至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽早地发现集成错误。</p>
</blockquote>
<p>　　强大的GitLab自然也考虑到了这个问题。GitLab-CE 8.0以上的版本已经将GitLab-CI集成进了GitLab，并且默认开启。所以不需要像以前一样再单独安装GitLab-CI并且为GitLab-CI开启单独的Server。但是GitLab-Runner还是需要我们单独安装的，来配合GitLab-CI使用。为此，这部分我们来详细讨论一下GitLab-CI相关问题。<br>　　GitLab官网上提供了详尽的CI文档<a href="http://doc.gitlab.com/ce/ci/" target="_blank" rel="external">http://doc.gitlab.com/ce/ci/</a>，可以查阅。<br>　　关于GitLab-Runner的介绍，这里我要<strong><font color="red">引用</font></strong>一下<a href="">那位学长的另一篇帖子</a>中的一部分介绍，如下。</p>
<blockquote>
<p>　　GitLab-Runner是配合GitLab-CI进行使用的。一般地，GitLab里面的每一个工程都会定义一个属于这个工程的软件集成脚本，用来自动化地完成一些软件集成工作。当这个工程的仓库代码发生变动时，比如有人push了代码，GitLab就会将这个变动通知GitLab-CI。这时GitLab-CI会找出与这个工程相关联的Runner，并通知这些Runner把代码更新到本地并执行预定义好的执行脚本。</p>
<p>　　所以，GitLab-Runner就是一个用来执行软件集成脚本的东西。你可以想象一下：Runner就像一个个的工人，而GitLab-CI就是这些工人的一个管理中心，所有工人都要在GitLab-CI里面登记注册，并且表明自己是为哪个工程服务的。当相应的工程发生变化时，GitLab-CI就会通知相应的工人执行软件集成脚本。如下图所示：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab-runner.png" alt=""><br>Runner类型<br>　　GitLab-Runner可以分类两种类型：Shared Runner（共享型）和Specific Runner（指定型）。<br><strong>Shared Runner</strong>：这种Runner（工人）是所有工程都能够用的。只有系统管理员能够创建Shared Runner。<br><strong>Specific Runner</strong>：这种Runner（工人）只能为指定的工程服务。拥有该工程访问权限的人都能够为该工程创建Shared Runner。</p>
<p>文／tsyeyuanfeng（简书作者）<br>原文链接：<a href="http://www.jianshu.com/p/2b43151fb92e" target="_blank" rel="external">http://www.jianshu.com/p/2b43151fb92e</a><br>著作权归作者所有，转载请联系作者获得授权，并标注“简书作者”。</p>
</blockquote>
<hr>
<h2 id="GitLab-CI安装配置的完整过程"><a href="#GitLab-CI安装配置的完整过程" class="headerlink" title="GitLab-CI安装配置的完整过程"></a>GitLab-CI安装配置的完整过程</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>　　之前已经说过，GitLab-CE 8.0以上的版本已经将GitLab-CI集成进了GitLab，因此下面安装GitLab-Runner。<br>　　官网确实给出了详细的安装方式（针对各种操作系统）<a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/linux-repository.md" target="_blank" rel="external">https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/linux-repository.md</a>，但是，我也确实无论如何都无法下载下来文档中提到的yum源。。。<br>为此，我“换了种方式”下载了rpm包，使用Xftp将rpm文件放进了阿里云ECS的centos系统中，再通过rpm命令进行了安装，绕了个大圈，如图：<br><img src="http://7xrz3r.com1.z0.glb.clouddn.com/multi-runner%E5%AE%89%E8%A3%85.png" alt=""></p>
<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>　　安装好gitlab-ci-multi-runner后，我们就可以用它向GitLab-CI注册Runner了。<br>　　根据官网的介绍，如果我们需要注册Shared Runner，就在管理员面板Admin Area中获取token和url，如下图：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/shared-runner.png" alt=""></p>
<p>　　如果我们需要注册Specific Runner，就要在该项目的setting中的runner面板中获取token和url，如下图：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/specific-runner-1.png" alt=""><br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/specific-runner-2.png" alt=""></p>
<p>  这里，我是新建了一个Specific Runner，使用命令：<code># gitlab-ci-multi-runner register</code> 操作如下:<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/register.png" alt=""></p>
<p>  注册成功后，我们可以在/etc/gitlab-runner/config.toml中看到runner的配置信息：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/toml.png" alt=""></p>
<p>  但是这个配置信息在runner运行时候并没有起到实质作用，因为在接下来要讲到的运行runner中，命令中必须还要带上这个配置信息中的一些内容，可以说这个配置信息只是起到了一个记录作用。</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>runner注册完成之后还必须让它运行起来，否则无法接收到GitLab-CI的通知或执行脚本。我们使用命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># gitlab-ci-multi-runner run-single --url http://***.***.***.***/ci --token ************** --executor shell</span><br></pre></td></tr></table></figure></p>
<p>运行配置好的runner，其中–url、–token和–executor参数是必须的，具体值与配置文件中的相同。其他参数可根据具体情况设置。</p>
<p>使用如下命令了解更多：<br><code># gitlab-ci-multi-runner run-single --help</code></p>
<p>当具有多个runner，可以使用命令：<br><code># gitlab-ci-multi-runner run</code><br>来批量运行，使用如下命令了解更多：<br><code># gitlab-ci-multi-runner run --help</code></p>
<p>目前还有一个问题，当runner运行后，它是保持在前台的，这时候terminal不能再做其他事情，这当然不行。因此我们要把runner运行这件事做成一个服务。<br>  使用命令：<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># gitlab-ci-multi-runner install --service gitlab-runner --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --user gitlab-runner</span><br></pre></td></tr></table></figure></p>
<p>  将这个runner做成服务，并启动：<br>  <code># gitlab-ci-multi-runner start --service gitlab-runner</code><br>  这时候，在terminal中可以继续操作，查看后台进程：<br>  <code># ps -aux | grep gitlab-runner</code><br>  发现正常运行：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/ps-gitlab-runner.png" alt=""></p>
<p>  至此，GitLab-CI和GitLab-Runner配置完成。</p>
<hr>
<h2 id="GitLab-CI持续集成服务的测试"><a href="#GitLab-CI持续集成服务的测试" class="headerlink" title="GitLab-CI持续集成服务的测试"></a>GitLab-CI持续集成服务的测试</h2><p>　　前文完成了GitLab-CI持续集成服务的配置，那么它是如何起作用的呢？<br>　　我们已知，我们针对我们项目的仓库已经建立了一个Specific Runner，并且将它运行起来了，runner就处于一种“监听状态”。当项目成员向仓库提交代码，runner检测到像git push这样的事件后，就会做出一些处理，实现项目的自动部署持续集成。具体的：<br>　　我们需要在根目录下建立一个名为.gitlab-ci.yml的文件。当整个项目进行git push的时候，runner会去检查这个文件，去执行里面的脚本。<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/gitlab-ci-yml.png" alt=""></p>
<p>　　我们想实现的效果是：每次提交的新代码都可以自动部署到/var/www/html目录下，这样访问网站或者API接口就可以获取最新情况。那么，其实就相当于删除原先该目录下的代码，将新提交的内容放在该目录下。这样就很清楚脚本怎么写了，只需要两句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  script:</span><br><span class="line">    - rm -rf /var/www/html/project_name</span><br><span class="line">    - cp -r ../project_name /var/www/html/project_name</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>解释：</p>
<ol>
<li>使用rm命令加上-rf递归强制删除项目文件/var/www/html/project_name。</li>
<li>使用命令cp加上-r参数递归复制相对于当前.gitlab-ci.yml文件的上一层目录的整个项目文件，复制到/var/www/html/project_name目录。</li>
<li>之所以是复制../project_name目录，是因为runner检测到.gitlab-ci.yml文件时，是处于最新的工程文件夹的根目录下，这样的话../project_name就表示了最新的代码。(更多的，我们可以了解到项目文件其实是位于这个runner的子目录下的：<br>/home/gitlab-runner/builds/runner_name/0/root/project_name)</li>
</ol>
</blockquote>
<p>　　实践一下，在工程中建立.gitlab-ci.yml文件，并对项目中代码做出一些修改（内容随意，主要是想看到修改效果），检查冲突后git push。这时在GitLab中该项目的控制面板的Builds菜单中监测，发现build失败了：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/build-failed.png" alt=""></p>
<p>  查看以上日志可以发现是在删除时遇到了权限问题，没有写的权限，于是更改整个项目目录的权限为777，保证删除顺利。<br>  之后再次git push测试，发现build成功：<br>  <img src="http://7xrz3r.com1.z0.glb.clouddn.com/build-success.png" alt=""></p>
<p>  (注：如果考虑直接将权限变为777这种比较暴力的方法的安全性问题，也可以采用更换文件夹所属用户组的方法，改owner为gitlab-runner：)<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chown -R gitlab-runner /var/www/html/ebfinance</span><br></pre></td></tr></table></figure></p>
<p>  这时，去Apache配置的4040端口去查看网站的效果，发现已经是最新代码对应的效果，说明自动部署成功！</p>
<hr>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>　　至此，本文的主要内容就结束了。我们拥有了自己的项目仓库并且可以自动部署持续集成，这大大提高了我们的效率。同时，这套完整的配置过程中也可以学习到很多东西，踩了不少坑，积累了一些经验，明白了一些原理，总之还是收获很大的。</p>
<p>　　</p>
<p>　　</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrz3r.com1.z0.glb.clouddn.com/p48.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;
    
    </summary>
    
      <category term="搭建部署" scheme="http://www.gcidea.info/categories/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/"/>
    
      <category term="阿里云" scheme="http://www.gcidea.info/categories/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
    
      <category term="搭建部署" scheme="http://www.gcidea.info/tags/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/"/>
    
      <category term="版本控制" scheme="http://www.gcidea.info/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
      <category term="持续集成CI" scheme="http://www.gcidea.info/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90CI/"/>
    
  </entry>
  
</feed>
